function showPosition(t){var e=t.coords.latitude,l=t.coords.longitude;localStorage.setItem("positionx",e),localStorage.setItem("positiony",l)}function getUrlParam(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),l=window.location.search.substr(1).match(e);return null!==l?unescape(l[2]):null}var transFn=function(t){return $.param(t)},postCfg={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:transFn},picBasePath="http://47.92.29.81:8891",index=angular.module("index",["ngRoute","mobile-angular-ui","mobile-angular-ui.gestures","ngFileUpload","infinite-scroll"]);index.config(["$routeProvider","$locationProvider",function(t,e){e.html5Mode(!0),t.when("/",{templateUrl:"../html/home.html",controller:"homeCtrl"}).when("/personalCenter",{templateUrl:"../html/personalCenter.html",controller:"personalCenterCtrl"}).when("/editInformation",{templateUrl:"../html/editInformation.html",controller:"editInformationCtrl"}).when("/chooseQrcode",{templateUrl:"../html/chooseQrcode.html",controller:"chooseQrcodeCtrl"}).when("/personalTailor",{templateUrl:"../html/personalTailor.html",controller:"personalTailorCtrl"}).when("/tailorData",{templateUrl:"../html/tailorData.html",controller:"tailorDataCtrl"}).when("/payTailor",{templateUrl:"../html/payTailor.html",controller:"payTailorCtrl"}).when("/compeletPayTailor",{templateUrl:"../html/compeletPayTailor.html",controller:"compeletPayTailorCtrl"}).when("/myTailor",{templateUrl:"../html/myTailor.html",controller:"myTailorCtrl"}).when("/vipCenter",{templateUrl:"../html/vipCenter.html",controller:"vipCenterCtrl"}).when("/fast_login",{templateUrl:"../html/fast_login.html",controller:"fastLoginCtrl"}).when("/works",{templateUrl:"../html/works.html",controller:"worksCtrl"}).when("/workHours",{templateUrl:"../html/workHours.html",controller:"workHoursCtrl"}).when("/morningNight",{templateUrl:"../html/morningNight.html",controller:"morningNightCtrl"}).when("/useMorn/:type/:num",{templateUrl:"../html/useMorn.html",controller:"useMornCtrl"}).when("/monList/:num",{templateUrl:"../html/monList.html",controller:"monListCtrl"}).when("/promList/:num",{templateUrl:"../html/promList.html",controller:"promListCtrl"}).when("/nightList/:num",{templateUrl:"../html/nightList.html",controller:"nightListCtrl"}).when("/noticeList/:num",{templateUrl:"../html/noticeList.html",controller:"noticeListCtrl"}).when("/useNight/:type/:num",{templateUrl:"../html/useNight.html",controller:"useNightCtrl"}).when("/useCard/:num",{templateUrl:"../html/useCard.html",controller:"useCardCtrl"}).when("/joke",{templateUrl:"../html/joke.html",controller:"jokeshowCtrl"}).when("/jokeList/:num",{templateUrl:"../html/jokeList.html",controller:"jokeListCtrl"}).when("/usejoke/:type/:num",{templateUrl:"../html/usejoke.html",controller:"usejokeCtrl"}).when("/holiday",{templateUrl:"../html/holiday.html",controller:"holidayCtrl"}).when("/holidayList/:num",{templateUrl:"../html/holidayList.html",controller:"holidayListCtrl"}).when("/greetList/:num",{templateUrl:"../html/greetList.html",controller:"greetListCtrl"}).when("/useHoliday/:type/:num",{templateUrl:"../html/useHoliday.html",controller:"useHolidayCtrl"}).when("/useGreet/:type/:num",{templateUrl:"../html/useGreet.html",controller:"useGreetCtrl"}).when("/wechatCircle/:type/:num",{templateUrl:"../html/wechatCircle.html",controller:"wechatCircleCtrl"}).when("/promotion",{templateUrl:"../html/promotion.html",controller:"promotionCtrl"}).when("/guest",{templateUrl:"../html/guest.html",controller:"guestCtrl"}).when("/homePage/:uuid",{templateUrl:"../html/homePage.html",controller:"homePageCtrl"}).when("/changeHomePage/:num",{templateUrl:"../html/changeHomePage.html",controller:"changeHomePageCtrl"}).when("/life",{templateUrl:"../html/life.html",controller:"lifeCtrl"}).when("/notice",{templateUrl:"../html/notice.html",controller:"noticeCtrl"}).when("/useNotice/:type/:num",{templateUrl:"../html/useNotice.html",controller:"useNoticeCtrl"}).when("/useActive/:num",{templateUrl:"../html/useActive.html",controller:"useActiveCtrl"}).when("/paySuccess",{templateUrl:"../html/paySuccess.html",controller:"paySuccessCtrl"}).otherwise({redirectTo:"/"})}]),function(){var t=getUrlParam("code");if(t){var e={appid:"wxef3e1498e754b61d",secret:"5e21b13a8d5e9b071b9bef2ad65e1883",code:t,grant_type:"authorization_code"};$.ajax({url:"/sns/oauth2/access_token",type:"GET",data:e,async:!1,success:function(t){if(t=JSON.parse(t),t.errcode);else{var e={type:"wx",token:t.access_token,openid:t.openid};$.ajax({url:"/user/unl/thirdlogin.json",type:"GET",data:e,async:!1,success:function(t){1===t.code?(sessionStorage.setItem("login","1"),sessionStorage.setItem("user",JSON.stringify(t.data))):2===t.code?window.location.href="fast_login":0===t.code},error:function(t){}})}},error:function(){alert("授权信息获取失败")}})}}();
index.directive("advertise",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.deferred.promise.then(function(t){e.advertiseSwiper=new Swiper(i.get(0),{direction:"horizontal",speed:300,autoplay:4e3,loop:!0,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination"})})}}}]),index.directive("designer",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.designerDeferred.promise.then(function(t){e.designerSwiper=new Swiper(i.get(0),{direction:"horizontal",effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflow:{rotate:0,stretch:0,depth:100,modifier:1,slideShadows:!0}}),e.designerSwiper.slideTo(1,500,!1)})}}}]),index.directive("activity",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.activityDeferred.promise.then(function(t){e.activitySwiper=new Swiper(i.get(0),{direction:"horizontal",speed:300,autoplay:4e3,loop:!0,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination"})})}}}]),index.directive("flashsale",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.flashSaleDeferred.promise.then(function(t){e.falshSaleSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",paginationClickable:!0,freeMode:!0})})}}}]),index.directive("back",["$window",function(e){return{restrict:"A",link:function(i,t,n){t.on("click",function(){e.history.back()})}}}]),index.directive("onFinishRenderFilters",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("ngRepeatFinished")})}}}]),index.directive("onDesignerRenderFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("designerRepeatFinished")})}}}]),index.directive("onFlashSaleRenderFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("flashSaleRepeatFinished")})}}}]),index.directive("onActivityFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("activityFinished")})}}}]),index.directive("forbidScroll",["$timeout",function(e){return{restrict:"A",link:function(e,i,t){i.on("touchmove",function(e){e.preventDefault()})}}}]),index.directive("date",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateDeferred.promise.then(function(t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:3,centeredSlides:!0})})}}}]),index.directive("dateOnly",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateOnlyDeferred.promise.then(function(t){e.timeOnlySwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:5,centeredSlides:!0})})}}}]),index.directive("time",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:3,centeredSlides:!0})}}}]),index.directive("timeSelect",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:5,centeredSlides:!0})}}}]),index.directive("onTimeFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("timeFinished")})}}}]),index.directive("onTimeOnlyFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("timeOnlyFinished")})}}}]),index.directive("dateSelect",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateDeferred.promise.then(function(t){e.dateSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",freeMode:!0})})}}}]),index.directive("onHotSaleFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("hotSaleRepeatFinished")})}}}]),index.directive("hotsale",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.hotSaleDeferred.promise.then(function(t){e.hotSaleSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",paginationClickable:!0,freeMode:!0,observer:!0,observerParents:!0,onReachEnd:function(i){e.hotSalePage+=1,e.getHotSaleRecommend()}})})}}}]),index.directive("commonSwiper",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.commonSwiper=new Swiper(i.get(0),{observer:!0,observerParents:!0})}}}]);
index.controller("changeHomePageCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,s,t,n,o){var i=o.num;e.workTime=[];var r=JSON.parse(sessionStorage.getItem("user")),p=r.uuid;a.post("/user/unl/otherpage.json",{uuid:p},postCfg).then(function(t){if(console.log(t),1===t.data.code){var n=t.data.data;n.avatar=picBasePath+n.avatar,n.qrcode=picBasePath+n.qrcode,n.displaytype=i,e.pointLabel=n.userflags,e.hrefTel="tel:"+n.telephone;for(var o=n.workday,r=0;r<o.length;r++)e.workTime.push(o[r]);for(var d=0;d<n.workslist.length;d++)n.workslist[d]=picBasePath+n.workslist[d];if(e.user=n,console.log(e.user.displaytype),1==e.user.displaytype)return;2==e.user.displaytype?($(".user-info").addClass("user-info2"),$(".line-title-text").addClass("background-333"),$(".line-title-line").addClass("background-333"),$(".call-designer").addClass("background-333"),$(".appointment-btn").addClass("color-333"),$(".dashed-line").addClass("dashed-line-333"),$(".home-page-price").attr("src","../../assets/images/home_page_price1.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time1.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home1.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place1.png")):3==e.user.displaytype&&($(".user-info").addClass("user-info3"),$(".line-title-text").addClass("background-f5a623"),$(".line-title-line").addClass("background-f5a623"),$(".call-designer").addClass("background-f5a623"),$(".appointment-btn").addClass("color-f5a623"),$(".dashed-line").addClass("dashed-line-f5a623"),$(".home-page-price").attr("src","../../assets/images/home_page_price2.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time2.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home2.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place2.png"));var l={url:s.location.href.split("#")[0]};a.post("/user/unl/wzinfo.json",l,postCfg).then(function(a){1===a.data.code&&(wx.config({debug:!1,appId:a.data.data.appid,timestamp:a.data.data.timestamp,nonceStr:a.data.data.noncestr,signature:a.data.data.signature,jsApiList:["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+p,imgUrl:e.user.avatar,type:"link",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+p,imgUrl:e.user.avatar,success:function(){},cancel:function(){}})}))},function(e){})}},function(e){});var d=new Date;e.nowYear=d.getFullYear(),e.appointment=function(){$(".prompt-fixed").show()},e.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},a.post("/user/mypage/share.json",postCfg).then(function(e){console.log(e),1===e.data.code},function(e){}),e.changeHomePage=function(){var n={displaytype:i};a.post("/user/edit.json",n,postCfg).then(function(n){-1===n.data.code?(e.isLogin=!1,t.path("fast_login")):1===n.data.code&&(e.isLogin=!0,a.post("/user/mine.json",postCfg).then(function(a){if(console.log(a),-1===a.data.code)e.isLogin=!1;else if(1===a.data.code){e.isLogin=!0;var t=a.data.data;""===t.avatar?t.avatar="../../assets/images/head-none.png":t.avatar=picBasePath+t.avatar,alert("修改主页风格成功！"),s.history.back()}},function(e){}))},function(e){})}}]);
index.controller("chooseQrcodeCtrl",["$scope","$http","$window","$location","$rootScope",function(a,e,o,t,s){function r(){return 0===a.localId.length?(alert("请选择图片!"),!1):void wx.uploadImage({localId:a.localId[0],isShowProgressTips:1,success:function(o){a.serverId=o.serverId;var t={qrcodemediaid:a.serverId};e.post("/user/edit.json",t,postCfg).then(function(e){if(1===e.data.code){var o=e.data.data;""===o.avatar?o.avatar="../../assets/images/head-none.png":o.avatar=picBasePath+o.avatar,o.qrcode=picBasePath+o.qrcode,a.user=o,sessionStorage.setItem("user",JSON.stringify(c))}else alert(e.data.reason)},function(a){alert("数据请求失败，请稍后再试！")})},fail:function(a){alert("上传失败！")}})}var n={url:o.location.href.split("#")[0]};console.log(n),e.post("/user/unl/wzinfo.json",n,postCfg).then(function(a){1===a.data.code&&(console.log(a),wx.config({debug:!1,appId:a.data.data.appid,timestamp:a.data.data.timestamp,nonceStr:a.data.data.noncestr,signature:a.data.data.signature,jsApiList:["chooseImage","uploadImage"]}))},function(a){});var c=JSON.parse(sessionStorage.getItem("user"));""===c.qrcode?c.qrcode="../../assets/images/edit-headimg.png":c.qrcode=picBasePath+c.qrcode,a.user=c,a.addPhoto=function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){return a.localId=e.localIds,0===a.localId.length?(alert("请选择图片!"),!1):void r()}})},a.upload=function(){o.history.back()}}]);
index.controller("compeletPayTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,o,r,a){var n=JSON.parse(sessionStorage.getItem("user"));e.user=n,t.post("/user/customizedetail.json",postCfg).then(function(t){1===t.data.code&&(e.customizeOrder=t.data.data.order)},function(e){}),e.toPay=function(){var o={type:"wz",orderid:e.customizeOrder.id};t.post("/pay/prepay.json",o,postCfg).success(function(e){if(1===e.code){var t=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp.toString(),nonceStr:t.nonceStr,"package":t["package"],signType:t.signType,paySign:t.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?(alert("支付成功"),r.path("personalTailor")):alert("支付失败"+e.err_msg)})}else 0===e.code&&alert(e.reason)}).error(function(e){alert(e.reason)})}}]);
index.controller("editInformationCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(e,o,t,a,r,i){function l(){return 0===e.localId.length?(alert("请选择头像图片!"),!1):void wx.uploadImage({localId:e.localId[0],isShowProgressTips:1,success:function(t){e.serverId=t.serverId;var a={avatarmediaid:e.serverId};o.post("/user/edit.json",a,postCfg).then(function(o){if(1===o.data.code){var t=o.data.data;""===t.avatar?t.avatar="../../assets/images/head-none.png":t.avatar=picBasePath+t.avatar,e.user=t,sessionStorage.setItem("user",JSON.stringify(t))}else alert(o.data.reason)},function(e){})},fail:function(e){alert("上传失败！")}})}var n=JSON.parse(sessionStorage.getItem("user"));e.user=n,e.name=n.name,e.worktime=n.worktime,null===n.worklevel?e.worklevel="":e.worklevel=n.worklevel.name,e.storename=n.storename,e.storeplace=n.storeplace,e.cutprice=n.cutprice,e.colorpricelow=n.colorpricelow,e.colorpricehigh=n.colorpricehigh,e.permpricelow=n.permpricelow,e.permpricehigh=n.permpricehigh,e.pointLabel=n.flags,e.flagid=[],""!==n.avatar&&"../../assets/images/head-none.png"!==n.avatar||(e.user.avatar="../../assets/images/edit-headimg.png"),""===n.qrcode?e.qrState="(未上传)":e.qrState="(已上传)",o.post("/user/unl/worklevel.json",postCfg).then(function(o){if(1===o.data.code){for(var t=o.data.data.worklevel,a=0;a<t.length;a++)t[a].selected=!1;e.levelList=t}},function(e){}),e.selectLabel=function(e){e.ischoose=!e.ischoose},e.promptFalse=function(){$(".prompt-fixed").fadeOut(),i(function(){t.history.back()})},e.promptTrue=function(){$(".prompt-fixed").fadeOut(10)},e.saveInformation=function(){for(var t=0;t<e.pointLabel.length;t++)e.pointLabel[t].ischoose===!0&&e.flagid.push(e.pointLabel[t].id);if(""===e.name||""===e.worktime||""===e.worklevelid||""===e.storename||""===e.storeplace||""===e.cutprice||""===e.colorpricelow||""===e.colorpricehigh||""===e.permpricelow||""===e.permpricehigh||0===e.flagid.length)return void $(".prompt-fixed").show();var r={name:e.name,worktime:e.worktime,worklevelid:e.worklevelid,storename:e.storename,storeplace:e.storeplace,cutprice:e.cutprice,colorpricelow:e.colorpricelow,colorpricehigh:e.colorpricehigh,permpricelow:e.permpricelow,permpricehigh:e.permpricehigh,flagid:e.flagid};o.post("/user/edit.json",r,postCfg).then(function(o){-1===o.data.code?(e.isLogin=!1,a.path("fast_login")):1===o.data.code&&(e.isLogin=!0,a.path("/"))},function(e){})},e.chooseQrcode=function(){window.location.href="/yueAssistant/build/html/chooseQrcode"},e.showLevel=function(){$(".fixed-content").show()},e.selectLevel=function(o){for(var t=0;t<e.levelList.length;t++)e.levelList[t].selected=!1;o.selected=!o.selected,e.worklevelid=o.id,e.worklevel=o.name,$(".fixed-content").fadeOut(10)};var c={url:t.location.href.split("#")[0]};o.post("/user/unl/wzinfo.json",c,postCfg).then(function(e){1===e.data.code&&wx.config({debug:!1,appId:e.data.data.appid,timestamp:e.data.data.timestamp,nonceStr:e.data.data.noncestr,signature:e.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(e){}),e.localId=[],e.addPhoto=function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(o){return e.localId=o.localIds,0===e.localId.length?(alert("请选择图片!"),!1):(e.user.avatar=e.localId[0],void l())}})}}]);
index.controller("fastLoginCtrl",["$scope","$http","$window","$location","$interval","$timeout",function(e,o,t,n,a,d){function i(){return s.test(e.phone)?r.test(e.code)?1:(e.modalText="验证码输入错误",$(".prompt-container").show().fadeOut(2e3),-1):(e.modalText="手机号码有误！",$(".prompt-container").show().fadeOut(2e3),-1)}var s=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/,r=/^\d{4}$/;e.sendCodeText="获取验证码",e.modalText="",e.getCode=function(){return e.sending?void 0:s.test(e.phone)?void o.post("/user/unl/sendlogin.json",{telephone:e.phone},postCfg).then(function(o){if(console.log(o),1===o.data.code){e.sending=!0;var t=60,n=a(function(){t>0?e.sendCodeText="重新发送("+t--+")":(e.sendCodeText="发送验证码",e.sending=!1,a.cancel(n))},1e3)}},function(e){}):(e.modalText="手机号码有误！",void $(".prompt-container").show().fadeOut(2e3))},e.confirmLogin=function(){if(-1!==i()){var n={telephone:e.phone,check:e.code,uuid:e.uuid};o.post("/user/unl/bindtelephone.json",n,postCfg).then(function(o){if(1===o.data.code){var n=o.data.data;sessionStorage.setItem("user",JSON.stringify(n)),d(function(){t.history.back()})}else 0===o.data.code?(e.modalText=o.data.reason,$(".prompt-container").show().fadeOut(2e3)):(e.modalText=o.data.reason,$(".prompt-container").show().fadeOut(2e3))},function(e){alert(e.reason)})}}}]);
index.controller("greetListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,o,r,i,s){var n=s.num;t.imgList=[];for(var a=1;6>a;a++)t.imgList.push("../../assets/images/greet/type"+n+"/img_"+a+".png");t.useMornTemplate=function(t){r.path("useGreet/"+n+"/"+t)}}]);
index.controller("guestCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,a,i,c){document.title="客照展示";var o=JSON.parse(sessionStorage.getItem("user"));e.user=o,e.activeTab=1,c.activeTab&&(e.activeTab=c.activeTab),e.loading=!1,e.changeTab=function(t){switch(e.activeTab=t,t){case 1:c.activeTab=1;break;case 2:c.activeTab=2}},e.useGuest=function(t){window.location.href="../template/guest/index.html?num="+t+"&uuid="+e.user.uuid}}]);
index.controller("holidayCtrl",["$scope","$http","$window","$location","$rootScope",function(t,a,e,i,o){document.title="节日问候",t.activeTab=1,o.activeTabMorn&&(t.activeTab=o.activeTabMorn),t.changeTab=function(a){switch(t.activeTab=a,a){case 1:o.activeTabMorn=1;break;case 2:o.activeTabMorn=2}},t.useMornTemplate=function(t){i.path("holidayList/"+t)},t.useNightTemplate=function(t){i.path("greetList/"+t)}}]);
index.controller("holidayListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(i,o,s,t,a,e){var n=e.num;if(i.dragon=n,i.imgList=[],6==n)for(var r=1;7>r;r++)i.imgList.push("../../assets/images/holiday/type"+n+"/img_"+r+".png");else for(var p=1;3>p;p++)i.imgList.push("../../assets/images/holiday/type"+n+"/img_"+p+".png");i.useMornTemplate=function(i){t.path("useHoliday/"+n+"/"+i)}}]);
index.controller("homeCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,a,o,n){document.title="小悦助手",t.post("/user/mine.json",postCfg).then(function(t){if(console.log(t),-1===t.data.code)e.isLogin=!1;else if(1===t.data.code){e.isLogin=!0;var a=t.data.data;""===a.avatar?a.avatar="../../assets/images/head-none.png":a.avatar=picBasePath+a.avatar,e.user=a,sessionStorage.setItem("user",JSON.stringify(a))}},function(e){}),e.personalCenter=function(){o.path("personalCenter")},e.setIn=function(){},e.vipCenter=function(){o.path("vipCenter")},e.showTemplate=function(e){switch(e){case 1:o.path("morningNight");break;case 2:o.path("guest");break;case 3:o.path("notice");break;case 4:o.path("promotion");break;case 5:o.path("holiday");break;case 6:o.path("joke");break;case 7:o.path("life")}},e.goHomePage=function(){return e.user.iscomplete===!1?void $(".prompt-fixed").show():void(window.location.href="/yueAssistant/build/html/homePage/"+e.user.uuid)},e.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},e.promptTrue=function(){$(".prompt-fixed").fadeOut(),o.path("editInformation")}}]);
index.controller("homePageCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,t,s,n,o){document.title="主页形象";var i=o.uuid;e.workTime=[],a.post("/user/unl/otherpage.json",{uuid:i},postCfg).then(function(s){if(console.log(s),1===s.data.code){var n=s.data.data;n.avatar=picBasePath+n.avatar,n.qrcode=picBasePath+n.qrcode,e.pointLabel=n.userflags,e.hrefTel="tel:"+n.telephone;for(var o=n.workday,r=0;r<o.length;r++)e.workTime.push(o[r]);for(var d=0;d<n.workslist.length;d++)n.workslist[d]=picBasePath+n.workslist[d];switch(e.user=n,e.user.displaytype){case 1:break;case 2:$(".user-info").addClass("user-info2"),$(".line-title-text").addClass("background-333"),$(".line-title-line").addClass("background-333"),$(".call-designer").addClass("background-333"),$(".appointment-btn").addClass("color-333"),$(".dashed-line").addClass("dashed-line-333"),$(".home-page-price").attr("src","../../assets/images/home_page_price1.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time1.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home1.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place1.png");break;case 3:$(".user-info").addClass("user-info3"),$(".line-title-text").addClass("background-f5a623"),$(".line-title-line").addClass("background-f5a623"),$(".call-designer").addClass("background-f5a623"),$(".appointment-btn").addClass("color-f5a623"),$(".dashed-line").addClass("dashed-line-f5a623"),$(".home-page-price").attr("src","../../assets/images/home_page_price2.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time2.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home2.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place2.png")}var c={url:t.location.href.split("#")[0]};a.post("/user/unl/wzinfo.json",c,postCfg).then(function(a){1===a.data.code&&(wx.config({debug:!1,appId:a.data.data.appid,timestamp:a.data.data.timestamp,nonceStr:a.data.data.noncestr,signature:a.data.data.signature,jsApiList:["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+i,imgUrl:e.user.avatar,type:"link",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+i,imgUrl:e.user.avatar,success:function(){},cancel:function(){}})}))},function(e){})}},function(e){});var r=new Date;e.nowYear=r.getFullYear(),e.appointment=function(){$(".prompt-fixed").show()},e.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},e.showQrImg=function(){$(".qrcode-fixed-content").show()},e.hideQrImg=function(){$(".qrcode-fixed-content").fadeOut(50)},e.stopPro=function(e){e.stopPropagation()},a.post("/user/mypage/share.json",postCfg).then(function(e){console.log(e),1===e.data.code},function(e){})}]);
index.controller("jokeshowCtrl",["$scope","$http","$window","$location","$rootScope",function(o,t,e,n,c){document.title="段子笑话",o.useTemplate=function(o){n.path("jokeList/"+o)}}]);
index.controller("jokeListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(o,t,e,i,s,n){var r=n.num;o.imgList=[];for(var a=1;11>a;a++)o.imgList.push("../../assets/images/joke/type"+r+"/img_"+a+".png");o.useMornTemplate=function(o){i.path("usejoke/"+r+"/"+o)}}]);
index.controller("lifeCtrl",["$scope","$http","$window","$location","$rootScope",function(e,a,i,t,c){document.title="生活日常",e.activeTab=1,c.activeTablife&&(e.activeTab=c.activeTablife),e.changeTab=function(a){switch(e.activeTab=a,a){case 1:c.activeTablife=1;break;case 2:c.activeTablife=2;break;case 3:c.activeTablife=3}},e.useMornTemplate=function(e){window.location.href="../template/life/index.html?num="+e}}]);
index.controller("monListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(o,t,n,i,e,r){var s=r.num;o.imgList=[];for(var a=1;6>a;a++)o.imgList.push("../../assets/images/morning/type"+s+"/img_"+a+".png");o.useMornTemplate=function(o){i.path("useMorn/"+s+"/"+o)}}]);
index.controller("morningNightCtrl",["$scope","$http","$window","$location","$rootScope",function(t,a,e,n,i){document.title="早晚安",t.activeTab=1,i.activeTabMorn&&(t.activeTab=i.activeTabMorn),t.changeTab=function(a){switch(t.activeTab=a,a){case 1:i.activeTabMorn=1;break;case 2:i.activeTabMorn=2}},t.useMornTemplate=function(t){n.path("monList/"+t)},t.useNightTemplate=function(t){n.path("nightList/"+t)}}]);
index.controller("myTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(o,s,e,t,r){var a=JSON.parse(sessionStorage.getItem("user"));o.user=a,s.post("/user/customizedetail.json",postCfg).then(function(s){if(console.log(s),1===s.data.code){var e=s.data.data.customize;if(o.customizeInfo=e,o.progressFlag=o.customizeInfo.status,o.progressTitle="",o.progressFlag)switch(o.progressFlag){case 1:o.progressTitle="您的预约已经提交";break;case 2:o.progressTitle="已匹配专属编辑";break;case 3:o.progressTitle="编辑正在量身定制";break;case 4:o.progressTitle="您的专属定制已经完成"}}},function(o){}),o.activeTab=1,s.post("/user/customizelist.json",postCfg).then(function(s){if(console.log(s),1===s.data.code){var e=s.data.data.customizelist;for(i=0;i<e.length;i++)e[i].imgurl=picBasePath+e[i].imgurl;o.customizeList=e}},function(o){}),o.showCustomize=function(o){window.location.href=o.jumpurl}}]);
index.controller("nightListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,o,i,n,e,s){var r=s.num;t.imgList=[];for(var a=1;6>a;a++)t.imgList.push("../../assets/images/goodnight/type"+r+"/img_"+a+".png");t.useMornTemplate=function(t){n.path("useNight/"+r+"/"+t)}}]);
index.controller("noticeCtrl",["$scope","$http","$window","$location","$rootScope",function(t,e,a,c,i){document.title="通知海报",t.activeTab=1,i.activeTabMorn&&(t.activeTab=i.activeTabMorn),t.changeTab=function(e){switch(t.activeTab=e,e){case 1:i.activeTabMorn=1;break;case 2:i.activeTabMorn=2}},t.useMornTemplate=function(t){c.path("noticeList/"+t)},t.useNightTemplate=function(t){c.path("useActive/"+t)}}]);
index.controller("noticeListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,o,e,i,n,s){var r=s.num;t.imgList=[];for(var a=1;3>a;a++)t.imgList.push("../../assets/images/notice/type"+r+"/img_"+a+".png");t.useMornTemplate=function(t){i.path("useNotice/"+r+"/"+t)}}]);
index.controller("paySuccessCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(o,t,c,n,e,i){i(function(){n.path("/")},1e3)}]);
index.controller("payTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,r,o,a){e.customizeOrder=a.customizeOrder;var n=JSON.parse(sessionStorage.getItem("user"));e.user=n,e.toPay=function(){var r={type:"wz",orderid:e.customizeOrder.id};t.post("/pay/prepay.json",r,postCfg).success(function(e){if(1===e.code){var t=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp.toString(),nonceStr:t.nonceStr,"package":t["package"],signType:t.signType,paySign:t.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?window.location.href="/yueAssistant/build/html/paySuccess":alert("支付失败，请稍后再试！")})}else 0===e.code&&alert(e.reason)}).error(function(e){alert(e.reason)})}}]);
index.controller("personalCenterCtrl",["$scope","$http","$window","$location","$rootScope",function(o,t,n,a,i){t.post("/user/mine.json",postCfg).then(function(t){if(console.log(t),-1===t.data.code)o.isLogin=!1;else if(1===t.data.code){o.isLogin=!0;var n=t.data.data;""===n.avatar?n.avatar="../../assets/images/head-none.png":n.avatar=picBasePath+n.avatar,o.user=n,sessionStorage.setItem("user",JSON.stringify(n))}},function(o){}),o.editInformation=function(){window.location.href="/yueAssistant/build/html/editInformation"},o.personalTailor=function(){a.path("personalTailor")},o.goVipCenter=function(){a.path("vipCenter")},o.goWorks=function(){window.location.href="/yueAssistant/build/html/works"},o.goWorkHours=function(){a.path("workHours")}}]);
index.controller("personalTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(o,t,a,i,n){t.post("/user/customizepage.json",postCfg).then(function(t){console.log(t),1===t.data.code&&(t.data.data.customizeimgurl=picBasePath+t.data.data.customizeimgurl,o.customizeInfo=t.data.data)},function(o){}),o.tailorData=function(){window.location.href="tailorData"},o.toMyTailor=function(){i.path("myTailor")},o.showCustomize=function(){window.location.href=o.customizeInfo.customizeurl},o.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},o.promptTrue=function(){$(".prompt-fixed").fadeOut(),i.path("compeletPayTailor")}}]);
index.controller("promListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(o,t,i,e,r,n){var s=n.num;o.imgList=[];for(var a=1;4>a;a++)o.imgList.push("../../assets/images/promotion/type"+s+"/img_"+a+".png");o.useMornTemplate=function(o){e.path("wechatCircle/"+s+"/"+o)}}]);
index.controller("promotionCtrl",["$scope","$http","$window","$location","$rootScope",function(a,e,t,c,i){document.title="个人推广";var o=JSON.parse(sessionStorage.getItem("user"));a.user=o,a.activeTab=2,i.activeTab&&(a.activeTab=i.activeTab),a.loading=!1,a.changeTab=function(e){switch(a.activeTab=e,e){case 1:i.activeTab=1;break;case 2:i.activeTab=2;break;case 3:i.activeTab=3}},a.changeHomePage=function(a){i.activeTab=1,c.path("changeHomePage/"+a)},a.useTemplate=function(a){i.activeTab=3,c.path("promList/"+a)},a.useCard=function(e){i.activeTab=2,window.location.href="../template/card/index.html?num="+e+"&uuid="+a.user.uuid}}]);
index.controller("tailorDataCtrl",["$scope","$http","$window","$location","$rootScope",function(e,i,o,a,d){function t(){wx.uploadImage({localId:e.lifelocalid[e.upImg],isShowProgressTips:1,success:function(i){e.lifeList.push(e.lifelocalid[e.upImg]),$(".update-img-life").prepend("<img src="+e.lifelocalid[e.upImg]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.lifemediaid.push(i.serverId),e.upImg<e.lifelocalid.length&&(e.upImg+=1,t())},fail:function(e){}})}function r(){wx.uploadImage({localId:e.worklocalid[e.upImg],isShowProgressTips:1,success:function(i){e.workList.push(e.worklocalid[e.upImg]),$(".update-img-work").prepend("<img src="+e.worklocalid[e.upImg]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.workmediaid.push(i.serverId),e.upImg<e.worklocalid.length&&(e.upImg+=1,r())},fail:function(e){}})}function l(){wx.uploadImage({localId:e.artlocalid[e.upImg],isShowProgressTips:1,success:function(i){e.artList.push(e.artlocalid[e.upImg]),$(".update-img-art").prepend("<img src="+e.artlocalid[e.upImg]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.artmediaid.push(i.serverId),e.upImg<e.artlocalid.length&&(e.upImg+=1,l())},fail:function(e){}})}function s(){wx.uploadImage({localId:e.goodslocalid[e.upImg],isShowProgressTips:1,success:function(i){e.goodsList.push(e.goodslocalid[e.upImg]),$(".update-img-goods").prepend("<img src="+e.goodslocalid[e.upImg]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.goodsmediaid.push(i.serverId),e.upImg<e.goodslocalid.length&&(e.upImg+=1,s())},fail:function(e){}})}var n={url:o.location.href.split("#")[0]};i.post("/user/unl/wzinfo.json",n,postCfg).then(function(e){1===e.data.code&&wx.config({debug:!1,appId:e.data.data.appid,timestamp:e.data.data.timestamp,nonceStr:e.data.data.noncestr,signature:e.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(e){}),e.lifemediaid=[],e.workmediaid=[],e.artmediaid=[],e.goodsmediaid=[],e.lifeList=[],e.workList=[],e.artList=[],e.goodsList=[],e.upImg=0,e.addLifePhoto=function(){return e.lifemediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.lifelocalid=i.localIds,0===e.lifelocalid.length?(alert("请选择图片!"),!1):(e.upImg=0,void t())}})},e.addWorkPhoto=function(){return e.workmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.worklocalid=i.localIds,0===e.worklocalid.length?(alert("请选择图片!"),!1):(e.upImg=0,void r())}})},e.addArtPhoto=function(){return e.artmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.artlocalid=i.localIds,0===e.artlocalid.length?(alert("请选择图片!"),!1):(e.upImg=0,void l())}})},e.addGoodsPhoto=function(){return e.goodsmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.goodslocalid=i.localIds,0===e.goodslocalid.length?(alert("请选择图片!"),!1):(e.upImg=0,void s())}})},e.toPayTailor=function(){if(""===e.name||""===e.telephone||""===e.education||""===e.work||""===e.activity||""===e.magazine||""===e.stars||""===e.brand||0===e.lifemediaid.length||0===e.workmediaid.length||0===e.artmediaid.length||0===e.goodsmediaid.length)return alert("有信息尚未填写，请完善后再保存"),!1;var o={name:e.name,telephone:e.telephone,education:e.education,work:e.work,activity:e.activity,magazine:e.magazine,stars:e.stars,brand:e.brand,remark:e.remark,lifemediaid:e.lifemediaid,workmediaid:e.workmediaid,artmediaid:e.artmediaid,goodsmediaid:e.goodsmediaid};i.post("/user/addcustomize.json",o,postCfg).then(function(e){1===e.data.code&&(console.log(e),d.customizeOrder=e.data.data,a.path("payTailor"))},function(e){})}}]);
index.controller("useActiveCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,l,o,a,f){function r(){t.btnText="一键生成海报",t.showcanvas=!0;var e=new Date,l=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),o=e.getMonth()+1;switch(o){case 1:o="JAN";break;case 2:o="FEB";break;case 3:o="MAR";break;case 4:o="APR";break;case 5:o="MAY";break;case 6:o="JUN";break;case 7:o="JUL";break;case 8:o="AUG";break;case 9:o="SEP";break;case 10:o="OCT";break;case 11:o="NOV";break;case 12:o="DEC"}var a=e.getDay();switch(a){case 0:a="Sunday";break;case 1:a="Monday";break;case 2:a="Tuesday";break;case 3:a="Wednesday";break;case 4:a="Thursday";break;case 5:a="Friday";break;case 6:a="Saturday"}var f=i("main");f.width,f.height;f.clearRect(0,0,1e3,1e3);var r=new Image;r.src=t.showImg,r.onload=function(){if(f.drawImage(r,0,0,m,x),navigator.userAgent.match(/iphone/i)){if(1==M){f.font="normal bold 60px myFirstFont",f.fillStyle="#fff",f.textAlign="left";var o=Math.floor(.212*s),a=Math.floor(.5767*s),i=Math.floor(.5*s),n=Math.floor(.394*x),h=Math.floor(.3284*x);f.fillText(t.startTime,o,n),f.fillText(t.endTime,a,n),f.fillStyle="#000",f.textAlign="center",f.fillText(t.name,i,h)}else if(2==M){f.font="normal bold 34px myFirstFont",f.fillStyle="#fff",f.textAlign="center";var d=Math.floor(.5*s),c=(Math.floor(.5667*s),Math.floor(.2267*s)),u=Math.floor(.3017*s),T=Math.floor(.3767*s),y=Math.floor(.6296*s),g=Math.floor(.6996*s),p=Math.floor(.7696*s),F=Math.floor(.1147*x),b=Math.floor(.3082*x),v=Math.floor(.737*x);f.fillText(l,d,F),f.font="normal bold 48px myFirstFont",f.fillStyle="#000",f.fillText(t.name,d,b),f.fillText(t.startHour,c,v),f.fillText(t.startMinute,T,v),f.fillText(t.endHour,y,v),f.fillText(t.endMinute,p,v),f.fillStyle="#fff",f.fillText(":",u,v),f.fillText(":",g,v)}else if(3==M){f.font="normal bold 48px myFirstFont",f.fillStyle="#000",f.textAlign="center";var S=(Math.floor(.5*s),Math.floor(.5667*s),Math.floor(.2267*s)),A=Math.floor(.3017*s),$=Math.floor(.3767*s),w=Math.floor(.6296*s),k=Math.floor(.6996*s),P=Math.floor(.7696*s),D=(Math.floor(.1147*x),Math.floor(.3082*x),Math.floor(.802*x));f.fillText(t.startHour,S,D),f.fillText(t.startMinute,$,D),f.fillText(t.endHour,w,D),f.fillText(t.endMinute,P,D),f.fillText(":",A,D),f.fillText(":",k,D)}else if(4==M){f.font="normal bold 36px myFirstFont",f.fillStyle="#fff";var O=Math.floor(.747*s),I=Math.floor(.922*x);f.fillText(t.name,O,I)}else if(5==M){f.font="normal bold 72px myFirstFont",f.fillStyle="#244678",f.textAlign="left";var H=Math.floor(.2693*s),E=Math.floor(.522*s),B=Math.floor(.69*s),C=Math.floor(.3355*x),J=Math.floor(.4669*x),N=Math.floor(.616*x),R=Math.floor(.701*x);f.fillText(t.startMonth,H,C),f.fillText(t.startDate,E,C),f.fillText(t.endMonth,H,J),f.fillText(t.endDate,E,J),f.textAlign="center",f.fillStyle="#fff",f.fillText(t.colorPrice,B,N),f.fillText(t.permPrice,B,R)}else if(6==M){f.font="normal bold 45px myFirstFont",f.fillStyle="#fff",f.textAlign="right";var U=Math.floor(.951*s),Y=Math.floor(.244*x);f.fillText(t.name,U,Y)}else if(7==M){var L=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear();f.font="normal bold 48px myFirstFont",f.fillStyle="#000",f.textAlign="center";var W=Math.floor(.5*s),j=Math.floor(.6587*x);f.fillText(L,W,j)}else if(8==M){f.font="normal bold 300px myFirstFont",f.fillStyle="#af0008",f.textAlign="center";var G=Math.floor(.5*s),V=Math.floor(.7261*x);f.fillText(t.day,G,V)}else if(9==M){f.font="normal bold 48px myFirstFont",f.fillStyle="#000",f.textAlign="center";var _=Math.floor(.51*s),q=Math.floor(.509*x),z=Math.floor(.589*x);f.fillText(t.colorPrice,_,q),f.fillText(t.permPrice,_,z)}else if(10==M){f.font="normal bold 48px myFirstFont",f.fillStyle="#000",f.textAlign="center";var K=Math.floor(.5*s),Q=Math.floor(.14*s),X=Math.floor(.7364*x),Z=Math.floor(.8052*x);f.fillText(t.name,K,X),f.font="normal bold 72px myFirstFont",f.fillStyle="#324ee9",f.textAlign="left",f.fillText(t.startDate,Q,Z)}}else if(1==M){f.font="normal bold 0.8rem myFirstFont",f.fillStyle="#fff",f.textAlign="left";var tt=Math.floor(.212*s),et=Math.floor(.5767*s),lt=Math.floor(.5*s),ot=Math.floor(.394*x),at=Math.floor(.3284*x);f.fillText(t.startTime,tt,ot),f.fillText(t.endTime,et,ot),f.fillStyle="#000",f.textAlign="center",f.fillText(t.name,lt,at)}else if(2==M){f.font="normal bold 0.453333rem myFirstFont",f.fillStyle="#fff",f.textAlign="center";var ft=Math.floor(.5*s),rt=(Math.floor(.5667*s),Math.floor(.2267*s)),it=Math.floor(.3017*s),nt=Math.floor(.3767*s),ht=Math.floor(.6296*s),st=Math.floor(.6996*s),mt=Math.floor(.7696*s),xt=Math.floor(.1147*x),Mt=Math.floor(.3082*x),dt=Math.floor(.737*x);f.fillText(l,ft,xt),f.font="normal bold 0.533333rem myFirstFont",f.fillStyle="#000",f.fillText(t.name,ft,Mt),f.fillText(t.startHour,rt,dt),f.fillText(t.startMinute,nt,dt),f.fillText(t.endHour,ht,dt),f.fillText(t.endMinute,mt,dt),f.fillStyle="#fff",f.fillText(":",it,dt),f.fillText(":",st,dt)}else if(3==M){f.font="normal bold 0.64rem myFirstFont",f.fillStyle="#000",f.textAlign="center";var ct=(Math.floor(.5*s),Math.floor(.5667*s),Math.floor(.2267*s)),ut=Math.floor(.3017*s),Tt=Math.floor(.3767*s),yt=Math.floor(.6296*s),gt=Math.floor(.6996*s),pt=Math.floor(.7696*s),Ft=(Math.floor(.1147*x),Math.floor(.3082*x),Math.floor(.802*x));f.fillText(t.startHour,ct,Ft),f.fillText(t.startMinute,Tt,Ft),f.fillText(t.endHour,yt,Ft),f.fillText(t.endMinute,pt,Ft),f.fillText(":",ut,Ft),f.fillText(":",gt,Ft)}else if(4==M){f.font="normal bold 0.48rem myFirstFont",f.fillStyle="#fff";var bt=Math.floor(.747*s),vt=Math.floor(.922*x);f.fillText(t.name,bt,vt)}else if(5==M){f.font="normal bold 0.96rem myFirstFont",f.fillStyle="#244678",f.textAlign="left";var St=Math.floor(.2693*s),At=Math.floor(.522*s),$t=Math.floor(.69*s),wt=Math.floor(.3355*x),kt=Math.floor(.4669*x),Pt=Math.floor(.616*x),Dt=Math.floor(.701*x);f.fillText(t.startMonth,St,wt),f.fillText(t.startDate,At,wt),f.fillText(t.endMonth,St,kt),f.fillText(t.endDate,At,kt),f.textAlign="center",f.fillStyle="#fff",f.fillText(t.colorPrice,$t,Pt),f.fillText(t.permPrice,$t,Dt)}else if(6==M){f.font="normal bold 0.6rem myFirstFont",f.fillStyle="#fff",f.textAlign="right";var Ot=Math.floor(.951*s),It=Math.floor(.244*x);f.fillText(t.name,Ot,It)}else if(7==M){var Ht=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear();f.font="normal bold 0.6rem myFirstFont",f.fillStyle="#000",f.textAlign="center";var Et=Math.floor(.5*s),Bt=Math.floor(.6587*x);f.fillText(Ht,Et,Bt)}else if(8==M){f.font="normal bold 4.0rem myFirstFont",f.fillStyle="#af0008",f.textAlign="center";var Ct=Math.floor(.5*s),Jt=Math.floor(.7261*x);f.fillText(t.day,Ct,Jt)}else if(9==M){f.font="normal bold 0.64rem myFirstFont",f.fillStyle="#000",f.textAlign="center";var Nt=Math.floor(.51*s),Rt=Math.floor(.509*x),Ut=Math.floor(.589*x);f.fillText(t.colorPrice,Nt,Rt),f.fillText(t.permPrice,Nt,Ut)}else if(10==M){f.font="normal bold 0.64rem myFirstFont",f.fillStyle="#000",f.textAlign="center";var Yt=Math.floor(.5*s),Lt=Math.floor(.14*s),Wt=Math.floor(.7364*x),jt=Math.floor(.8052*x);f.fillText(t.name,Yt,Wt),f.font="normal bold 0.96rem myFirstFont",f.fillStyle="#324ee9",f.textAlign="left",f.fillText(t.startDate,Lt,jt)}}}function i(t){return document.getElementById(t).getContext("2d")}function n(){t.showcanvas=!1;var e=document.getElementById("main"),l=e.toDataURL("image/jpg");t.canvasImg=l,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var h=JSON.parse(sessionStorage.getItem("user"));t.user=h,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.showmodel=!1,t.canvasImg="",t.name="请添加",t.startTime="13:00",t.endTime="18:00",t.startHour="13",t.startMinute="00",t.endHour="18",t.endMinute="00",t.startMonth="05",t.startDate="01",t.endMonth="05",t.endDate="15",t.colorPrice="88",t.permPrice="88",t.day="2";var s=document.documentElement.clientWidth,m=Math.floor(s),x=Math.floor(1.83*s);$("#main").attr("width",m+"px"),$("#main").attr("height",x+"px"),console.log(t.user);var M=f.num;t.page=1,t.showImg="../../assets/images/notice/type6/img_"+M+".png",t.editInformation=function(t){t.stopPropagation(),o.path("editInformation")},t.useTemplatePage=function(e){e.stopPropagation(),n(),t.showmodel=!0,t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),l.history.back()},t.chengeText=function(){if(!t.showmodel)if(1==M)$(".name-input-fixed").show();else if(2==M)$(".name-input-fixed-1").show();else if(3==M)$(".name-input-fixed-2").show();else if(4==M)$(".name-input-fixed-3").show();else if(5==M)$(".name-input-fixed-4").show();else if(6==M)$(".name-input-fixed-5").show();else{if(7==M)return;8==M?$(".name-input-fixed-7").show():9==M?$(".name-input-fixed-8").show():10==M?$(".name-input-fixed-9").show():11==M&&$(".name-input-fixed-10").show()}},t.updateText=function(){r(),1==M?$(".name-input-fixed").fadeOut(50):2==M?$(".name-input-fixed-1").fadeOut(50):3==M?$(".name-input-fixed-2").fadeOut(50):4==M?$(".name-input-fixed-3").fadeOut(50):5==M?$(".name-input-fixed-4").fadeOut(50):6==M?$(".name-input-fixed-5").fadeOut(50):7==M?$(".name-input-fixed-6").fadeOut(50):8==M?$(".name-input-fixed-7").fadeOut(50):9==M?$(".name-input-fixed-8").fadeOut(50):10==M?$(".name-input-fixed-9").fadeOut(50):11==M&&$(".name-input-fixed-10").fadeOut(50)},t.closeText=function(e){e.stopPropagation(),t.user.iscomplete=!0},$(function(){r()})}]);
index.controller("useCardCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,t,o,r,n){function l(){e.btnText="生成海报",e.showcanvas=!0;var a=new Date,t=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate(),o=a.getMonth()+1;switch(o){case 1:o="J A N";break;case 2:o="F E B";break;case 3:o="M A R";break;case 4:o="A P R";break;case 5:o="M A Y";break;case 6:o="J U N";break;case 7:o="J U L";break;case 8:o="A U G";break;case 9:o="S E P";break;case 10:o="O C T";break;case 11:o="N O V";break;case 12:o="D E C"}var r=a.getDay();switch(r){case 0:r="Sunday";break;case 1:r="Monday";break;case 2:r="Tuesday";break;case 3:r="Wednesday";break;case 4:r="Thursday";break;case 5:r="Friday";break;case 6:r="Saturday"}var n=i("main");n.width,n.height;n.clearRect(0,0,1e3,1e3);var l=new Image;l.src=e.updateImg,l.width=c,l.height="auto";var f=new Image;f.src=e.showImg,f.onload=function(){if(1==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,c,m),n.drawImage(f,0,0,c,m),n.font="normal bold 0.32rem myFirstFont",n.fillStyle="#545454";var i=Math.floor(.07*h),s=Math.floor(.866*m),g=Math.floor(.897*m),u=Math.floor(.923*m);n.fillText(e.user.name,i,s),n.fillText(o+"."+r,i,g),n.fillText(t,i,u)}else if(2==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,e.pinchWidth,e.pinchHeight),n.drawImage(f,0,0,c,m),n.font="normal bold 0.4rem myFirstFont",n.fillStyle="#fff";for(var M=Math.floor(.625*h),b=Math.floor(.826*h),p=Math.floor(.716*m),x=Math.floor(.88*m),y=Math.floor(.92*m),T=0;T<e.user.name.length;T++)n.fillText(e.user.name[T],b,p+Math.floor(.0437*m)*T);n.fillText(o+"."+r,M,x),n.fillText(t,M,y)}else if(3==d){n.font="normal bold 0.42rem myFirstFont",n.fillStyle="white";var v=Math.floor(.066*h),w=Math.floor(.8*h),I=Math.floor(.076*m),k=Math.floor(.105*m),F=Math.floor(.329*m);n.fillText(a.getMonth()+1+"/"+a.getDate(),v,I),n.fillText(r,v,k);for(var S=0;S<e.user.name.length;S++)n.fillText(e.user.name[S],w,F+Math.floor(.0437*m)*S)}else if(4==d){n.font="normal bold 1.333333rem myFirstFont",n.fillStyle="white";var $=Math.floor(.103*h),D=Math.floor(.8*h),Y=Math.floor(.87*m),A=Math.floor(.91*m),E=Math.floor(.947*m),R=Math.floor(.329*m);n.fillText(a.getDate(),$,Y),n.font="normal bold 0.4rem myFirstFont",n.fillText(o+"."+r,$,A),n.fillText(a.getFullYear(),$,E);for(var W=0;W<e.user.name.length;W++)n.fillText(e.user.name[W],D,R+Math.floor(.0437*m)*W)}else if(5==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,e.pinchWidth,e.pinchHeight),n.drawImage(f,0,0,c,m),n.font="normal bold 0.453333rem myFirstFont",n.fillStyle="#545454";var C=Math.floor(.103*h),U=Math.floor(.8*h),X=Math.floor(.9*m),B=Math.floor(.94*m),H=Math.floor(.329*m);n.fillText(o+"."+r,C,X),n.fillText(t,C,B),n.fillStyle="#fff";for(var J=0;J<e.user.name.length;J++)n.fillText(e.user.name[J],U,H+Math.floor(.0437*m)*J)}}}function i(e){return document.getElementById(e).getContext("2d")}function f(){e.showcanvas=!1;var a=document.getElementById("main"),t=a.toDataURL("image/jpg");e.canvasImg=t,$(".changeText").css("display","none"),e.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));e.user=s,e.btnText="生成海报",e.loading=!1,e.showcanvas=!0,e.canvasImg="";var h=document.documentElement.clientWidth,c=Math.floor(h),m=Math.floor(1.83*h);$("#main").attr("width",c+"px"),$("#main").attr("height",m+"px"),e.updateImg="",e.dragX=0,e.dragY=0,e.pinchWidth=1,e.pinchHeight=1,e.user.name.length>=3&&(e.user.name=e.user.name[0]+e.user.name[1]);var d=n.num;e.page=1,e.showImg="../../assets/images/promotion/type4/img_"+d+".png",e.editInformation=function(){o.path("editInformation")},e.useTemplatePage=function(){f(),e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){t.history.back()},e.closeText=function(){e.user.iscomplete=!0},$(".upload").on("change",function(){var a=$(this)[0].files[0];if(a){var t=new FileReader;t.readAsDataURL(a),t.onload=function(){var a=this.result;e.updateImg=a,l()}}}),touch.on("#main","dragend",function(a){e.dragX=a.x,e.dragY=a.y,l()}),touch.on("#main","pinchend",function(a){e.pinchWidth=a.scale,e.pinchHeight=a.scale,l()}),$(function(){l()})}]);
index.controller("useHolidayCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,n,o,a,i){function m(){t.btnText="一键生成海报",t.showcanvas=!0;var e=r("main");e.width,e.height;e.clearRect(0,0,1e3,1e3);var n=new Image;n.src=t.showImg,n.onload=function(){if(e.drawImage(n,0,0,c,g),navigator.userAgent.match(/iphone/i)){if(1==h&&2==u){e.font="normal bold 40px myFirstFont",e.fillStyle="#fff";var o=Math.floor(.153*f),a=Math.floor(.335*g);e.fillText(t.name+"祝您",o,a)}}else if(1==h&&2==u){e.font="normal bold 0.533333rem myFirstFont",e.fillStyle="#fff";var i=Math.floor(.153*f),m=Math.floor(.335*g);e.fillText(t.name+"祝您",i,m)}}}function r(t){return document.getElementById(t).getContext("2d")}function l(){t.showcanvas=!1;var e=document.getElementById("main"),n=e.toDataURL("image/jpg");t.canvasImg=n,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));t.user=s,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.showmodel=!1,t.canvasImg="",t.name="请添加";var f=document.documentElement.clientWidth,c=Math.floor(f),g=Math.floor(1.83*f);$("#main").attr("width",c+"px"),$("#main").attr("height",g+"px"),console.log(t.user),t.name.length>=4&&(t.name=t.name[0]+t.name[1]+t.name[2]);var h=i.type,u=i.num;t.page=1,t.showImg="../../assets/images/holiday/type"+h+"/img_"+u+".png",t.editInformation=function(t){t.stopPropagation(),o.path("editInformation")},t.useTemplatePage=function(e){e.stopPropagation(),l(),t.showmodel=!0,t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),n.history.back()},t.chengeText=function(){t.showmodel||1==h&&2==u&&$(".name-input-fixed").show()},t.updateText=function(){t.name.length>=4&&(t.name=t.name[0]+t.name[1]+t.name[2]),m(),$(".name-input-fixed").fadeOut(50)},t.closeText=function(e){e.stopPropagation(),t.user.iscomplete=!0},$(function(){m()})}]);
index.controller("usejokeCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,o,t,n,s,a){var i=JSON.parse(sessionStorage.getItem("user"));e.user=i,e.btnText="立即使用",e.loading=!1,console.log(e.user);var r=a.type,c=a.num;e.page=1,e.showImg="../../assets/images/joke/type"+r+"/img_"+c+".png",e.editInformation=function(){n.path("editInformation")},e.useTemplatePage=function(){e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){t.history.back()},e.closeText=function(){e.user.iscomplete=!0}}]);
index.controller("useMornCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,l,o,a,r){function f(){t.btnText="立即使用",t.showcanvas=!0;var e=new Date,l=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),o=e.getMonth()+1;switch(o){case 1:o="J A N";break;case 2:o="F E B";break;case 3:o="M A R";break;case 4:o="A P R";break;case 5:o="M A Y";break;case 6:o="J U N";break;case 7:o="J U L";break;case 8:o="A U G";break;case 9:o="S E P";break;case 10:o="O C T";break;case 11:o="N O V";break;case 12:o="D E C"}var a=e.getDay();switch(a){case 0:a="S U N D A Y";break;case 1:a="M O N D A Y";break;case 2:a="T U E S D A Y";break;case 3:a="W E D N E S D A Y";break;case 4:a="T H U R S D A Y";break;case 5:a="F R I D A Y";break;case 6:a="S A T U R D A Y"}var r=n("main");r.width,r.height;r.clearRect(0,0,1e3,1e3);var f=new Image;f.src=t.showImg,f.onload=function(){if(r.drawImage(f,0,0,h,c),navigator.userAgent.match(/iphone/i)){if(1==M){r.font="normal bold 36px myFirstFont",r.fillStyle="black",r.textAlign="right";var n=Math.floor(.744*m),i=Math.floor(.95*c);r.fillText("BY"+t.user.name,n,i)}else if(2==M){r.font="normal bold 30px myFirstFont",r.fillStyle="black";var s=Math.floor(.07*m),x=Math.floor(.906*c),b=Math.floor(.943*c);r.fillText("BY"+t.user.name,s,x),r.fillText(l,s,b)}else if(3==M){r.font="normal bold 100px myFirstFont",r.fillStyle="white";var u=Math.floor(.103*m),T=Math.floor(.87*c),F=Math.floor(.91*c),y=Math.floor(.947*c);r.fillText(e.getDate(),u,T),r.font="normal bold 30px myFirstFont",r.fillText(o+"."+a,u,F),r.fillText("BY"+t.user.name,u,y)}else if(4==M){r.font="normal bold 34px myFirstFont",r.fillStyle="black",r.textAlign="right";var g=Math.floor(.924*m),d=Math.floor(.145*c),v=Math.floor(.184*c),k=Math.floor(.223*c);r.fillText(l,g,d),r.fillText(a,g,v),r.fillText("BY"+t.user.name,g,k)}else if(5==M){r.font="normal bold 34px myFirstFont",r.fillStyle="#7a8776";var S=Math.floor(.773*m),Y=Math.floor(.736*c);r.fillText("BY"+t.user.name,S,Y)}else if(6==M){r.font="normal bold 0.46rem myFirstFont",r.fillStyle="#fff";var p=Math.floor(.047*m),B=Math.floor(.915*c);r.fillText("BY"+t.user.name,p,B)}else if(7==M){r.font="normal bold 30px myFirstFont",r.fillStyle="#000";var A=Math.floor(.07*m),D=Math.floor(.856*c),w=Math.floor(.883*c),I=Math.floor(.91*c);r.fillText(l,A,D),r.fillText(a,A,w),r.fillText("BY"+t.user.name,A,I)}else if(8==M){r.font="normal bold 100px myFirstFont",r.fillStyle="#96bfad";var E=Math.floor(.07*m),$=Math.floor(.106*c),U=Math.floor(.146*c),N=Math.floor(.186*c);r.fillText(e.getDate(),E,$),r.font="normal bold 30px myFirstFont",r.fillText(a,E,U),r.fillText("BY"+t.user.name,E,N)}}else if(1==M){r.font="normal bold 0.48rem myFirstFont",r.fillStyle="black";var R=Math.floor(.544*m),C=Math.floor(.95*c);r.fillText("BY"+t.user.name,R,C)}else if(2==M){r.font="normal bold 0.4rem myFirstFont",r.fillStyle="black";var J=Math.floor(.07*m),O=Math.floor(.906*c),P=Math.floor(.943*c);r.fillText("BY"+t.user.name,J,O),r.fillText(l,J,P)}else if(3==M){r.font="normal bold 1.333333rem myFirstFont",r.fillStyle="white";var L=Math.floor(.103*m),W=Math.floor(.87*c),j=Math.floor(.91*c),G=Math.floor(.947*c);r.fillText(e.getDate(),L,W),r.font="normal bold 0.4rem myFirstFont",r.fillText(o+"."+a,L,j),r.fillText("BY"+t.user.name,L,G)}else if(4==M){r.font="normal bold 0.453333rem myFirstFont",r.fillStyle="black",r.textAlign="right";var H=Math.floor(.924*m),V=Math.floor(.145*c),_=Math.floor(.184*c),q=Math.floor(.223*c);r.fillText(l,H,V),r.fillText(a,H,_),r.fillText("BY"+t.user.name,H,q)}else if(5==M){r.font="normal bold 0.453333rem myFirstFont",r.fillStyle="#7a8776";var z=Math.floor(.773*m),K=Math.floor(.736*c);r.fillText("BY"+t.user.name,z,K)}else if(6==M){r.font="normal bold 0.46rem myFirstFont",r.fillStyle="#fff";var Q=Math.floor(.047*m),X=Math.floor(.915*c);r.fillText("BY"+t.user.name,Q,X)}else if(7==M){r.font="normal bold 0.4rem myFirstFont",r.fillStyle="#000";var Z=Math.floor(.07*m),tt=Math.floor(.856*c),et=Math.floor(.883*c),lt=Math.floor(.91*c);r.fillText(l,Z,tt),r.fillText(a,Z,et),r.fillText("BY"+t.user.name,Z,lt)}else if(8==M){r.font="normal bold 1.333333rem myFirstFont",r.fillStyle="#96bfad";var ot=Math.floor(.07*m),at=Math.floor(.106*c),rt=Math.floor(.146*c),ft=Math.floor(.186*c);r.fillText(e.getDate(),ot,at),r.font="normal bold 0.4rem myFirstFont",r.fillText(a,ot,rt),r.fillText("BY"+t.user.name,ot,ft)}}}function n(t){return document.getElementById(t).getContext("2d")}function i(){t.showcanvas=!1;var e=document.getElementById("main"),l=e.toDataURL("image/jpg");t.canvasImg=l,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));t.user=s,t.btnText="立即使用",t.loading=!1,t.showcanvas=!0,t.canvasImg="";var m=document.documentElement.clientWidth,h=Math.floor(m),c=Math.floor(1.83*m);$("#main").attr("width",h+"px"),$("#main").attr("height",c+"px"),console.log(t.user),t.user.name.length>=3&&(t.user.name=t.user.name[0]+t.user.name[1]+t.user.name[2]);var M=r.type,x=r.num;t.showImg="../../assets/images/morning/type"+M+"/img_"+x+".png",t.editInformation=function(){o.path("editInformation")},t.useTemplatePage=function(){i(),t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(){l.history.back()},t.closeText=function(){t.user.iscomplete=!0},$(function(){f()})}]);
index.controller("useNightCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(l,t,o,e,a,r){function f(){l.btnText="立即使用",l.showcanvas=!0;var t=new Date,o=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),e=t.getMonth()+1;switch(e){case 1:e="J A N";break;case 2:e="F E B";break;case 3:e="M A R";break;case 4:e="A P R";break;case 5:e="M A Y";break;case 6:e="J U N";break;case 7:e="J U L";break;case 8:e="A U G";break;case 9:e="S E P";break;case 10:e="O C T";break;case 11:e="N O V";break;case 12:e="D E C"}var a=t.getDay();switch(a){case 0:a="Sunday";break;case 1:a="Monday";break;case 2:a="Tuesday";break;case 3:a="Wednesday";break;case 4:a="Thursday";break;case 5:a="Friday";break;case 6:a="Saturday"}var r=n("main");r.width,r.height;r.clearRect(0,0,1e3,1e3);var f=new Image;f.src=l.showImg,f.onload=function(){if(r.drawImage(f,0,0,m,M),navigator.userAgent.match(/iphone/i)){if(1==x){r.font="normal bold 24px myFirstFont",r.fillStyle="#545454";var n=Math.floor(.07*s),i=Math.floor(.866*M),h=Math.floor(.897*M),T=Math.floor(.923*M);r.fillText(l.user.name,n,i),r.fillText(e+"."+a,n,h),r.fillText(o,n,T)}else if(2==x){r.font="normal bold 24px myFirstFont",r.fillStyle="#fff";for(var g=Math.floor(.625*s),u=Math.floor(.826*s),y=Math.floor(.716*M),c=Math.floor(.88*M),F=Math.floor(.92*M),d=0;d<l.user.name.length;d++)r.fillText(l.user.name[d],u,y+Math.floor(.0437*M)*d);r.fillText(e+"."+a,g,c),r.fillText(o,g,F)}else if(3==x){r.font="normal bold 24px myFirstFont",r.fillStyle="white";var b=Math.floor(.066*s),v=Math.floor(.8*s),p=Math.floor(.076*M),S=Math.floor(.105*M),k=Math.floor(.329*M);r.fillText(t.getMonth()+1+"/"+t.getDate(),b,p),r.fillText(a,b,S);for(var w=0;w<l.user.name.length;w++)r.fillText(l.user.name[w],v,k+Math.floor(.0437*M)*w)}else if(4==x){r.font="normal bold 100px myFirstFont",r.fillStyle="white";var D=Math.floor(.103*s),I=Math.floor(.8*s),Y=Math.floor(.87*M),$=Math.floor(.91*M),A=Math.floor(.947*M),B=Math.floor(.329*M);r.fillText(t.getDate(),D,Y),r.font="normal bold 24px myFirstFont",r.fillText(e+"."+a,D,$),r.fillText(t.getFullYear(),D,A);for(var E=0;E<l.user.name.length;E++)r.fillText(l.user.name[E],I,B+Math.floor(.0437*M)*E)}else if(5==x){r.font="normal bold 24px myFirstFont",r.fillStyle="#545454";var N=Math.floor(.103*s),C=Math.floor(.8*s),J=Math.floor(.9*M),P=Math.floor(.94*M),R=Math.floor(.329*M);r.fillText(e+"."+a,N,J),r.fillText(o,N,P),r.fillStyle="#fff";for(var U=0;U<l.user.name.length;U++)r.fillText(l.user.name[U],C,R+Math.floor(.0437*M)*U)}else if(6==x){r.font="normal bold 124px myFirstFont",r.fillStyle="#fff";var O=Math.floor(.07*s),L=Math.floor(.479*s),W=Math.floor(.106*M),j=Math.floor(.146*M),G=Math.floor(.186*M),V=Math.floor(.434*M);r.fillText(t.getDate(),O,W),r.font="normal bold 24px myFirstFont",r.fillText(e+"."+a,O,j),r.fillText(t.getFullYear(),O,G);for(var _=0;_<l.user.name.length;_++)r.fillText(l.user.name[_],L,V+Math.floor(.0437*M)*_)}else if(7==x){r.font="normal bold 24px myFirstFont",r.fillStyle="#545454";var q=Math.floor(.066*s),z=Math.floor(.059*M),H=Math.floor(.088*M);r.fillText(e+"."+a,q,z),r.fillText(o,q,H)}else if(8==x){r.font="normal bold 124px myFirstFont",r.fillStyle="#1b273";var K=Math.floor(.08*s),Q=Math.floor(.146*M),X=Math.floor(.186*M),Z=Math.floor(.226*M),ll=Math.floor(.9078*M);r.fillText(t.getDate(),K,Q),r.font="normal bold 24px myFirstFont",r.fillText(e+"."+a,K,X),r.fillText(t.getFullYear(),K,Z),r.fillStyle="#535353",r.fillText("BY"+l.user.name,K,ll)}}else if(1==x){r.font="normal bold 0.32rem myFirstFont",r.fillStyle="#545454";var tl=Math.floor(.07*s),ol=Math.floor(.866*M),el=Math.floor(.897*M),al=Math.floor(.923*M);r.fillText(l.user.name,tl,ol),r.fillText(e+"."+a,tl,el),r.fillText(o,tl,al)}else if(2==x){r.font="normal bold 0.4rem myFirstFont",r.fillStyle="#fff";for(var rl=Math.floor(.625*s),fl=Math.floor(.826*s),nl=Math.floor(.716*M),il=Math.floor(.88*M),hl=Math.floor(.92*M),sl=0;sl<l.user.name.length;sl++)r.fillText(l.user.name[sl],fl,nl+Math.floor(.0437*M)*sl);r.fillText(e+"."+a,rl,il),r.fillText(o,rl,hl)}else if(3==x){r.font="normal bold 0.42rem myFirstFont",r.fillStyle="white";var ml=Math.floor(.066*s),Ml=Math.floor(.8*s),xl=Math.floor(.076*M),Tl=Math.floor(.105*M),gl=Math.floor(.329*M);r.fillText(t.getMonth()+1+"/"+t.getDate(),ml,xl),r.fillText(a,ml,Tl);for(var ul=0;ul<l.user.name.length;ul++)r.fillText(l.user.name[ul],Ml,gl+Math.floor(.0437*M)*ul)}else if(4==x){r.font="normal bold 1.333333rem myFirstFont",r.fillStyle="white";var yl=Math.floor(.103*s),cl=Math.floor(.8*s),Fl=Math.floor(.87*M),dl=Math.floor(.91*M),bl=Math.floor(.947*M),vl=Math.floor(.329*M);r.fillText(t.getDate(),yl,Fl),r.font="normal bold 0.4rem myFirstFont",r.fillText(e+"."+a,yl,dl),r.fillText(t.getFullYear(),yl,bl);for(var pl=0;pl<l.user.name.length;pl++)r.fillText(l.user.name[pl],cl,vl+Math.floor(.0437*M)*pl)}else if(5==x){r.font="normal bold 0.453333rem myFirstFont",r.fillStyle="#545454";var Sl=Math.floor(.103*s),kl=Math.floor(.8*s),wl=Math.floor(.9*M),Dl=Math.floor(.94*M),Il=Math.floor(.329*M);r.fillText(e+"."+a,Sl,wl),r.fillText(o,Sl,Dl),r.fillStyle="#fff";for(var Yl=0;Yl<l.user.name.length;Yl++)r.fillText(l.user.name[Yl],kl,Il+Math.floor(.0437*M)*Yl)}else if(6==x){r.font="normal bold 1.653333rem myFirstFont",r.fillStyle="#fff";var $l=Math.floor(.07*s),Al=Math.floor(.479*s),Bl=Math.floor(.106*M),El=Math.floor(.146*M),Nl=Math.floor(.186*M),Cl=Math.floor(.434*M);r.fillText(t.getDate(),$l,Bl),r.font="normal bold 0.4rem myFirstFont",r.fillText(e+"."+a,$l,El),r.fillText(t.getFullYear(),$l,Nl);for(var Jl=0;Jl<l.user.name.length;Jl++)r.fillText(l.user.name[Jl],Al,Cl+Math.floor(.0437*M)*Jl)}else if(7==x){r.font="normal bold 0.42rem myFirstFont",r.fillStyle="#545454";var Pl=Math.floor(.066*s),Rl=Math.floor(.059*M),Ul=Math.floor(.088*M);r.fillText(e+"."+a,Pl,Rl),r.fillText(o,Pl,Ul)}else if(8==x){r.font="normal bold 1.653333rem myFirstFont",r.fillStyle="#1b273";var Ol=Math.floor(.08*s),Ll=Math.floor(.146*M),Wl=Math.floor(.186*M),jl=Math.floor(.226*M),Gl=Math.floor(.9078*M);r.fillText(t.getDate(),Ol,Ll),r.font="normal bold 0.4rem myFirstFont",r.fillText(e+"."+a,Ol,Wl),r.fillText(t.getFullYear(),Ol,jl),r.fillStyle="#535353",r.fillText("BY"+l.user.name,Ol,Gl)}}}function n(l){return document.getElementById(l).getContext("2d")}function i(){l.showcanvas=!1;var t=document.getElementById("main"),o=t.toDataURL("image/jpg");l.canvasImg=o,l.btnText="长按保存至手机，再发到朋友圈炫耀"}var h=JSON.parse(sessionStorage.getItem("user"));l.user=h,l.btnText="立即使用",l.loading=!1,l.showcanvas=!0,l.canvasImg="";var s=document.documentElement.clientWidth,m=Math.floor(s),M=Math.floor(1.83*s);$("#main").attr("width",m+"px"),$("#main").attr("height",M+"px"),console.log(l.user);var x=r.type,T=r.num;l.page=1,l.showImg="../../assets/images/goodnight/type"+x+"/img_"+T+".png",l.editInformation=function(){e.path("editInformation")},l.useTemplatePage=function(){i(),l.btnText="长按保存至手机，再发到朋友圈炫耀"},l.goBack=function(){o.history.back()},l.closeText=function(){l.user.iscomplete=!0},$(function(){f()})}]);
index.controller("useNoticeCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,o,l,e,a,f){function i(){t.btnText="一键生成海报",t.showcanvas=!0;var o=new Date,l=o.getFullYear()+"/"+(o.getMonth()+1)+"/"+o.getDate(),e=o.getMonth()+1;switch(e){case 1:e="JAN";break;case 2:e="FEB";break;case 3:e="MAR";break;case 4:e="APR";break;case 5:e="MAY";break;case 6:e="JUN";break;case 7:e="JUL";break;case 8:e="AUG";break;case 9:e="SEP";break;case 10:e="OCT";break;case 11:e="NOV";break;case 12:e="DEC"}var a=o.getDay();switch(a){case 0:a="Sunday";break;case 1:a="Monday";break;case 2:a="Tuesday";break;case 3:a="Wednesday";break;case 4:a="Thursday";break;case 5:a="Friday";break;case 6:a="Saturday"}var f=r("main");f.width,f.height;f.clearRect(0,0,1e3,1e3);var i=new Image;i.src=t.showImg,i.onload=function(){if(f.drawImage(i,0,0,h,x),navigator.userAgent.match(/iphone/i)){if(1==d){f.font="normal bold 36px myFirstFont",f.fillStyle="#fff";var o=Math.floor(.1133*s),r=Math.floor(.88*x),n=Math.floor(.91*x),m=Math.floor(.94*x);f.fillText(t.name,o,r),f.font="normal bold 24px myFirstFont",f.fillText(e+"."+a,o,n),f.fillText(l,o,m)}else if(2==d&&1==M){f.font="normal bold 36px myFirstFont",f.fillStyle="#fff";var y=Math.floor(.5733*s),F=Math.floor(.704*s),b=Math.floor(.3999*x),T=Math.floor(.6372*x),u=Math.floor(.6672*x),p=Math.floor(.6972*x);f.fillText(t.zhekou,y,b),f.fillStyle="#333",f.fillText(t.name,F,T),f.font="normal bold 24px myFirstFont",f.fillText(e+"."+a,F,u),f.fillText(l,F,p)}else if(2==d&&2==M){f.font="normal bold 30px myFirstFont",f.fillStyle="#333";var c=Math.floor(.3673*s),g=Math.floor(.211*s),S=Math.floor(.6567*x),v=Math.floor(.8685*x),w=Math.floor(.8985*x),$=Math.floor(.9285*x);f.fillText(t.lijian,c,S),f.font="normal bold 36px myFirstFont",f.fillStyle="#fff",f.fillText(t.name,g,v),f.font="normal bold 24px myFirstFont",f.fillStyle="#333",f.fillText(e+"."+a,g,w),f.fillText(l,g,$)}else if(3==d&&1==M){f.font="normal bold 100px myFirstFont",f.fillStyle="#b8742b";var k=Math.floor(.1917*s),I=Math.floor(.5803*s),O=Math.floor(.113*s),P=Math.floor(.608*x),D=Math.floor(.8785*x),A=Math.floor(.9085*x),E=Math.floor(.9385*x);f.fillText(t.starttime,k,P),f.fillText(t.endtime,I,P),f.font="normal bold 36px myFirstFont",f.fillStyle="#333",f.fillText(t.name,O,D),f.font="normal bold 24px myFirstFont",f.fillText(e+"."+a,O,A),f.fillText(l,O,E)}else if(3==d&&2==M){f.font="normal bold 48px myFirstFont",f.fillStyle="#fff";var N=Math.floor(.246*s),j=Math.floor(.5667*s),B=Math.floor(.113*s),C=Math.floor(.463*x),J=Math.floor(.8785*x),R=Math.floor(.9085*x),U=Math.floor(.9385*x);f.fillText(t.starttime1,N,C),f.fillText(t.endtime1,j,C),f.font="normal bold 36px myFirstFont",f.fillText(t.name,B,J),f.font="normal bold 24px myFirstFont",f.fillText(e+"."+a,B,R),f.fillText(l,B,U)}else if(4==d&&1==M){f.font="normal bold 48px myFirstFont",f.fillStyle="#000";var z=Math.floor(.347*s),_=Math.floor(.58*x);f.fillText(t.discount,z,_)}else if(4==d&&2==M){f.font="normal bold 100px myFirstFont",f.fillStyle="#f02964";var L=Math.floor(.246*s),W=Math.floor(.236*s),Y=Math.floor(.5373*s),G=Math.floor(.422*x),V=Math.floor(.6808*x);f.fillText(t.discount,L,G),f.font="normal bold 36px myFirstFont",f.fillStyle="#333",f.fillText(t.starttime2,W,V),f.fillText(t.endtime2,Y,V)}else if(5==d&&1==M){f.font="normal bold 100px myFirstFont",f.fillStyle="#000";var q=Math.floor(.1426*s),H=Math.floor(.6013*s),K=Math.floor(.31*s),Q=Math.floor(.1333*s),X=Math.floor(.4764*x),Z=Math.floor(.7869*x),tt=(Math.floor(.7669*x),Math.floor(.89*x)),ot=Math.floor(.92*x),lt=Math.floor(.95*x);f.fillText(t.starttime3,q,X),f.fillText(t.endtime3,H,X),f.font="normal bold 36px myFirstFont",f.fillStyle="#fb5b64",f.fillText(t.business,K,Z),f.fillStyle="#333",f.fillText(t.name,Q,tt),f.font="normal bold 24px myFirstFont",f.fillText(e+"."+a,Q,ot),f.fillText(l,Q,lt)}else if(5==d&&2==M){f.font="normal bold 30px myFirstFont",f.fillStyle="#f6c33b";var et=Math.floor(.298*s),at=Math.floor(.415*s),ft=Math.floor(.1333*s),it=Math.floor(.801*x),rt=Math.floor(.89*x),nt=Math.floor(.92*x),mt=Math.floor(.95*x);f.fillText(t.businessMonth,et,it),f.fillText(t.businessDate,at,it),f.fillStyle="#333",f.fillText(t.name,ft,rt),f.font="normal bold 24px myFirstFont",f.fillText(e+"."+a,ft,nt),f.fillText(l,ft,mt)}}else if(1==d){f.font="normal bold 0.48rem myFirstFont",f.fillStyle="#fff";var st=Math.floor(.1133*s),ht=Math.floor(.88*x),xt=Math.floor(.91*x),dt=Math.floor(.94*x);f.fillText(t.name,st,ht),f.font="normal bold 0.32rem myFirstFont",f.fillText(e+"."+a,st,xt),f.fillText(l,st,dt)}else if(2==d&&1==M){f.font="normal bold 0.48rem myFirstFont",f.fillStyle="#fff";var Mt=Math.floor(.5733*s),yt=Math.floor(.704*s),Ft=Math.floor(.3999*x),bt=Math.floor(.6372*x),Tt=Math.floor(.6672*x),ut=Math.floor(.6972*x);f.fillText(t.zhekou,Mt,Ft),f.fillStyle="#333",f.fillText(t.name,yt,bt),f.font="normal bold 0.32rem myFirstFont",f.fillText(e+"."+a,yt,Tt),f.fillText(l,yt,ut)}else if(2==d&&2==M){f.font="normal bold 0.4rem myFirstFont",f.fillStyle="#333";var pt=Math.floor(.3673*s),ct=Math.floor(.211*s),gt=Math.floor(.6567*x),St=Math.floor(.8685*x),vt=Math.floor(.8985*x),wt=Math.floor(.9285*x);f.fillText(t.lijian,pt,gt),f.font="normal bold 0.48rem myFirstFont",f.fillStyle="#fff",f.fillText(t.name,ct,St),f.font="normal bold 0.32rem myFirstFont",f.fillStyle="#333",f.fillText(e+"."+a,ct,vt),f.fillText(l,ct,wt)}else if(3==d&&1==M){f.font="normal bold 1.133333rem myFirstFont",f.fillStyle="#b8742b";var $t=Math.floor(.2017*s),kt=Math.floor(.5803*s),It=Math.floor(.113*s),Ot=Math.floor(.608*x),Pt=Math.floor(.8785*x),Dt=Math.floor(.9085*x),At=Math.floor(.9385*x);f.fillText(t.starttime,$t,Ot),f.fillText(t.endtime,kt,Ot),f.font="normal bold 0.48rem myFirstFont",f.fillStyle="#333",f.fillText(t.name,It,Pt),f.font="normal bold 0.32rem myFirstFont",f.fillText(e+"."+a,It,Dt),f.fillText(l,It,At)}else if(3==d&&2==M){f.font="normal bold 0.64rem myFirstFont",f.fillStyle="#fff";var Et=Math.floor(.246*s),Nt=Math.floor(.5667*s),jt=Math.floor(.113*s),Bt=Math.floor(.463*x),Ct=Math.floor(.8785*x),Jt=Math.floor(.9085*x),Rt=Math.floor(.9385*x);f.fillText(t.starttime1,Et,Bt),f.fillText(t.endtime1,Nt,Bt),f.font="normal bold 0.48rem myFirstFont",f.fillText(t.name,jt,Ct),f.font="normal bold 0.32rem myFirstFont",f.fillText(e+"."+a,jt,Jt),f.fillText(l,jt,Rt)}else if(4==d&&1==M){f.font="normal bold 0.64rem myFirstFont",f.fillStyle="#000";var Ut=Math.floor(.347*s),zt=Math.floor(.58*x);f.fillText(t.discount,Ut,zt)}else if(4==d&&2==M){f.font="normal bold 1.333333rem myFirstFont",f.fillStyle="#f02964";var _t=Math.floor(.246*s),Lt=Math.floor(.236*s),Wt=Math.floor(.5373*s),Yt=Math.floor(.422*x),Gt=Math.floor(.6808*x);f.fillText(t.discount,_t,Yt),f.font="normal bold 0.48rem myFirstFont",f.fillStyle="#333",f.fillText(t.starttime2,Lt,Gt),f.fillText(t.endtime2,Wt,Gt)}else if(5==d&&1==M){f.font="normal bold 1.333333rem myFirstFont",f.fillStyle="#000";var Vt=Math.floor(.1426*s),qt=Math.floor(.6013*s),Ht=Math.floor(.31*s),Kt=Math.floor(.1333*s),Qt=Math.floor(.4764*x),Xt=Math.floor(.7869*x),Zt=(Math.floor(.7669*x),Math.floor(.89*x)),to=Math.floor(.92*x),oo=Math.floor(.95*x);f.fillText(t.starttime3,Vt,Qt),f.fillText(t.endtime3,qt,Qt),f.font="normal bold 0.48rem myFirstFont",f.fillStyle="#fb5b64",f.fillText(t.business,Ht,Xt),f.fillStyle="#333",f.fillText(t.name,Kt,Zt),f.font="normal bold 0.32rem myFirstFont",f.fillText(e+"."+a,Kt,to),f.fillText(l,Kt,oo)}else if(5==d&&2==M){f.font="normal bold 0.48rem myFirstFont",f.fillStyle="#f6c33b";var lo=Math.floor(.298*s),eo=Math.floor(.415*s),ao=Math.floor(.1333*s),fo=Math.floor(.801*x),io=Math.floor(.89*x),ro=Math.floor(.92*x),no=Math.floor(.95*x);f.fillText(t.businessMonth,lo,fo),f.fillText(t.businessDate,eo,fo),f.fillStyle="#333",f.fillText(t.name,ao,io),f.font="normal bold 0.32rem myFirstFont",f.fillText(e+"."+a,ao,ro),f.fillText(l,ao,no)}}}function r(t){return document.getElementById(t).getContext("2d")}function n(){t.showcanvas=!1;var o=document.getElementById("main"),l=o.toDataURL("image/jpg");t.canvasImg=l,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var m=JSON.parse(sessionStorage.getItem("user"));t.user=m,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.showmodel=!1,t.canvasImg="",t.name="请添加",t.zhekou="八",t.lijian="000",t.starttime="08",t.endtime="24",t.starttime1="08:00",t.endtime1="24:00",t.starttime2="2017.05.01",t.endtime2="2017.05.05",t.starttime3="01",t.endtime3="05",t.discount="00",t.business="06",t.businessMonth="05",t.businessDate="01";var s=document.documentElement.clientWidth,h=Math.floor(s),x=Math.floor(1.83*s);$("#main").attr("width",h+"px"),$("#main").attr("height",x+"px"),console.log(t.user);var d=f.type,M=f.num;t.page=1,t.showImg="../../assets/images/notice/type"+d+"/img_"+M+".png",t.editInformation=function(t){t.stopPropagation(),e.path("editInformation")},t.useTemplatePage=function(o){o.stopPropagation(),n(),t.showmodel=!0,t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),l.history.back()},t.chengeText=function(){t.showmodel||(1==d?$(".name-input-fixed").show():2==d&&1==M?$(".name-input-fixed-1").show():2==d&&2==M?$(".name-input-fixed-2").show():3==d&&1==M?$(".name-input-fixed-3").show():3==d&&2==M?$(".name-input-fixed-4").show():4==d&&1==M?$(".name-input-fixed-5").show():4==d&&2==M?$(".name-input-fixed-6").show():5==d&&1==M?$(".name-input-fixed-7").show():5==d&&2==M&&$(".name-input-fixed-8").show())},t.updateText=function(){i(),1==d?$(".name-input-fixed").fadeOut(50):2==d&&1==M?$(".name-input-fixed-1").fadeOut(50):2==d&&2==M?$(".name-input-fixed-2").fadeOut(50):3==d&&1==M?$(".name-input-fixed-3").fadeOut(50):3==d&&2==M?$(".name-input-fixed-4").fadeOut(50):4==d&&1==M?$(".name-input-fixed-5").fadeOut(50):4==d&&2==M?$(".name-input-fixed-6").fadeOut(50):5==d&&1==M?$(".name-input-fixed-7").fadeOut(50):5==d&&2==M&&$(".name-input-fixed-8").fadeOut(50)},t.closeText=function(o){o.stopPropagation(),t.user.iscomplete=!0},t.changeImg=function(o){o.stopPropagation(),t.loading=!0,t.showmodel=!1,t.page>=2?(t.page=1,t.showImg="../../assets/images/notice/type"+M+"/img_"+t.page+".png",t.loading=!1):(t.page+=1,t.showImg="../../assets/images/notice/type"+M+"/img_"+t.page+".png",t.loading=!1),i()},$(function(){i()})}]);
index.controller("useGreetCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,o,e,n,l,a){function f(){t.btnText="一键生成海报",t.showcanvas=!0;var o=i("main");o.width,o.height;o.clearRect(0,0,1e3,1e3);var e=new Image;e.src=t.showImg,e.onload=function(){if(o.drawImage(e,0,0,c,d),navigator.userAgent.match(/iphone/i)){if(1==h&&1==u){o.font="normal bold 72px myFirstFont",o.fillStyle="#fff";var n=Math.floor(.066*m),l=Math.floor(.1466*m),a=Math.floor(.145*d),f=Math.floor(.349*d);o.fillText(t.title,n,a),o.font="normal bold 30px myFirstFont",o.fillStyle="#0f0f0b",o.fillText(t.desc,l,f)}else if(1==h&&2==u){o.font="normal bold 30px myFirstFont",o.fillStyle="#fff";var i=Math.floor(.586*m),r=Math.floor(.731*d),s=Math.floor(.6848*d),g=Math.floor(.638*d);o.fillText(t.desc3,i,r),o.fillText(t.desc2,i,s),o.fillText(t.desc1,i,g)}}else if(1==h&&1==u){o.font="normal bold 0.96rem myFirstFont",o.fillStyle="#fff";var p=Math.floor(.066*m),x=Math.floor(.1466*m),M=Math.floor(.145*d),T=Math.floor(.349*d);o.fillText(t.title,p,M),o.font="normal bold 0.4rem myFirstFont",o.fillStyle="#0f0f0b",o.fillText(t.desc,x,T)}else if(1==h&&2==u){o.font="normal bold 0.4rem myFirstFont",o.fillStyle="#fff";var y=Math.floor(.586*m),v=Math.floor(.731*d),w=Math.floor(.6848*d),b=Math.floor(.638*d);o.fillText(t.desc3,y,v),o.fillText(t.desc2,y,w),o.fillText(t.desc1,y,b)}}}function i(t){return document.getElementById(t).getContext("2d")}function r(){t.showcanvas=!1;var o=document.getElementById("main"),e=o.toDataURL("image/jpg");t.canvasImg=e,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));t.user=s,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.showmodel=!1,t.canvasImg="",t.title="点击添加标题",t.desc="点击添加海报描述",t.desc1="点击添加海报描述",t.desc2="点击添加海报描述",t.desc3="点击添加海报描述";var m=document.documentElement.clientWidth,c=Math.floor(m),d=Math.floor(1.83*m);$("#main").attr("width",c+"px"),$("#main").attr("height",d+"px"),console.log(t.user);var h=a.type,u=a.num;t.page=1,t.showImg="../../assets/images/greet/type"+h+"/img_"+u+".png",t.editInformation=function(t){t.stopPropagation(),n.path("editInformation")},t.useTemplatePage=function(o){o.stopPropagation(),r(),t.showmodel=!0,t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),e.history.back()},t.chengeText=function(){t.showmodel||(1==h&&1==u?$(".name-input-fixed-1").show():1==h&&2==u&&$(".name-input-fixed-2").show())},t.updateText=function(){f(),1==h&&1==u?$(".name-input-fixed-1").fadeOut(50):1==h&&2==u&&$(".name-input-fixed-2").fadeOut(50)},t.closeText=function(o){o.stopPropagation(),t.user.iscomplete=!0},$(function(){f()})}]);
index.controller("vipCenterCtrl",["$scope","$http","$window","$location","$rootScope",function(e,i,t,n,o){i.post("/user/vippage.json",postCfg).then(function(i){if(console.log(i),1===i.data.code){for(var t=i.data.data.viplist,n=0;n<t.length;n++)t[n].selected=!1;e.vipList=i.data.data.viplist}},function(e){}),e.vipid="",e.selectVip=function(i){if(i.selected===!0)i.selected=!1,e.vipid="";else{for(var t=0;t<e.vipList.length;t++)e.vipList[t].selected=!1;i.selected=!0,e.vipid=i.id}},e.showMenu=function(){$(".up-muenu").show()},e.hideMenu=function(){$(".up-muenu").hide()},e.buyVip=function(){return""===e.vipid?(alert("请选择要购买的会员选项"),!1):void i.post("/user/buyvip.json",{vipid:e.vipid},postCfg).success(function(e){if(console.log(e),1===e.code){var t={type:"wz",orderid:e.data.id};i.post("/pay/prepay.json",t,postCfg).success(function(e){if(console.log(e),1===e.code){var i=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:i.appId,timeStamp:i.timeStamp.toString(),nonceStr:i.nonceStr,"package":i["package"],signType:i.signType,paySign:i.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?window.location.href="/yueAssistant/build/html/paySuccess":alert("支付失败,请稍后再试！")})}else 0===e.code}).error(function(e){})}else 0===resp.code}).error(function(e){})}}]);
index.controller("wechatCircleCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,o,t,n,i,s){var a=JSON.parse(sessionStorage.getItem("user"));e.user=a,e.btnText="立即使用",e.loading=!1,console.log(e.user);var r=s.type,c=s.num;e.page=1,e.showImg="../../assets/images/promotion/type"+r+"/img_"+c+".png",e.editInformation=function(){n.path("editInformation")},e.useTemplatePage=function(){e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){t.history.back()},e.closeText=function(){e.user.iscomplete=!0}}]);
index.controller("workHoursCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(t,a,e,i,o,n){var r=new lCalendar;r.init({trigger:".starttime",type:"time"});var s=new lCalendar;s.init({trigger:".endtime",type:"time"});var d=[{name:"星期一",iswork:"0"},{name:"星期二",iswork:"0"},{name:"星期三",iswork:"0"},{name:"星期四",iswork:"0"},{name:"星期五",iswork:"0"},{name:"星期六",iswork:"0"},{name:"星期日",iswork:"0"}];a.post("/user/worktime.json",postCfg).then(function(a){if(-1===a.data.code)t.isLogin=!1,i.path("fast_login");else if(1===a.data.code){t.isLogin=!0,""===a.data.data.starttime||"未知"===a.data.data.starttime?t.starttime="8:00":t.starttime=a.data.data.starttime,""===a.data.data.endtime||"未知"===a.data.data.endtime?t.endtime="22:00":t.endtime=a.data.data.endtime;for(var e=a.data.data.workday,o=0;o<e.length;o++)d[o].iswork=e[o],t.workdayList=d}},function(t){}),t.selectWeek=function(t){1==t.iswork?t.iswork=0:t.iswork=1},t.saveInformation=function(){for(var o="",r=0;r<t.workdayList.length;r++)o+=t.workdayList[r].iswork;var s={workday:o,starttime:t.starttime,endtime:t.endtime};console.log(s),a.post("/user/edit.json",s,postCfg).then(function(t){-1===t.data.code?i.path("fast_login"):1===t.data.code&&n(function(){e.history.back()})},function(t){})}}]);
index.controller("worksCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(o,e,t,n,a,r){function s(){e.post("/user/workslist.json",postCfg).then(function(e){if(console.log(e),1===e.data.code){for(var t=e.data.data.allworks,n=0;n<t.length;n++)t[n].imgurl=picBasePath+t[n].imgurl;o.allworks=[],o.allworks=t;for(var a=e.data.data.recommendworks,r=0;r<a.length;r++)a[r].imgurl=picBasePath+a[r].imgurl;o.recommendworks=[],o.recommendworks=a}},function(o){})}function d(){return 0===o.localId.length?(alert("请选择图片!"),!1):void wx.uploadImage({localId:o.localId[o.upImg],isShowProgressTips:1,success:function(t){o.serverId=[],o.serverId.push(t.serverId);var n={worksmediaid:o.serverId};e.post("/user/uploadworks.json",n,postCfg).then(function(e){1===e.data.code&&(s(),o.upImg<o.localId.length&&(o.upImg+=1,d()))},function(o){})},fail:function(o){}})}o.deleteImg=!1,o.upImg=0,s(),o.deleteRecommendworks=function(o){if(1==o.recommend)return void alert("该作品已在主页展示,请先移除主页作品后再删除照片!");var t={add:[],rm:[o.id]};e.post("/user/setrecommend.json",t,postCfg).then(function(o){1===o.data.code&&s()},function(o){})},o.addAllworks=function(t){if(o.recommendworks.length>=6)return alert("最多只能设置6张图片作为主页作品展示！"),!1;var n={add:[t.id],rm:[]};e.post("/user/setrecommend.json",n,postCfg).then(function(o){console.log(o),1===o.data.code&&s()},function(o){})},o.deleteAllworks=function(o,t){o.stopPropagation();var n={worksid:[t.id]};e.post("/user/deleteworks.json",n,postCfg).then(function(o){1===o.data.code&&s()},function(o){})},o.showDeleteBtn=function(){o.deleteImg=!o.deleteImg},o.showPrompt=function(){alert("请从下方全部作品中选择！")},o.saveWorkImg=function(){r(function(){t.history.back()})};var c={url:t.location.href.split("#")[0]};e.post("/user/unl/wzinfo.json",c,postCfg).then(function(o){1===o.data.code&&wx.config({debug:!1,appId:o.data.data.appid,timestamp:o.data.data.timestamp,nonceStr:o.data.data.noncestr,signature:o.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(o){}),o.updateWorkImg=function(){wx.chooseImage({count:6,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){return o.localId=e.localIds,0===o.localId.length?(alert("请选择图片!"),!1):(o.upImg=0,void d())}})}}]);