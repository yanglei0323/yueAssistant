function showPosition(t){var e=t.coords.latitude,l=t.coords.longitude;localStorage.setItem("positionx",e),localStorage.setItem("positiony",l)}function getUrlParam(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)"),l=window.location.search.substr(1).match(e);return null!==l?unescape(l[2]):null}var transFn=function(t){return $.param(t)},postCfg={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:transFn},picBasePath="http://47.92.29.81:8891",index=angular.module("index",["ngRoute","mobile-angular-ui","mobile-angular-ui.gestures","ngFileUpload","infinite-scroll"]);index.config(["$routeProvider","$locationProvider",function(t,e){e.html5Mode(!0),t.when("/",{templateUrl:"../html/home.html",controller:"homeCtrl"}).when("/personalCenter",{templateUrl:"../html/personalCenter.html",controller:"personalCenterCtrl"}).when("/editInformation",{templateUrl:"../html/editInformation.html",controller:"editInformationCtrl"}).when("/chooseQrcode",{templateUrl:"../html/chooseQrcode.html",controller:"chooseQrcodeCtrl"}).when("/personalTailor",{templateUrl:"../html/personalTailor.html",controller:"personalTailorCtrl"}).when("/tailorData",{templateUrl:"../html/tailorData.html",controller:"tailorDataCtrl"}).when("/payTailor",{templateUrl:"../html/payTailor.html",controller:"payTailorCtrl"}).when("/compeletPayTailor",{templateUrl:"../html/compeletPayTailor.html",controller:"compeletPayTailorCtrl"}).when("/myTailor",{templateUrl:"../html/myTailor.html",controller:"myTailorCtrl"}).when("/vipCenter",{templateUrl:"../html/vipCenter.html",controller:"vipCenterCtrl"}).when("/fast_login",{templateUrl:"../html/fast_login.html",controller:"fastLoginCtrl"}).when("/works",{templateUrl:"../html/works.html",controller:"worksCtrl"}).when("/workHours",{templateUrl:"../html/workHours.html",controller:"workHoursCtrl"}).when("/morningNight",{templateUrl:"../html/morningNight.html",controller:"morningNightCtrl"}).when("/useMorn/:type/:num",{templateUrl:"../html/useMorn.html",controller:"useMornCtrl"}).when("/monList/:num",{templateUrl:"../html/monList.html",controller:"monListCtrl"}).when("/promList/:num",{templateUrl:"../html/promList.html",controller:"promListCtrl"}).when("/nightList/:num",{templateUrl:"../html/nightList.html",controller:"nightListCtrl"}).when("/noticeList/:num",{templateUrl:"../html/noticeList.html",controller:"noticeListCtrl"}).when("/useNight/:type/:num",{templateUrl:"../html/useNight.html",controller:"useNightCtrl"}).when("/useCard/:num",{templateUrl:"../html/useCard.html",controller:"useCardCtrl"}).when("/joke",{templateUrl:"../html/joke.html",controller:"jokeshowCtrl"}).when("/jokeList/:num",{templateUrl:"../html/jokeList.html",controller:"jokeListCtrl"}).when("/usejoke/:type/:num",{templateUrl:"../html/usejoke.html",controller:"usejokeCtrl"}).when("/holiday",{templateUrl:"../html/holiday.html",controller:"holidayCtrl"}).when("/holidayList/:num",{templateUrl:"../html/holidayList.html",controller:"holidayListCtrl"}).when("/greetList/:num",{templateUrl:"../html/greetList.html",controller:"greetListCtrl"}).when("/useHoliday/:type/:num",{templateUrl:"../html/useHoliday.html",controller:"useHolidayCtrl"}).when("/useGreet/:type/:num",{templateUrl:"../html/useGreet.html",controller:"useGreetCtrl"}).when("/wechatCircle/:type/:num",{templateUrl:"../html/wechatCircle.html",controller:"wechatCircleCtrl"}).when("/promotion",{templateUrl:"../html/promotion.html",controller:"promotionCtrl"}).when("/guest",{templateUrl:"../html/guest.html",controller:"guestCtrl"}).when("/homePage/:uuid",{templateUrl:"../html/homePage.html",controller:"homePageCtrl"}).when("/changeHomePage/:num",{templateUrl:"../html/changeHomePage.html",controller:"changeHomePageCtrl"}).when("/life",{templateUrl:"../html/life.html",controller:"lifeCtrl"}).when("/notice",{templateUrl:"../html/notice.html",controller:"noticeCtrl"}).when("/useNotice/:type/:num",{templateUrl:"../html/useNotice.html",controller:"useNoticeCtrl"}).when("/useActive/:num",{templateUrl:"../html/useActive.html",controller:"useActiveCtrl"}).when("/paySuccess",{templateUrl:"../html/paySuccess.html",controller:"paySuccessCtrl"}).otherwise({redirectTo:"/"})}]),function(){var t=getUrlParam("code");if(t){var e={appid:"wx45618195d7038b9d",secret:"7156c0de543979bbb701006487a4e04a",code:t,grant_type:"authorization_code"};$.ajax({url:"/sns/oauth2/access_token",type:"GET",data:e,async:!1,success:function(t){if(t=JSON.parse(t),t.errcode);else{var e={type:"wx",token:t.access_token,openid:t.openid};$.ajax({url:"/user/unl/thirdlogin.json",type:"GET",data:e,async:!1,success:function(t){1===t.code?(sessionStorage.setItem("login","1"),sessionStorage.setItem("user",JSON.stringify(t.data))):2===t.code?window.location.href="fast_login":0===t.code},error:function(t){}})}},error:function(){alert("授权信息获取失败")}})}}();
index.directive("advertise",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.deferred.promise.then(function(t){e.advertiseSwiper=new Swiper(i.get(0),{direction:"horizontal",speed:300,autoplay:4e3,loop:!0,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination"})})}}}]),index.directive("designer",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.designerDeferred.promise.then(function(t){e.designerSwiper=new Swiper(i.get(0),{direction:"horizontal",effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflow:{rotate:0,stretch:0,depth:100,modifier:1,slideShadows:!0}}),e.designerSwiper.slideTo(1,500,!1)})}}}]),index.directive("activity",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.activityDeferred.promise.then(function(t){e.activitySwiper=new Swiper(i.get(0),{direction:"horizontal",speed:300,autoplay:4e3,loop:!0,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination"})})}}}]),index.directive("flashsale",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.flashSaleDeferred.promise.then(function(t){e.falshSaleSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",paginationClickable:!0,freeMode:!0})})}}}]),index.directive("back",["$window",function(e){return{restrict:"A",link:function(i,t,n){t.on("click",function(){e.history.back()})}}}]),index.directive("onFinishRenderFilters",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("ngRepeatFinished")})}}}]),index.directive("onDesignerRenderFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("designerRepeatFinished")})}}}]),index.directive("onFlashSaleRenderFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("flashSaleRepeatFinished")})}}}]),index.directive("onActivityFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("activityFinished")})}}}]),index.directive("forbidScroll",["$timeout",function(e){return{restrict:"A",link:function(e,i,t){i.on("touchmove",function(e){e.preventDefault()})}}}]),index.directive("date",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateDeferred.promise.then(function(t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:3,centeredSlides:!0})})}}}]),index.directive("dateOnly",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateOnlyDeferred.promise.then(function(t){e.timeOnlySwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:5,centeredSlides:!0})})}}}]),index.directive("time",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:3,centeredSlides:!0})}}}]),index.directive("timeSelect",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:5,centeredSlides:!0})}}}]),index.directive("onTimeFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("timeFinished")})}}}]),index.directive("onTimeOnlyFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("timeOnlyFinished")})}}}]),index.directive("dateSelect",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateDeferred.promise.then(function(t){e.dateSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",freeMode:!0})})}}}]),index.directive("onHotSaleFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("hotSaleRepeatFinished")})}}}]),index.directive("hotsale",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.hotSaleDeferred.promise.then(function(t){e.hotSaleSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",paginationClickable:!0,freeMode:!0,observer:!0,observerParents:!0,onReachEnd:function(i){e.hotSalePage+=1,e.getHotSaleRecommend()}})})}}}]),index.directive("commonSwiper",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.commonSwiper=new Swiper(i.get(0),{observer:!0,observerParents:!0})}}}]);
index.controller("changeHomePageCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,s,t,n,o){var i=o.num;e.workTime=[];var r=JSON.parse(sessionStorage.getItem("user")),p=r.uuid;a.post("/user/unl/otherpage.json",{uuid:p},postCfg).then(function(t){if(console.log(t),1===t.data.code){var n=t.data.data;n.avatar=picBasePath+n.avatar,n.qrcode=picBasePath+n.qrcode,n.displaytype=i,e.pointLabel=n.userflags,e.hrefTel="tel:"+n.telephone;for(var o=n.workday,r=0;r<o.length;r++)e.workTime.push(o[r]);for(var d=0;d<n.workslist.length;d++)n.workslist[d]=picBasePath+n.workslist[d];if(e.user=n,console.log(e.user.displaytype),1==e.user.displaytype)return;2==e.user.displaytype?($(".user-info").addClass("user-info2"),$(".line-title-text").addClass("background-333"),$(".line-title-line").addClass("background-333"),$(".call-designer").addClass("background-333"),$(".appointment-btn").addClass("color-333"),$(".dashed-line").addClass("dashed-line-333"),$(".home-page-price").attr("src","../../assets/images/home_page_price1.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time1.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home1.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place1.png")):3==e.user.displaytype&&($(".user-info").addClass("user-info3"),$(".line-title-text").addClass("background-f5a623"),$(".line-title-line").addClass("background-f5a623"),$(".call-designer").addClass("background-f5a623"),$(".appointment-btn").addClass("color-f5a623"),$(".dashed-line").addClass("dashed-line-f5a623"),$(".home-page-price").attr("src","../../assets/images/home_page_price2.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time2.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home2.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place2.png"));var l={url:s.location.href.split("#")[0]};a.post("/user/unl/wzinfo.json",l,postCfg).then(function(a){1===a.data.code&&(wx.config({debug:!1,appId:a.data.data.appid,timestamp:a.data.data.timestamp,nonceStr:a.data.data.noncestr,signature:a.data.data.signature,jsApiList:["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+p,imgUrl:e.user.avatar,type:"link",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+p,imgUrl:e.user.avatar,success:function(){},cancel:function(){}})}))},function(e){})}},function(e){});var d=new Date;e.nowYear=d.getFullYear(),e.appointment=function(){$(".prompt-fixed").show()},e.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},a.post("/user/mypage/share.json",postCfg).then(function(e){console.log(e),1===e.data.code},function(e){}),e.changeHomePage=function(){var n={displaytype:i};a.post("/user/edit.json",n,postCfg).then(function(n){-1===n.data.code?(e.isLogin=!1,t.path("fast_login")):1===n.data.code&&(e.isLogin=!0,a.post("/user/mine.json",postCfg).then(function(a){if(console.log(a),-1===a.data.code)e.isLogin=!1;else if(1===a.data.code){e.isLogin=!0;var t=a.data.data;""===t.avatar?t.avatar="../../assets/images/head-none.png":t.avatar=picBasePath+t.avatar,alert("修改主页风格成功！"),s.history.back()}},function(e){}))},function(e){})}}]);
index.controller("chooseQrcodeCtrl",["$scope","$http","$window","$location","$rootScope",function(a,e,o,t,s){function r(){return 0===a.localId.length?(alert("请选择图片!"),!1):void wx.uploadImage({localId:a.localId[0],isShowProgressTips:1,success:function(o){a.serverId=o.serverId;var t={qrcodemediaid:a.serverId};e.post("/user/edit.json",t,postCfg).then(function(e){if(1===e.data.code){var o=e.data.data;""===o.avatar?o.avatar="../../assets/images/head-none.png":o.avatar=picBasePath+o.avatar,o.qrcode=picBasePath+o.qrcode,a.user=o,sessionStorage.setItem("user",JSON.stringify(c))}else alert(e.data.reason)},function(a){alert("数据请求失败，请稍后再试！")})},fail:function(a){alert("上传失败！")}})}var n={url:o.location.href.split("#")[0]};console.log(n),e.post("/user/unl/wzinfo.json",n,postCfg).then(function(a){1===a.data.code&&(console.log(a),wx.config({debug:!1,appId:a.data.data.appid,timestamp:a.data.data.timestamp,nonceStr:a.data.data.noncestr,signature:a.data.data.signature,jsApiList:["chooseImage","uploadImage"]}))},function(a){});var c=JSON.parse(sessionStorage.getItem("user"));""===c.qrcode?c.qrcode="../../assets/images/edit-headimg.png":c.qrcode=picBasePath+c.qrcode,a.user=c,a.addPhoto=function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){return a.localId=e.localIds,0===a.localId.length?(alert("请选择图片!"),!1):void r()}})},a.upload=function(){o.history.back()}}]);
index.controller("compeletPayTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,o,r,a){var n=JSON.parse(sessionStorage.getItem("user"));e.user=n,t.post("/user/customizedetail.json",postCfg).then(function(t){1===t.data.code&&(e.customizeOrder=t.data.data.order)},function(e){}),e.toPay=function(){var o={type:"wz",orderid:e.customizeOrder.id};t.post("/pay/prepay.json",o,postCfg).success(function(e){if(1===e.code){var t=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp.toString(),nonceStr:t.nonceStr,"package":t["package"],signType:t.signType,paySign:t.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?(alert("支付成功"),r.path("personalTailor")):alert("支付失败"+e.err_msg)})}else 0===e.code&&alert(e.reason)}).error(function(e){alert(e.reason)})}}]);
index.controller("editInformationCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(e,o,t,a,r,i){function n(){return 0===e.localId.length?(alert("请选择头像图片!"),!1):void wx.uploadImage({localId:e.localId[0],isShowProgressTips:1,success:function(t){e.serverId=t.serverId;var a={avatarmediaid:e.serverId};o.post("/user/edit.json",a,postCfg).then(function(o){if(1===o.data.code){var t=o.data.data;""===t.avatar?t.avatar="../../assets/images/head-none.png":t.avatar=picBasePath+t.avatar,e.user=t,sessionStorage.setItem("user",JSON.stringify(t))}else alert(o.data.reason)},function(e){})},fail:function(e){alert("上传失败！")}})}var l=JSON.parse(sessionStorage.getItem("user"));e.user=l,e.name=l.name,e.worktime=l.worktime,null===l.worklevel?e.worklevel="":e.worklevel=l.worklevel.name,e.storename=l.storename,e.storeplace=l.storeplace,e.cutprice=l.cutprice,e.colorpricelow=l.colorpricelow,e.colorpricehigh=l.colorpricehigh,e.permpricelow=l.permpricelow,e.permpricehigh=l.permpricehigh,e.pointLabel=l.flags,e.flagid=[],""!==l.avatar&&"../../assets/images/head-none.png"!==l.avatar||(e.user.avatar="../../assets/images/edit-headimg.png"),""===l.qrcode?e.qrState="(未上传)":e.qrState="(已上传)",o.post("/user/unl/worklevel.json",postCfg).then(function(o){if(1===o.data.code){for(var t=o.data.data.worklevel,a=0;a<t.length;a++)t[a].selected=!1;e.levelList=t}},function(e){}),e.selectLabel=function(e){e.ischoose=!e.ischoose},e.promptFalse=function(){$(".prompt-fixed").fadeOut(),i(function(){t.history.back()})},e.promptTrue=function(){$(".prompt-fixed").fadeOut(10)},e.saveInformation=function(){function t(e){for(var o=new RegExp("[`%~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]"),t="",a=0;a<e.length;a++)t+=e.substr(a,1).replace(o,"");return t}for(var r=0;r<e.pointLabel.length;r++)e.pointLabel[r].ischoose===!0&&e.flagid.push(e.pointLabel[r].id);if(""===e.name||""===e.worktime||""===e.worklevelid||""===e.storename||""===e.storeplace||""===e.cutprice||""===e.colorpricelow||""===e.colorpricehigh||""===e.permpricelow||""===e.permpricehigh||0===e.flagid.length)return void $(".prompt-fixed").show();var i=t(e.name);if(e.name!=i)return void alert("姓名不支持特殊符号，请重新输入！");var n={name:e.name,worktime:e.worktime,worklevelid:e.worklevelid,storename:e.storename,storeplace:e.storeplace,cutprice:e.cutprice,colorpricelow:e.colorpricelow,colorpricehigh:e.colorpricehigh,permpricelow:e.permpricelow,permpricehigh:e.permpricehigh,flagid:e.flagid};o.post("/user/edit.json",n,postCfg).then(function(o){-1===o.data.code?(e.isLogin=!1,a.path("fast_login")):1===o.data.code&&(e.isLogin=!0,a.path("/"))},function(e){})},e.chooseQrcode=function(){window.location.href="/yueAssistant/build/html/chooseQrcode"},e.showLevel=function(){$(".fixed-content").show()},e.selectLevel=function(o){for(var t=0;t<e.levelList.length;t++)e.levelList[t].selected=!1;o.selected=!o.selected,e.worklevelid=o.id,e.worklevel=o.name,$(".fixed-content").fadeOut(10)};var c={url:t.location.href.split("#")[0]};o.post("/user/unl/wzinfo.json",c,postCfg).then(function(e){1===e.data.code&&wx.config({debug:!1,appId:e.data.data.appid,timestamp:e.data.data.timestamp,nonceStr:e.data.data.noncestr,signature:e.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(e){}),e.localId=[],e.addPhoto=function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(o){return e.localId=o.localIds,0===e.localId.length?(alert("请选择图片!"),!1):(e.user.avatar=e.localId[0],void n())}})}}]);
index.controller("fastLoginCtrl",["$scope","$http","$window","$location","$interval","$timeout",function(e,o,t,n,a,d){function i(){return s.test(e.phone)?r.test(e.code)?1:(e.modalText="验证码输入错误",$(".prompt-container").show().fadeOut(2e3),-1):(e.modalText="手机号码有误！",$(".prompt-container").show().fadeOut(2e3),-1)}var s=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/,r=/^\d{4}$/;e.sendCodeText="获取验证码",e.modalText="",e.getCode=function(){return e.sending?void 0:s.test(e.phone)?void o.post("/user/unl/sendlogin.json",{telephone:e.phone},postCfg).then(function(o){if(console.log(o),1===o.data.code){e.sending=!0;var t=60,n=a(function(){t>0?e.sendCodeText="重新发送("+t--+")":(e.sendCodeText="发送验证码",e.sending=!1,a.cancel(n))},1e3)}},function(e){}):(e.modalText="手机号码有误！",void $(".prompt-container").show().fadeOut(2e3))},e.confirmLogin=function(){if(-1!==i()){var n={telephone:e.phone,check:e.code,uuid:e.uuid};o.post("/user/unl/bindtelephone.json",n,postCfg).then(function(o){if(1===o.data.code){var n=o.data.data;sessionStorage.setItem("user",JSON.stringify(n)),d(function(){t.history.back()})}else 0===o.data.code?(e.modalText=o.data.reason,$(".prompt-container").show().fadeOut(2e3)):(e.modalText=o.data.reason,$(".prompt-container").show().fadeOut(2e3))},function(e){alert(e.data.reason)})}}}]);
index.controller("greetListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,t,o,r,s,i){var n=i.num;e.imgList=[];for(var a=1;6>a;a++)e.imgList.push("../../assets/images/greet/sample/type"+n+"/img_"+a+".png");e.useMornTemplate=function(e){r.path("useGreet/"+n+"/"+e)}}]);
index.controller("guestCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,a,i,c){document.title="客照展示";var o=JSON.parse(sessionStorage.getItem("user"));e.user=o,e.activeTab=1,c.activeTab&&(e.activeTab=c.activeTab),e.loading=!1,e.changeTab=function(t){switch(e.activeTab=t,t){case 1:c.activeTab=1;break;case 2:c.activeTab=2}},e.useGuest=function(t){window.location.href="../template/guest/index.html?num="+t+"&uuid="+e.user.uuid}}]);
index.controller("holidayCtrl",["$scope","$http","$window","$location","$rootScope",function(t,a,e,i,o){document.title="节日问候",t.activeTab=1,o.activeTabMorn&&(t.activeTab=o.activeTabMorn),t.changeTab=function(a){switch(t.activeTab=a,a){case 1:o.activeTabMorn=1;break;case 2:o.activeTabMorn=2}},t.useMornTemplate=function(t){i.path("holidayList/"+t)},t.useNightTemplate=function(t){i.path("greetList/"+t)}}]);
index.controller("holidayListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(i,s,o,a,e,t){var n=t.num;if(i.dragon=n,i.imgList=[],6==n)for(var p=1;7>p;p++)i.imgList.push("../../assets/images/holiday/sample/type"+n+"/img_"+p+".png");else for(var r=1;3>r;r++)i.imgList.push("../../assets/images/holiday/sample/type"+n+"/img_"+r+".png");i.useMornTemplate=function(i){a.path("useHoliday/"+n+"/"+i)}}]);
index.controller("homeCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,a,i,n){document.title="小悦助手",t.post("/user/mine.json",postCfg).then(function(t){if(console.log(t),-1===t.data.code)e.isLogin=!1;else if(1===t.data.code){e.isLogin=!0;var a=t.data.data;""===a.avatar?a.avatar="../../assets/images/head-none.png":a.avatar=picBasePath+a.avatar,e.user=a,sessionStorage.setItem("user",JSON.stringify(a))}},function(e){}),e.personalCenter=function(){i.path("personalCenter")},e.setIn=function(){},e.vipCenter=function(){i.path("vipCenter")},e.showTemplate=function(t){if(e.user.iscomplete===!1)return void $(".prompt-fixed").show();switch(t){case 1:i.path("morningNight");break;case 2:i.path("guest");break;case 3:i.path("notice");break;case 4:i.path("promotion");break;case 5:i.path("holiday");break;case 6:i.path("joke");break;case 7:i.path("life")}},e.goHomePage=function(){return e.user.iscomplete===!1?void $(".prompt-fixed").show():void(window.location.href="/yueAssistant/build/html/homePage/"+e.user.uuid)},e.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},e.promptTrue=function(){$(".prompt-fixed").fadeOut(),i.path("editInformation")};var s={url:a.location.href.split("#")[0]};t.post("/user/unl/wzinfo.json",s,postCfg).then(function(e){1===e.data.code&&(wx.config({debug:!1,appId:e.data.data.appid,timestamp:e.data.data.timestamp,nonceStr:e.data.data.noncestr,signature:e.data.data.signature,jsApiList:["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:"美图助手",desc:"美图助手",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx45618195d7038b9d&redirect_uri=http://syrapi.yueyishujia.com/yueAssistant/build/html/&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",imgUrl:"http://syrapi.yueyishujia.com/yueAssistant/assets/images/logo.png",type:"link",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"美图助手",desc:"美图助手",link:"https://open.weixin.qq.com/connect/oauth2/authorize?appid=wx45618195d7038b9d&redirect_uri=http://syrapi.yueyishujia.com/yueAssistant/build/html/&response_type=code&scope=snsapi_userinfo&state=STATE#wechat_redirect",imgUrl:"http://syrapi.yueyishujia.com/yueAssistant/assets/images/logo.png",success:function(){},cancel:function(){}})}))},function(e){})}]);
index.controller("homePageCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,t,s,n,o){document.title="主页形象";var i=o.uuid;e.workTime=[],a.post("/user/unl/otherpage.json",{uuid:i},postCfg).then(function(s){if(console.log(s),1===s.data.code){var n=s.data.data;n.avatar=picBasePath+n.avatar,n.qrcode=picBasePath+n.qrcode,e.pointLabel=n.userflags,e.hrefTel="tel:"+n.telephone;for(var o=n.workday,r=0;r<o.length;r++)e.workTime.push(o[r]);for(var d=0;d<n.workslist.length;d++)n.workslist[d]=picBasePath+n.workslist[d];switch(e.user=n,e.user.displaytype){case 1:break;case 2:$(".user-info").addClass("user-info2"),$(".line-title-text").addClass("background-333"),$(".line-title-line").addClass("background-333"),$(".call-designer").addClass("background-333"),$(".appointment-btn").addClass("color-333"),$(".dashed-line").addClass("dashed-line-333"),$(".home-page-price").attr("src","../../assets/images/home_page_price1.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time1.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home1.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place1.png");break;case 3:$(".user-info").addClass("user-info3"),$(".line-title-text").addClass("background-f5a623"),$(".line-title-line").addClass("background-f5a623"),$(".call-designer").addClass("background-f5a623"),$(".appointment-btn").addClass("color-f5a623"),$(".dashed-line").addClass("dashed-line-f5a623"),$(".home-page-price").attr("src","../../assets/images/home_page_price2.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time2.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home2.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place2.png")}var c={url:t.location.href.split("#")[0]};a.post("/user/unl/wzinfo.json",c,postCfg).then(function(a){1===a.data.code&&(wx.config({debug:!1,appId:a.data.data.appid,timestamp:a.data.data.timestamp,nonceStr:a.data.data.noncestr,signature:a.data.data.signature,jsApiList:["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+i,imgUrl:e.user.avatar,type:"link",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+i,imgUrl:e.user.avatar,success:function(){},cancel:function(){}})}))},function(e){})}},function(e){});var r=new Date;e.nowYear=r.getFullYear(),e.appointment=function(){$(".prompt-fixed").show()},e.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},e.showQrImg=function(){$(".qrcode-fixed-content").show()},e.hideQrImg=function(){$(".qrcode-fixed-content").fadeOut(50)},e.stopPro=function(e){e.stopPropagation()},a.post("/user/mypage/share.json",postCfg).then(function(e){console.log(e),1===e.data.code},function(e){})}]);
index.controller("jokeshowCtrl",["$scope","$http","$window","$location","$rootScope",function(o,t,e,n,c){document.title="段子笑话",o.useTemplate=function(o){n.path("jokeList/"+o)}}]);
index.controller("jokeListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(o,e,t,s,i,n){var a=n.num;o.imgList=[];for(var r=1;11>r;r++)o.imgList.push("../../assets/images/joke/sample/type"+a+"/img_"+r+".png");o.useMornTemplate=function(o){s.path("usejoke/"+a+"/"+o)}}]);
index.controller("lifeCtrl",["$scope","$http","$window","$location","$rootScope",function(e,a,i,t,c){document.title="生活日常";var o=JSON.parse(sessionStorage.getItem("user"));e.user=o,e.activeTab=1,c.activeTablife&&(e.activeTab=c.activeTablife),e.changeTab=function(a){switch(e.activeTab=a,a){case 1:c.activeTablife=1;break;case 2:c.activeTablife=2;break;case 3:c.activeTablife=3}},e.useMornTemplate=function(a){window.location.href="../template/life/index.html?num="+a+"&uuid="+e.user.uuid}}]);
index.controller("monListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(o,t,n,i,e,r){var s=r.num;o.imgList=[];for(var a=1;6>a;a++)o.imgList.push("../../assets/images/morning/type"+s+"/img_"+a+".png");o.useMornTemplate=function(o){i.path("useMorn/"+s+"/"+o)}}]);
index.controller("morningNightCtrl",["$scope","$http","$window","$location","$rootScope",function(t,a,e,n,i){document.title="早晚安",t.activeTab=1,i.activeTabMorn&&(t.activeTab=i.activeTabMorn),t.changeTab=function(a){switch(t.activeTab=a,a){case 1:i.activeTabMorn=1;break;case 2:i.activeTabMorn=2}},t.useMornTemplate=function(t){n.path("monList/"+t)},t.useNightTemplate=function(t){n.path("nightList/"+t)}}]);
index.controller("myTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(o,s,e,t,r){var a=JSON.parse(sessionStorage.getItem("user"));o.user=a,s.post("/user/customizedetail.json",postCfg).then(function(s){if(console.log(s),1===s.data.code){var e=s.data.data.customize;if(o.customizeInfo=e,o.progressFlag=o.customizeInfo.status,o.progressTitle="",o.progressFlag)switch(o.progressFlag){case 1:o.progressTitle="您的预约已经提交";break;case 2:o.progressTitle="已匹配专属编辑";break;case 3:o.progressTitle="编辑正在量身定制";break;case 4:o.progressTitle="您的专属定制已经完成"}}},function(o){}),o.activeTab=1,s.post("/user/customizelist.json",postCfg).then(function(s){if(console.log(s),1===s.data.code){var e=s.data.data.customizelist;for(i=0;i<e.length;i++)e[i].imgurl=picBasePath+e[i].imgurl;o.customizeList=e}},function(o){}),o.showCustomize=function(o){window.location.href=o.jumpurl}}]);
index.controller("nightListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,o,i,n,e,s){var r=s.num;t.imgList=[];for(var a=1;6>a;a++)t.imgList.push("../../assets/images/goodnight/type"+r+"/img_"+a+".png");t.useMornTemplate=function(t){n.path("useNight/"+r+"/"+t)}}]);
index.controller("noticeCtrl",["$scope","$http","$window","$location","$rootScope",function(t,e,a,c,i){document.title="通知海报",t.activeTab=1,i.activeTabMorn&&(t.activeTab=i.activeTabMorn),t.changeTab=function(e){switch(t.activeTab=e,e){case 1:i.activeTabMorn=1;break;case 2:i.activeTabMorn=2}},t.useMornTemplate=function(t){c.path("noticeList/"+t)},t.useNightTemplate=function(t){c.path("useActive/"+t)}}]);
index.controller("noticeListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,o,e,i,n,s){var a=s.num;t.imgList=[];for(var r=1;3>r;r++)t.imgList.push("../../assets/images/notice/sample/type"+a+"/img_"+r+".png");t.useMornTemplate=function(t){i.path("useNotice/"+a+"/"+t)}}]);
index.controller("paySuccessCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(o,t,c,n,e,i){i(function(){n.path("/")},1e3)}]);
index.controller("payTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,r,o,a){e.customizeOrder=a.customizeOrder;var n=JSON.parse(sessionStorage.getItem("user"));e.user=n,e.toPay=function(){var r={type:"wz",orderid:e.customizeOrder.id};t.post("/pay/prepay.json",r,postCfg).success(function(e){if(1===e.code){var t=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp.toString(),nonceStr:t.nonceStr,"package":t["package"],signType:t.signType,paySign:t.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?window.location.href="/yueAssistant/build/html/paySuccess":alert("支付失败，请稍后再试！")})}else 0===e.code&&alert(e.reason)}).error(function(e){alert(e.reason)})}}]);
index.controller("personalCenterCtrl",["$scope","$http","$window","$location","$rootScope",function(o,t,n,a,i){t.post("/user/mine.json",postCfg).then(function(t){if(console.log(t),-1===t.data.code)o.isLogin=!1;else if(1===t.data.code){o.isLogin=!0;var n=t.data.data;""===n.avatar?n.avatar="../../assets/images/head-none.png":n.avatar=picBasePath+n.avatar,o.user=n,sessionStorage.setItem("user",JSON.stringify(n))}},function(o){}),o.editInformation=function(){window.location.href="/yueAssistant/build/html/editInformation"},o.personalTailor=function(){a.path("personalTailor")},o.goVipCenter=function(){a.path("vipCenter")},o.goWorks=function(){window.location.href="/yueAssistant/build/html/works"},o.goWorkHours=function(){a.path("workHours")}}]);
index.controller("personalTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(o,t,a,i,n){t.post("/user/customizepage.json",postCfg).then(function(t){console.log(t),1===t.data.code&&(t.data.data.customizeimgurl=picBasePath+t.data.data.customizeimgurl,o.customizeInfo=t.data.data)},function(o){}),o.tailorData=function(){window.location.href="tailorData"},o.toMyTailor=function(){i.path("myTailor")},o.showCustomize=function(){window.location.href=o.customizeInfo.customizeurl},o.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},o.promptTrue=function(){$(".prompt-fixed").fadeOut(),i.path("compeletPayTailor")}}]);
index.controller("promListCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(o,t,i,e,r,n){var s=n.num;o.imgList=[];for(var a=1;4>a;a++)o.imgList.push("../../assets/images/promotion/type"+s+"/img_"+a+".png");o.useMornTemplate=function(o){e.path("wechatCircle/"+s+"/"+o)}}]);
index.controller("promotionCtrl",["$scope","$http","$window","$location","$rootScope",function(a,e,t,c,i){document.title="个人推广";var o=JSON.parse(sessionStorage.getItem("user"));a.user=o,a.activeTab=2,i.activeTab&&(a.activeTab=i.activeTab),a.loading=!1,a.changeTab=function(e){switch(a.activeTab=e,e){case 1:i.activeTab=1;break;case 2:i.activeTab=2;break;case 3:i.activeTab=3}},a.changeHomePage=function(a){i.activeTab=1,c.path("changeHomePage/"+a)},a.useTemplate=function(a){i.activeTab=3,c.path("promList/"+a)},a.useCard=function(e){i.activeTab=2,window.location.href="../template/card/index.html?num="+e+"&uuid="+a.user.uuid}}]);
index.controller("tailorDataCtrl",["$scope","$http","$window","$location","$rootScope",function(e,i,o,a,d){function t(){wx.uploadImage({localId:e.lifelocalid[e.upImg],isShowProgressTips:1,success:function(i){e.lifeList.push(e.lifelocalid[e.upImg]),$(".update-img-life").prepend("<img src="+e.lifelocalid[e.upImg]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.lifemediaid.push(i.serverId),e.upImg<e.lifelocalid.length&&(e.upImg+=1,t())},fail:function(e){}})}function r(){wx.uploadImage({localId:e.worklocalid[e.upImg],isShowProgressTips:1,success:function(i){e.workList.push(e.worklocalid[e.upImg]),$(".update-img-work").prepend("<img src="+e.worklocalid[e.upImg]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.workmediaid.push(i.serverId),e.upImg<e.worklocalid.length&&(e.upImg+=1,r())},fail:function(e){}})}function l(){wx.uploadImage({localId:e.artlocalid[e.upImg],isShowProgressTips:1,success:function(i){e.artList.push(e.artlocalid[e.upImg]),$(".update-img-art").prepend("<img src="+e.artlocalid[e.upImg]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.artmediaid.push(i.serverId),e.upImg<e.artlocalid.length&&(e.upImg+=1,l())},fail:function(e){}})}function s(){wx.uploadImage({localId:e.goodslocalid[e.upImg],isShowProgressTips:1,success:function(i){e.goodsList.push(e.goodslocalid[e.upImg]),$(".update-img-goods").prepend("<img src="+e.goodslocalid[e.upImg]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.goodsmediaid.push(i.serverId),e.upImg<e.goodslocalid.length&&(e.upImg+=1,s())},fail:function(e){}})}var n={url:o.location.href.split("#")[0]};i.post("/user/unl/wzinfo.json",n,postCfg).then(function(e){1===e.data.code&&wx.config({debug:!1,appId:e.data.data.appid,timestamp:e.data.data.timestamp,nonceStr:e.data.data.noncestr,signature:e.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(e){}),e.lifemediaid=[],e.workmediaid=[],e.artmediaid=[],e.goodsmediaid=[],e.lifeList=[],e.workList=[],e.artList=[],e.goodsList=[],e.upImg=0,e.addLifePhoto=function(){return e.lifemediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.lifelocalid=i.localIds,0===e.lifelocalid.length?(alert("请选择图片!"),!1):(e.upImg=0,void t())}})},e.addWorkPhoto=function(){return e.workmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.worklocalid=i.localIds,0===e.worklocalid.length?(alert("请选择图片!"),!1):(e.upImg=0,void r())}})},e.addArtPhoto=function(){return e.artmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.artlocalid=i.localIds,0===e.artlocalid.length?(alert("请选择图片!"),!1):(e.upImg=0,void l())}})},e.addGoodsPhoto=function(){return e.goodsmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:3,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.goodslocalid=i.localIds,0===e.goodslocalid.length?(alert("请选择图片!"),!1):(e.upImg=0,void s())}})},e.toPayTailor=function(){if(""===e.name||""===e.telephone||""===e.education||""===e.work||""===e.activity||""===e.magazine||""===e.stars||""===e.brand||0===e.lifemediaid.length||0===e.workmediaid.length||0===e.artmediaid.length||0===e.goodsmediaid.length)return alert("有信息尚未填写，请完善后再保存"),!1;var o={name:e.name,telephone:e.telephone,education:e.education,work:e.work,activity:e.activity,magazine:e.magazine,stars:e.stars,brand:e.brand,remark:e.remark,lifemediaid:e.lifemediaid,workmediaid:e.workmediaid,artmediaid:e.artmediaid,goodsmediaid:e.goodsmediaid};i.post("/user/addcustomize.json",o,postCfg).then(function(e){1===e.data.code&&(console.log(e),d.customizeOrder=e.data.data,a.path("payTailor"))},function(e){})}}]);
index.controller("useActiveCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,l,o,a,r){function f(){t.btnText="一键生成海报",t.showcanvas=!0;var e=new Date,l=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),o=e.getMonth()+1;switch(o){case 1:o="JAN";break;case 2:o="FEB";break;case 3:o="MAR";break;case 4:o="APR";break;case 5:o="MAY";break;case 6:o="JUN";break;case 7:o="JUL";break;case 8:o="AUG";break;case 9:o="SEP";break;case 10:o="OCT";break;case 11:o="NOV";break;case 12:o="DEC"}var a=e.getDay();switch(a){case 0:a="Sunday";break;case 1:a="Monday";break;case 2:a="Tuesday";break;case 3:a="Wednesday";break;case 4:a="Thursday";break;case 5:a="Friday";break;case 6:a="Saturday"}var r=new Image;r.src=t.showImg,r.onload=function(){if(M.drawImage(r,0,0,h*g,x*g),navigator.userAgent.match(/iphone/i)){if(1==d){M.drawImage(p,.048*h*g,1142/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 60px myFirstFont",M.fillStyle="#fff",M.textAlign="left";var o=Math.floor(.212*s),a=Math.floor(.5767*s),f=Math.floor(.5*s),i=Math.floor(.394*x),n=Math.floor(.3284*x);M.fillText(t.startTime,o,i),M.fillText(t.endTime,a,i),M.fillStyle="#000",M.textAlign="center",M.fillText(t.name,f,n)}else if(2==d){M.drawImage(p,.408*h*g,1152/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 34px myFirstFont",M.fillStyle="#fff",M.textAlign="center";var m=Math.floor(.5*s),c=(Math.floor(.5667*s),Math.floor(.2267*s)),u=Math.floor(.3017*s),T=Math.floor(.3767*s),y=Math.floor(.6296*s),F=Math.floor(.6996*s),w=Math.floor(.7696*s),b=Math.floor(.1147*x),v=Math.floor(.3082*x),S=Math.floor(.737*x);M.fillText(l,m,b),M.font="normal bold 48px myFirstFont",M.fillStyle="#000",M.fillText(t.name,m,v),M.fillText(t.startHour,c,S),M.fillText(t.startMinute,T,S),M.fillText(t.endHour,y,S),M.fillText(t.endMinute,w,S),M.fillStyle="#fff",M.fillText(":",u,S),M.fillText(":",F,S)}else if(3==d){M.drawImage(p,.408*h*g,1114/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 48px myFirstFont",M.fillStyle="#000",M.textAlign="center";var I=(Math.floor(.5*s),Math.floor(.5667*s),Math.floor(.2267*s)),A=Math.floor(.3017*s),$=Math.floor(.3767*s),k=Math.floor(.6296*s),P=Math.floor(.6996*s),D=Math.floor(.7696*s),O=(Math.floor(.1147*x),Math.floor(.3082*x),Math.floor(.802*x));M.fillText(t.startHour,I,O),M.fillText(t.startMinute,$,O),M.fillText(t.endHour,k,O),M.fillText(t.endMinute,D,O),M.fillText(":",A,O),M.fillText(":",P,O)}else if(4==d){M.drawImage(p,64/750*h*g,1126/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 36px myFirstFont",M.fillStyle="#fff";var R=Math.floor(.747*s),H=Math.floor(.922*x);M.fillText(t.name,R,H)}else if(5==d){M.drawImage(p,.408*h*g,1110/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 72px myFirstFont",M.fillStyle="#244678",M.textAlign="left";var B=Math.floor(.2693*s),E=Math.floor(.522*s),U=Math.floor(.69*s),C=Math.floor(.3355*x),J=Math.floor(.4669*x),L=Math.floor(.616*x),N=Math.floor(.701*x);M.fillText(t.startMonth,B,C),M.fillText(t.startDate,E,C),M.fillText(t.endMonth,B,J),M.fillText(t.endDate,E,J),M.textAlign="center",M.fillStyle="#fff",M.fillText(t.colorPrice,U,L),M.fillText(t.permPrice,U,N)}else if(6==d){M.drawImage(p,52/750*h*g,1130/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 45px myFirstFont",M.fillStyle="#fff",M.textAlign="right";var Y=Math.floor(.951*s),j=Math.floor(.244*x);M.fillText(t.name,Y,j)}else if(7==d){M.drawImage(p,.408*h*g,1143/1334*x*g,14/75*h*g,14/75*h*g);var W=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear();M.font="normal bold 48px myFirstFont",M.fillStyle="#000",M.textAlign="center";var q=Math.floor(.5*s),z=Math.floor(.6587*x);M.fillText(W,q,z)}else if(8==d){M.drawImage(p,.408*h*g,1136/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 300px myFirstFont",M.fillStyle="#af0008",M.textAlign="center";var G=Math.floor(.5*s),V=Math.floor(.7261*x);M.fillText(t.day,G,V)}else if(9==d){M.drawImage(p,.408*h*g,1109/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 48px myFirstFont",M.fillStyle="#000",M.textAlign="center";var _=Math.floor(.51*s),K=Math.floor(.509*x),Q=Math.floor(.589*x);M.fillText(t.colorPrice,_,K),M.fillText(t.permPrice,_,Q)}else if(10==d){M.drawImage(p,.408*h*g,1148/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 48px myFirstFont",M.fillStyle="#000",M.textAlign="center";var X=Math.floor(.5*s),Z=Math.floor(.14*s),tt=Math.floor(.7364*x),et=Math.floor(.8052*x);M.fillText(t.name,X,tt),M.font="normal bold 72px myFirstFont",M.fillStyle="#324ee9",M.textAlign="left",M.fillText(t.startDate,Z,et)}}else if(1==d){M.drawImage(p,.048*h*g,1142/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 0.8rem myFirstFont",M.fillStyle="#fff",M.textAlign="left";var lt=Math.floor(.212*s),ot=Math.floor(.5767*s),at=Math.floor(.5*s),rt=Math.floor(.394*x),ft=Math.floor(.3284*x);M.fillText(t.startTime,lt,rt),M.fillText(t.endTime,ot,rt),M.fillStyle="#000",M.textAlign="center",M.fillText(t.name,at,ft)}else if(2==d){M.drawImage(p,.408*h*g,1152/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 0.453333rem myFirstFont",M.fillStyle="#fff",M.textAlign="center";var it=Math.floor(.5*s),nt=(Math.floor(.5667*s),Math.floor(.2267*s)),mt=Math.floor(.3017*s),st=Math.floor(.3767*s),ht=Math.floor(.6296*s),xt=Math.floor(.6996*s),dt=Math.floor(.7696*s),Mt=Math.floor(.1147*x),ct=Math.floor(.3082*x),gt=Math.floor(.737*x);M.fillText(l,it,Mt),M.font="normal bold 0.533333rem myFirstFont",M.fillStyle="#000",M.fillText(t.name,it,ct),M.fillText(t.startHour,nt,gt),M.fillText(t.startMinute,st,gt),M.fillText(t.endHour,ht,gt),M.fillText(t.endMinute,dt,gt),M.fillStyle="#fff",M.fillText(":",mt,gt),M.fillText(":",xt,gt)}else if(3==d){M.drawImage(p,.408*h*g,1114/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 0.64rem myFirstFont",M.fillStyle="#000",M.textAlign="center";var ut=(Math.floor(.5*s),Math.floor(.5667*s),Math.floor(.2267*s)),Tt=Math.floor(.3017*s),yt=Math.floor(.3767*s),pt=Math.floor(.6296*s),Ft=Math.floor(.6996*s),wt=Math.floor(.7696*s),bt=(Math.floor(.1147*x),Math.floor(.3082*x),Math.floor(.802*x));M.fillText(t.startHour,ut,bt),M.fillText(t.startMinute,yt,bt),M.fillText(t.endHour,pt,bt),M.fillText(t.endMinute,wt,bt),M.fillText(":",Tt,bt),M.fillText(":",Ft,bt)}else if(4==d){M.drawImage(p,64/750*h*g,1126/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 0.48rem myFirstFont",M.fillStyle="#fff";var vt=Math.floor(.747*s),St=Math.floor(.922*x);M.fillText(t.name,vt,St)}else if(5==d){M.drawImage(p,.408*h*g,1110/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 0.96rem myFirstFont",M.fillStyle="#244678",M.textAlign="left";var It=Math.floor(.2693*s),At=Math.floor(.522*s),$t=Math.floor(.69*s),kt=Math.floor(.3355*x),Pt=Math.floor(.4669*x),Dt=Math.floor(.616*x),Ot=Math.floor(.701*x);M.fillText(t.startMonth,It,kt),M.fillText(t.startDate,At,kt),M.fillText(t.endMonth,It,Pt),M.fillText(t.endDate,At,Pt),M.textAlign="center",M.fillStyle="#fff",M.fillText(t.colorPrice,$t,Dt),M.fillText(t.permPrice,$t,Ot)}else if(6==d){M.drawImage(p,52/750*h*g,1130/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 0.6rem myFirstFont",M.fillStyle="#fff",M.textAlign="right";var Rt=Math.floor(.951*s),Ht=Math.floor(.244*x);M.fillText(t.name,Rt,Ht)}else if(7==d){M.drawImage(p,.408*h*g,1143/1334*x*g,14/75*h*g,14/75*h*g);var Bt=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear();M.font="normal bold 0.6rem myFirstFont",M.fillStyle="#000",M.textAlign="center";var Et=Math.floor(.5*s),Ut=Math.floor(.6587*x);M.fillText(Bt,Et,Ut)}else if(8==d){M.drawImage(p,.408*h*g,1136/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 4.0rem myFirstFont",M.fillStyle="#af0008",M.textAlign="center";var Ct=Math.floor(.5*s),Jt=Math.floor(.7261*x);M.fillText(t.day,Ct,Jt)}else if(9==d){M.drawImage(p,.408*h*g,1109/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 0.64rem myFirstFont",M.fillStyle="#000",M.textAlign="center";var Lt=Math.floor(.51*s),Nt=Math.floor(.509*x),Yt=Math.floor(.589*x);M.fillText(t.colorPrice,Lt,Nt),M.fillText(t.permPrice,Lt,Yt)}else if(10==d){M.drawImage(p,.408*h*g,1148/1334*x*g,14/75*h*g,14/75*h*g),M.font="normal bold 0.64rem myFirstFont",M.fillStyle="#000",M.textAlign="center";var jt=Math.floor(.5*s),Wt=Math.floor(.14*s),qt=Math.floor(.7364*x),zt=Math.floor(.8052*x);M.fillText(t.name,jt,qt),M.font="normal bold 0.96rem myFirstFont",M.fillStyle="#324ee9",M.textAlign="left",M.fillText(t.startDate,Wt,zt)}}}function i(t){return document.getElementById(t).getContext("2d")}function n(){t.showcanvas=!1;var e=document.getElementById("main"),l=e.toDataURL("image/jpeg",.7);t.canvasImg=l,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var m=JSON.parse(sessionStorage.getItem("user"));t.fastuse=!0,t.user=m,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.showmodel=!1,t.canvasImg="",t.name="请添加",t.startTime="13:00",t.endTime="18:00",t.startHour="13",t.startMinute="00",t.endHour="18",t.endMinute="00",t.startMonth="05",t.startDate="01",t.endMonth="05",t.endDate="15",t.colorPrice="88",t.permPrice="88",t.day="2";var s=document.documentElement.clientWidth,h=Math.floor(s),x=Math.floor(1.83*s);$("#main").attr("width",h+"px"),$("#main").attr("height",x+"px"),console.log(t.user);var d=r.num;t.page=1,t.showImg="../../assets/images/notice/type6/img_"+d+".png",t.editInformation=function(t){t.stopPropagation(),o.path("editInformation")},t.useTemplatePage=function(e){e.stopPropagation(),n(),t.showmodel=!0,t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),l.history.back()},t.chengeText=function(){if(t.fastuse=!0,!t.showmodel)if(1==d)$(".name-input-fixed").show();else if(2==d)$(".name-input-fixed-1").show();else if(3==d)$(".name-input-fixed-2").show();else if(4==d)$(".name-input-fixed-3").show();else if(5==d)$(".name-input-fixed-4").show();else if(6==d)$(".name-input-fixed-5").show();else{if(7==d)return;8==d?$(".name-input-fixed-7").show():9==d?$(".name-input-fixed-8").show():10==d?$(".name-input-fixed-9").show():11==d&&$(".name-input-fixed-10").show()}},t.updateText=function(){f(),1==d?$(".name-input-fixed").fadeOut(50):2==d?$(".name-input-fixed-1").fadeOut(50):3==d?$(".name-input-fixed-2").fadeOut(50):4==d?$(".name-input-fixed-3").fadeOut(50):5==d?$(".name-input-fixed-4").fadeOut(50):6==d?$(".name-input-fixed-5").fadeOut(50):7==d?$(".name-input-fixed-6").fadeOut(50):8==d?$(".name-input-fixed-7").fadeOut(50):9==d?$(".name-input-fixed-8").fadeOut(50):10==d?$(".name-input-fixed-9").fadeOut(50):11==d&&$(".name-input-fixed-10").fadeOut(50),t.fastuse=!1},t.closeText=function(e){e.stopPropagation(),t.user.iscomplete=!0};var M=i("main");M.width=h,M.height=x;var c=function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},g=c(M);$(function(){f()});var u=$(".hideImg").qrcode({width:200,height:200,correctLevel:0,text:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+t.user.uuid}).hide(),T=u.find("canvas").get(0),y=T.toDataURL("image/jpg"),p=new Image;p.src=y}]);
index.controller("useCardCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,t,o,r,n){function l(){e.btnText="生成海报",e.showcanvas=!0;var a=new Date,t=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate(),o=a.getMonth()+1;switch(o){case 1:o="J A N";break;case 2:o="F E B";break;case 3:o="M A R";break;case 4:o="A P R";break;case 5:o="M A Y";break;case 6:o="J U N";break;case 7:o="J U L";break;case 8:o="A U G";break;case 9:o="S E P";break;case 10:o="O C T";break;case 11:o="N O V";break;case 12:o="D E C"}var r=a.getDay();switch(r){case 0:r="Sunday";break;case 1:r="Monday";break;case 2:r="Tuesday";break;case 3:r="Wednesday";break;case 4:r="Thursday";break;case 5:r="Friday";break;case 6:r="Saturday"}var n=i("main");n.width,n.height;n.clearRect(0,0,1e3,1e3);var l=new Image;l.src=e.updateImg,l.width=c,l.height="auto";var f=new Image;f.src=e.showImg,f.onload=function(){if(1==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,c,m),n.drawImage(f,0,0,c,m),n.font="normal bold 0.32rem myFirstFont",n.fillStyle="#545454";var i=Math.floor(.07*h),s=Math.floor(.866*m),g=Math.floor(.897*m),u=Math.floor(.923*m);n.fillText(e.user.name,i,s),n.fillText(o+"."+r,i,g),n.fillText(t,i,u)}else if(2==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,e.pinchWidth,e.pinchHeight),n.drawImage(f,0,0,c,m),n.font="normal bold 0.4rem myFirstFont",n.fillStyle="#fff";for(var M=Math.floor(.625*h),b=Math.floor(.826*h),p=Math.floor(.716*m),x=Math.floor(.88*m),y=Math.floor(.92*m),T=0;T<e.user.name.length;T++)n.fillText(e.user.name[T],b,p+Math.floor(.0437*m)*T);n.fillText(o+"."+r,M,x),n.fillText(t,M,y)}else if(3==d){n.font="normal bold 0.42rem myFirstFont",n.fillStyle="white";var v=Math.floor(.066*h),w=Math.floor(.8*h),I=Math.floor(.076*m),k=Math.floor(.105*m),F=Math.floor(.329*m);n.fillText(a.getMonth()+1+"/"+a.getDate(),v,I),n.fillText(r,v,k);for(var S=0;S<e.user.name.length;S++)n.fillText(e.user.name[S],w,F+Math.floor(.0437*m)*S)}else if(4==d){n.font="normal bold 1.333333rem myFirstFont",n.fillStyle="white";var $=Math.floor(.103*h),D=Math.floor(.8*h),Y=Math.floor(.87*m),A=Math.floor(.91*m),E=Math.floor(.947*m),R=Math.floor(.329*m);n.fillText(a.getDate(),$,Y),n.font="normal bold 0.4rem myFirstFont",n.fillText(o+"."+r,$,A),n.fillText(a.getFullYear(),$,E);for(var W=0;W<e.user.name.length;W++)n.fillText(e.user.name[W],D,R+Math.floor(.0437*m)*W)}else if(5==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,e.pinchWidth,e.pinchHeight),n.drawImage(f,0,0,c,m),n.font="normal bold 0.453333rem myFirstFont",n.fillStyle="#545454";var C=Math.floor(.103*h),U=Math.floor(.8*h),X=Math.floor(.9*m),B=Math.floor(.94*m),H=Math.floor(.329*m);n.fillText(o+"."+r,C,X),n.fillText(t,C,B),n.fillStyle="#fff";for(var J=0;J<e.user.name.length;J++)n.fillText(e.user.name[J],U,H+Math.floor(.0437*m)*J)}}}function i(e){return document.getElementById(e).getContext("2d")}function f(){e.showcanvas=!1;var a=document.getElementById("main"),t=a.toDataURL("image/jpeg",.7);e.canvasImg=t,$(".changeText").css("display","none"),e.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));e.user=s,e.btnText="生成海报",e.loading=!1,e.showcanvas=!0,e.canvasImg="";var h=document.documentElement.clientWidth,c=Math.floor(h),m=Math.floor(1.83*h);$("#main").attr("width",c+"px"),$("#main").attr("height",m+"px"),e.updateImg="",e.dragX=0,e.dragY=0,e.pinchWidth=1,e.pinchHeight=1,e.user.name.length>=3&&(e.user.name=e.user.name[0]+e.user.name[1]);var d=n.num;e.page=1,e.showImg="../../assets/images/promotion/type4/img_"+d+".png",e.editInformation=function(){o.path("editInformation")},e.useTemplatePage=function(){f(),e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){t.history.back()},e.closeText=function(){e.user.iscomplete=!0},$(".upload").on("change",function(){var a=$(this)[0].files[0];if(a){var t=new FileReader;t.readAsDataURL(a),t.onload=function(){var a=this.result;e.updateImg=a,l()}}}),touch.on("#main","dragend",function(a){e.dragX=a.x,e.dragY=a.y,l()}),touch.on("#main","pinchend",function(a){e.pinchWidth=a.scale,e.pinchHeight=a.scale,l()}),$(function(){l()})}]);
index.controller("useHolidayCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,t,a,o,n,i){function r(){e.btnText="一键生成海报",e.showcanvas=!0;var t=new Image;t.src=e.showImg,t.onload=function(){if(u.drawImage(t,0,0,c*w,d*w),navigator.userAgent.match(/iphone/i))if(1==f&&2==h){u.font="normal bold 40px myFirstFont",u.fillStyle="#fff";var a=Math.floor(.153*g),o=Math.floor(.335*d);u.fillText(e.name+"祝您",a,o)}else 3==f&&1==h?u.drawImage(y,.764*c*w,1137/1334*d*w,14/75*c*w,14/75*c*w):3==f&&2==h?u.drawImage(y,44/750*c*w,1134/1334*d*w,14/75*c*w,14/75*c*w):5==f&&1==h?u.drawImage(y,.048*c*w,1138/1334*d*w,14/75*c*w,14/75*c*w):5==f&&2==h&&u.drawImage(y,.048*c*w,1122/1334*d*w,14/75*c*w,14/75*c*w);else if(1==f&&2==h){u.font="normal bold 0.533333rem myFirstFont",u.fillStyle="#fff";var n=Math.floor(.153*g),i=Math.floor(.335*d);u.fillText(e.name+"祝您",n,i)}else 3==f&&1==h?u.drawImage(y,.764*c*w,1137/1334*d*w,14/75*c*w,14/75*c*w):3==f&&2==h?u.drawImage(y,44/750*c*w,1134/1334*d*w,14/75*c*w,14/75*c*w):5==f&&1==h?u.drawImage(y,.048*c*w,1138/1334*d*w,14/75*c*w,14/75*c*w):5==f&&2==h&&u.drawImage(y,.048*c*w,1122/1334*d*w,14/75*c*w,14/75*c*w)}}function m(e){return document.getElementById(e).getContext("2d")}function l(){e.showcanvas=!1;var t=document.getElementById("main"),a=t.toDataURL("image/jpeg",.7);e.canvasImg=a,e.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));e.user=s,e.btnText="一键生成海报",e.loading=!1,e.showcanvas=!0,e.showmodel=!1,e.canvasImg="",e.name="请添加";var g=document.documentElement.clientWidth,c=Math.floor(g),d=Math.floor(1.83*g);$("#main").attr("width",c+"px"),$("#main").attr("height",d+"px"),console.log(e.user),e.name.length>=4&&(e.name=e.name[0]+e.name[1]+e.name[2]);var f=i.type,h=i.num;e.page=1,e.showImg="../../assets/images/holiday/type"+f+"/img_"+h+".png",e.editInformation=function(e){e.stopPropagation(),o.path("editInformation")},e.useTemplatePage=function(t){t.stopPropagation(),l(),e.showmodel=!0,e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(e){e.stopPropagation(),a.history.back()},e.chengeText=function(){e.showmodel||1==f&&2==h&&$(".name-input-fixed").show()},e.updateText=function(){e.name.length>=4&&(e.name=e.name[0]+e.name[1]+e.name[2]),r(),$(".name-input-fixed").fadeOut(50)},e.closeText=function(t){t.stopPropagation(),e.user.iscomplete=!0};var u=m("main");u.width=c,u.height=d;var p=function(e){var t=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/t},w=p(u);$(function(){r()});var x=$(".hideImg").qrcode({width:200,height:200,correctLevel:0,text:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+e.user.uuid}).hide(),I=x.find("canvas").get(0),v=I.toDataURL("image/jpg"),y=new Image;y.src=v}]);
index.controller("usejokeCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,t,n,o,i){function m(){e.btnText="一键生成海报",e.showcanvas=!0;var a=new Image;a.src=e.showImg,a.onload=function(){w.drawImage(a,0,0,d*I,u*I),navigator.userAgent.match(/iphone/i)?1==h?w.drawImage(P,.408*d*I,1146/1334*u*I,14/75*d*I,14/75*d*I):2==h?w.drawImage(P,.408*d*I,1128/1334*u*I,14/75*d*I,14/75*d*I):3==h?w.drawImage(P,577/750*d*I,1137/1334*u*I,14/75*d*I,14/75*d*I):4==h?w.drawImage(P,.756*d*I,1130/1334*u*I,14/75*d*I,14/75*d*I):5==h&&w.drawImage(P,.408*d*I,1086/1334*u*I,14/75*d*I,14/75*d*I):1==h?w.drawImage(P,.408*d*I,1146/1334*u*I,14/75*d*I,14/75*d*I):2==h?w.drawImage(P,.408*d*I,1128/1334*u*I,14/75*d*I,14/75*d*I):3==h?w.drawImage(P,577/750*d*I,1137/1334*u*I,14/75*d*I,14/75*d*I):4==h?w.drawImage(P,.756*d*I,1130/1334*u*I,14/75*d*I,14/75*d*I):5==h&&w.drawImage(P,.408*d*I,1086/1334*u*I,14/75*d*I,14/75*d*I)}}function r(e){return document.getElementById(e).getContext("2d")}function g(){e.showcanvas=!1;var a=document.getElementById("main"),t=a.toDataURL("image/jpeg",.7);e.canvasImg=t,e.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));e.user=s,e.btnText="一键生成海报",e.loading=!1,e.showcanvas=!0,e.showmodel=!1,e.canvasImg="",e.name="请添加";var c=document.documentElement.clientWidth,d=Math.floor(c),u=Math.floor(1.83*c);$("#main").attr("width",d+"px"),$("#main").attr("height",u+"px"),console.log(e.user),e.name.length>=4&&(e.name=e.name[0]+e.name[1]+e.name[2]);var h=i.type,l=i.num;e.page=1,e.showImg="../../assets/images/joke/type"+h+"/img_"+l+".png",e.editInformation=function(e){e.stopPropagation(),n.path("editInformation")},e.useTemplatePage=function(a){a.stopPropagation(),g(),e.showmodel=!0,e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(e){e.stopPropagation(),t.history.back()},e.chengeText=function(){e.showmodel||1==h&&2==l&&$(".name-input-fixed").show()},e.updateText=function(){e.name.length>=4&&(e.name=e.name[0]+e.name[1]+e.name[2]),m(),$(".name-input-fixed").fadeOut(50)},e.closeText=function(a){a.stopPropagation(),e.user.iscomplete=!0};var w=r("main");w.width=d,w.height=u;var p=function(e){var a=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/a},I=p(w);$(function(){m()});var f=$(".hideImg").qrcode({width:200,height:200,correctLevel:0,text:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+e.user.uuid}).hide(),x=f.find("canvas").get(0),v=x.toDataURL("image/jpg"),P=new Image;P.src=v}]);
index.controller("useMornCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,l,o,a,r){function n(){t.btnText="立即使用",t.showcanvas=!0;var e=new Date,l=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),o=e.getMonth()+1;switch(o){case 1:o="J A N";break;case 2:o="F E B";break;case 3:o="M A R";break;case 4:o="A P R";break;case 5:o="M A Y";break;case 6:o="J U N";break;case 7:o="J U L";break;case 8:o="A U G";break;case 9:o="S E P";break;case 10:o="O C T";break;case 11:o="N O V";break;case 12:o="D E C"}var a=e.getDay();switch(a){case 0:a="S U N D A Y";break;case 1:a="M O N D A Y";break;case 2:a="T U E S D A Y";break;case 3:a="W E D N E S D A Y";break;case 4:a="T H U R S D A Y";break;case 5:a="F R I D A Y";break;case 6:a="S A T U R D A Y"}var r=new Image;r.src=t.showImg,r.onload=function(){if(b.drawImage(r,0,0,h*g,c*g),navigator.userAgent.match(/iphone/i)){if(1==x){b.font="normal bold 36px myFirstFont",b.fillStyle="black",b.textAlign="right";var n=Math.floor(.744*m),f=Math.floor(.95*c);b.fillText("BY"+t.user.name,n,f)}else if(2==x){b.font="normal bold 30px myFirstFont",b.fillStyle="black";var i=Math.floor(.07*m),s=Math.floor(.906*c),M=Math.floor(.943*c);b.fillText("BY"+t.user.name,i,s),b.fillText(l,i,M)}else if(3==x){b.font="normal bold 100px myFirstFont",b.fillStyle="white";var u=Math.floor(.103*m),T=Math.floor(.87*c),F=Math.floor(.91*c),y=Math.floor(.947*c);b.fillText(e.getDate(),u,T),b.font="normal bold 30px myFirstFont",b.fillText(o+"."+a,u,F),b.fillText("BY"+t.user.name,u,y)}else if(4==x){b.font="normal bold 34px myFirstFont",b.fillStyle="black",b.textAlign="right";var d=Math.floor(.924*m),v=Math.floor(.145*c),k=Math.floor(.184*c),S=Math.floor(.223*c);b.fillText(l,d,v),b.fillText(a,d,k),b.fillText("BY"+t.user.name,d,S)}else if(5==x){b.font="normal bold 34px myFirstFont",b.fillStyle="#7a8776";var Y=Math.floor(.773*m),B=Math.floor(.736*c);b.fillText("BY"+t.user.name,Y,B)}else if(6==x){b.font="normal bold 0.46rem myFirstFont",b.fillStyle="#fff";var p=Math.floor(.047*m),w=Math.floor(.915*c);b.fillText("BY"+t.user.name,p,w)}else if(7==x){b.font="normal bold 30px myFirstFont",b.fillStyle="#000";var A=Math.floor(.07*m),D=Math.floor(.856*c),R=Math.floor(.883*c),I=Math.floor(.91*c);b.fillText(l,A,D),b.fillText(a,A,R),b.fillText("BY"+t.user.name,A,I)}else if(8==x){b.font="normal bold 100px myFirstFont",b.fillStyle="#96bfad";var P=Math.floor(.07*m),E=Math.floor(.106*c),$=Math.floor(.146*c),U=Math.floor(.186*c);b.fillText(e.getDate(),P,E),b.font="normal bold 30px myFirstFont",b.fillText(a,P,$),b.fillText("BY"+t.user.name,P,U)}}else if(1==x){b.font="normal bold 0.48rem myFirstFont",b.fillStyle="black";var N=Math.floor(.544*m),C=Math.floor(.95*c);b.fillText("BY"+t.user.name,N,C)}else if(2==x){b.font="normal bold 0.4rem myFirstFont",b.fillStyle="black";var J=Math.floor(.07*m),O=Math.floor(.906*c),L=Math.floor(.943*c);b.fillText("BY"+t.user.name,J,O),b.fillText(l,J,L)}else if(3==x){b.font="normal bold 1.333333rem myFirstFont",b.fillStyle="white";var W=Math.floor(.103*m),j=Math.floor(.87*c),z=Math.floor(.91*c),G=Math.floor(.947*c);b.fillText(e.getDate(),W,j),b.font="normal bold 0.4rem myFirstFont",b.fillText(o+"."+a,W,z),b.fillText("BY"+t.user.name,W,G)}else if(4==x){b.font="normal bold 0.453333rem myFirstFont",b.fillStyle="black",b.textAlign="right";var H=Math.floor(.924*m),V=Math.floor(.145*c),_=Math.floor(.184*c),q=Math.floor(.223*c);b.fillText(l,H,V),b.fillText(a,H,_),b.fillText("BY"+t.user.name,H,q)}else if(5==x){b.font="normal bold 0.453333rem myFirstFont",b.fillStyle="#7a8776";var K=Math.floor(.773*m),Q=Math.floor(.736*c);b.fillText("BY"+t.user.name,K,Q)}else if(6==x){b.font="normal bold 0.46rem myFirstFont",b.fillStyle="#fff";var X=Math.floor(.047*m),Z=Math.floor(.915*c);b.fillText("BY"+t.user.name,X,Z)}else if(7==x){b.font="normal bold 0.4rem myFirstFont",b.fillStyle="#000";var tt=Math.floor(.07*m),et=Math.floor(.856*c),lt=Math.floor(.883*c),ot=Math.floor(.91*c);b.fillText(l,tt,et),b.fillText(a,tt,lt),b.fillText("BY"+t.user.name,tt,ot)}else if(8==x){b.font="normal bold 1.333333rem myFirstFont",b.fillStyle="#96bfad";var at=Math.floor(.07*m),rt=Math.floor(.106*c),nt=Math.floor(.146*c),ft=Math.floor(.186*c);b.fillText(e.getDate(),at,rt),b.font="normal bold 0.4rem myFirstFont",b.fillText(a,at,nt),b.fillText("BY"+t.user.name,at,ft)}}}function f(t){return document.getElementById(t).getContext("2d")}function i(){t.showcanvas=!1;var e=document.getElementById("main"),l=e.toDataURL("image/jpeg",.7);t.canvasImg=l,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));t.user=s,t.btnText="立即使用",t.loading=!1,t.showcanvas=!0,t.canvasImg="";var m=document.documentElement.clientWidth,h=Math.floor(m),c=Math.floor(1.83*m);$("#main").attr("width",h+"px"),$("#main").attr("height",c+"px"),console.log(t.user),t.user.name.length>=3&&(t.user.name=t.user.name[0]+t.user.name[1]+t.user.name[2]);var x=r.type,M=r.num;t.showImg="../../assets/images/morning/type"+x+"/img_"+M+".png",t.editInformation=function(){o.path("editInformation")},t.useTemplatePage=function(){i(),t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(){l.history.back()},t.closeText=function(){t.user.iscomplete=!0};var b=f("main");b.width=h,b.height=c;var u=function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},g=u(b);$(function(){n()})}]);
index.controller("useNightCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,l,o,e,a,r){function f(){t.btnText="立即使用",t.showcanvas=!0;var l=new Date,o=l.getFullYear()+"/"+(l.getMonth()+1)+"/"+l.getDate(),e=l.getMonth()+1;switch(e){case 1:e="J A N";break;case 2:e="F E B";break;case 3:e="M A R";break;case 4:e="A P R";break;case 5:e="M A Y";break;case 6:e="J U N";break;case 7:e="J U L";break;case 8:e="A U G";break;case 9:e="S E P";break;case 10:e="O C T";break;case 11:e="N O V";break;case 12:e="D E C"}var a=l.getDay();switch(a){case 0:a="Sunday";break;case 1:a="Monday";break;case 2:a="Tuesday";break;case 3:a="Wednesday";break;case 4:a="Thursday";break;case 5:a="Friday";break;case 6:a="Saturday"}var r=new Image;r.src=t.showImg,r.onload=function(){if(u.drawImage(r,0,0,m*c,M*c),navigator.userAgent.match(/iphone/i)){if(1==x){u.font="normal bold 24px myFirstFont",u.fillStyle="#545454";var f=Math.floor(.07*s),i=Math.floor(.866*M),n=Math.floor(.897*M),h=Math.floor(.923*M);u.fillText(t.user.name,f,i),u.fillText(e+"."+a,f,n),u.fillText(o,f,h)}else if(2==x){u.font="normal bold 24px myFirstFont",u.fillStyle="#fff";for(var g=Math.floor(.625*s),T=Math.floor(.826*s),y=Math.floor(.716*M),F=Math.floor(.88*M),d=Math.floor(.92*M),b=0;b<t.user.name.length;b++)u.fillText(t.user.name[b],T,y+Math.floor(.0437*M)*b);u.fillText(e+"."+a,g,F),u.fillText(o,g,d)}else if(3==x){u.font="normal bold 24px myFirstFont",u.fillStyle="white";var v=Math.floor(.066*s),S=Math.floor(.8*s),k=Math.floor(.076*M),p=Math.floor(.105*M),w=Math.floor(.329*M);u.fillText(l.getMonth()+1+"/"+l.getDate(),v,k),u.fillText(a,v,p);for(var D=0;D<t.user.name.length;D++)u.fillText(t.user.name[D],S,w+Math.floor(.0437*M)*D)}else if(4==x){u.font="normal bold 100px myFirstFont",u.fillStyle="white";var I=Math.floor(.103*s),P=Math.floor(.8*s),B=Math.floor(.87*M),R=Math.floor(.91*M),Y=Math.floor(.947*M),$=Math.floor(.329*M);u.fillText(l.getDate(),I,B),u.font="normal bold 24px myFirstFont",u.fillText(e+"."+a,I,R),u.fillText(l.getFullYear(),I,Y);for(var A=0;A<t.user.name.length;A++)u.fillText(t.user.name[A],P,$+Math.floor(.0437*M)*A)}else if(5==x){u.font="normal bold 24px myFirstFont",u.fillStyle="#545454";var E=Math.floor(.103*s),N=Math.floor(.8*s),C=Math.floor(.9*M),J=Math.floor(.94*M),U=Math.floor(.329*M);u.fillText(e+"."+a,E,C),u.fillText(o,E,J),u.fillStyle="#fff";for(var O=0;O<t.user.name.length;O++)u.fillText(t.user.name[O],N,U+Math.floor(.0437*M)*O)}else if(6==x){u.font="normal bold 124px myFirstFont",u.fillStyle="#fff";var L=Math.floor(.07*s),W=Math.floor(.479*s),j=Math.floor(.106*M),z=Math.floor(.146*M),G=Math.floor(.186*M),V=Math.floor(.434*M);u.fillText(l.getDate(),L,j),u.font="normal bold 24px myFirstFont",u.fillText(e+"."+a,L,z),u.fillText(l.getFullYear(),L,G);for(var _=0;_<t.user.name.length;_++)u.fillText(t.user.name[_],W,V+Math.floor(.0437*M)*_)}else if(7==x){u.font="normal bold 24px myFirstFont",u.fillStyle="#545454";var q=Math.floor(.066*s),H=Math.floor(.059*M),K=Math.floor(.088*M);u.fillText(e+"."+a,q,H),u.fillText(o,q,K)}else if(8==x){u.font="normal bold 124px myFirstFont",u.fillStyle="#1b273";var Q=Math.floor(.08*s),X=Math.floor(.146*M),Z=Math.floor(.186*M),tt=Math.floor(.226*M),lt=Math.floor(.9078*M);u.fillText(l.getDate(),Q,X),u.font="normal bold 24px myFirstFont",u.fillText(e+"."+a,Q,Z),u.fillText(l.getFullYear(),Q,tt),u.fillStyle="#535353",u.fillText("BY"+t.user.name,Q,lt)}}else if(1==x){u.font="normal bold 0.32rem myFirstFont",u.fillStyle="#545454";var ot=Math.floor(.07*s),et=Math.floor(.866*M),at=Math.floor(.897*M),rt=Math.floor(.923*M);u.fillText(t.user.name,ot,et),u.fillText(e+"."+a,ot,at),u.fillText(o,ot,rt)}else if(2==x){u.font="normal bold 0.4rem myFirstFont",u.fillStyle="#fff";for(var ft=Math.floor(.625*s),it=Math.floor(.826*s),nt=Math.floor(.716*M),ht=Math.floor(.88*M),st=Math.floor(.92*M),mt=0;mt<t.user.name.length;mt++)u.fillText(t.user.name[mt],it,nt+Math.floor(.0437*M)*mt);u.fillText(e+"."+a,ft,ht),u.fillText(o,ft,st)}else if(3==x){u.font="normal bold 0.42rem myFirstFont",u.fillStyle="white";var Mt=Math.floor(.066*s),xt=Math.floor(.8*s),gt=Math.floor(.076*M),ut=Math.floor(.105*M),Tt=Math.floor(.329*M);u.fillText(l.getMonth()+1+"/"+l.getDate(),Mt,gt),u.fillText(a,Mt,ut);for(var ct=0;ct<t.user.name.length;ct++)u.fillText(t.user.name[ct],xt,Tt+Math.floor(.0437*M)*ct)}else if(4==x){u.font="normal bold 1.333333rem myFirstFont",u.fillStyle="white";var yt=Math.floor(.103*s),Ft=Math.floor(.8*s),dt=Math.floor(.87*M),bt=Math.floor(.91*M),vt=Math.floor(.947*M),St=Math.floor(.329*M);u.fillText(l.getDate(),yt,dt),u.font="normal bold 0.4rem myFirstFont",u.fillText(e+"."+a,yt,bt),u.fillText(l.getFullYear(),yt,vt);for(var kt=0;kt<t.user.name.length;kt++)u.fillText(t.user.name[kt],Ft,St+Math.floor(.0437*M)*kt)}else if(5==x){u.font="normal bold 0.453333rem myFirstFont",u.fillStyle="#545454";var pt=Math.floor(.103*s),wt=Math.floor(.8*s),Dt=Math.floor(.9*M),It=Math.floor(.94*M),Pt=Math.floor(.329*M);u.fillText(e+"."+a,pt,Dt),u.fillText(o,pt,It),u.fillStyle="#fff";for(var Bt=0;Bt<t.user.name.length;Bt++)u.fillText(t.user.name[Bt],wt,Pt+Math.floor(.0437*M)*Bt)}else if(6==x){u.font="normal bold 1.653333rem myFirstFont",u.fillStyle="#fff";var Rt=Math.floor(.07*s),Yt=Math.floor(.479*s),$t=Math.floor(.106*M),At=Math.floor(.146*M),Et=Math.floor(.186*M),Nt=Math.floor(.434*M);u.fillText(l.getDate(),Rt,$t),u.font="normal bold 0.4rem myFirstFont",u.fillText(e+"."+a,Rt,At),u.fillText(l.getFullYear(),Rt,Et);for(var Ct=0;Ct<t.user.name.length;Ct++)u.fillText(t.user.name[Ct],Yt,Nt+Math.floor(.0437*M)*Ct)}else if(7==x){u.font="normal bold 0.42rem myFirstFont",u.fillStyle="#545454";var Jt=Math.floor(.066*s),Ut=Math.floor(.059*M),Ot=Math.floor(.088*M);u.fillText(e+"."+a,Jt,Ut),u.fillText(o,Jt,Ot)}else if(8==x){u.font="normal bold 1.653333rem myFirstFont",u.fillStyle="#1b273";var Lt=Math.floor(.08*s),Wt=Math.floor(.146*M),jt=Math.floor(.186*M),zt=Math.floor(.226*M),Gt=Math.floor(.9078*M);u.fillText(l.getDate(),Lt,Wt),u.font="normal bold 0.4rem myFirstFont",u.fillText(e+"."+a,Lt,jt),u.fillText(l.getFullYear(),Lt,zt),u.fillStyle="#535353",u.fillText("BY"+t.user.name,Lt,Gt)}}}function i(t){return document.getElementById(t).getContext("2d")}function n(){t.showcanvas=!1;var l=document.getElementById("main"),o=l.toDataURL("image/jpeg",.7);t.canvasImg=o,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var h=JSON.parse(sessionStorage.getItem("user"));t.user=h,t.btnText="立即使用",t.loading=!1,t.showcanvas=!0,t.canvasImg="";var s=document.documentElement.clientWidth,m=Math.floor(s),M=Math.floor(1.83*s);$("#main").attr("width",m+"px"),$("#main").attr("height",M+"px"),console.log(t.user);var x=r.type,g=r.num;t.page=1,t.showImg="../../assets/images/goodnight/type"+x+"/img_"+g+".png",t.editInformation=function(){e.path("editInformation")},t.useTemplatePage=function(){n(),t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(){o.history.back()},t.closeText=function(){t.user.iscomplete=!0};var u=i("main");u.width=m,u.height=M;var T=function(t){var l=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/l},c=T(u);$(function(){f()})}]);
index.controller("useNoticeCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,o,l,e,a,f){function i(){t.btnText="一键生成海报",t.showcanvas=!0;var o=new Date,l=o.getFullYear()+"/"+(o.getMonth()+1)+"/"+o.getDate(),e=o.getMonth()+1;switch(e){case 1:e="JAN";break;case 2:e="FEB";break;case 3:e="MAR";break;case 4:e="APR";break;case 5:e="MAY";break;case 6:e="JUN";break;case 7:e="JUL";break;case 8:e="AUG";break;case 9:e="SEP";break;case 10:e="OCT";break;case 11:e="NOV";break;case 12:e="DEC"}var a=o.getDay();switch(a){case 0:a="Sunday";break;case 1:a="Monday";break;case 2:a="Tuesday";break;case 3:a="Wednesday";break;case 4:a="Thursday";break;case 5:a="Friday";break;case 6:a="Saturday"}var f=new Image;f.src=t.showImg,f.onload=function(){if(y.drawImage(f,0,0,h*b,d*b),navigator.userAgent.match(/iphone/i)){if(1==x){y.font="normal bold 36px myFirstFont",y.fillStyle="#fff";var o=Math.floor(.1133*s),i=Math.floor(.88*d),r=Math.floor(.91*d),n=Math.floor(.94*d);y.fillText(t.name,o,i),y.font="normal bold 24px myFirstFont",y.fillText(e+"."+a,o,r),y.fillText(l,o,n)}else if(2==x&&1==M){y.drawImage(c,8/75*h*b,1106/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 36px myFirstFont",y.fillStyle="#fff";var m=Math.floor(.5733*s),u=Math.floor(.704*s),F=Math.floor(.3999*d),g=Math.floor(.6372*d),T=Math.floor(.6672*d),p=Math.floor(.6972*d);y.fillText(t.zhekou,m,F),y.fillStyle="#333",y.fillText(t.name,u,g),y.font="normal bold 24px myFirstFont",y.fillText(e+"."+a,u,T),y.fillText(l,u,p)}else if(2==x&&2==M){y.drawImage(c,.744*h*b,1120/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 30px myFirstFont",y.fillStyle="#333";var w=Math.floor(.3673*s),S=Math.floor(.211*s),v=Math.floor(.6567*d),I=Math.floor(.8685*d),k=Math.floor(.8985*d),$=Math.floor(.9285*d);y.fillText(t.lijian,w,v),y.font="normal bold 36px myFirstFont",y.fillStyle="#fff",y.fillText(t.name,S,I),y.font="normal bold 24px myFirstFont",y.fillStyle="#333",y.fillText(e+"."+a,S,k),y.fillText(l,S,$)}else if(3==x&&1==M){y.drawImage(c,.74*h*b,1119/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 100px myFirstFont",y.fillStyle="#b8742b";var P=Math.floor(.1917*s),O=Math.floor(.5803*s),R=Math.floor(.113*s),D=Math.floor(.608*d),B=Math.floor(.8785*d),A=Math.floor(.9085*d),j=Math.floor(.9385*d);y.fillText(t.starttime,P,D),y.fillText(t.endtime,O,D),y.font="normal bold 36px myFirstFont",y.fillStyle="#333",y.fillText(t.name,R,B),y.font="normal bold 24px myFirstFont",y.fillText(e+"."+a,R,A),y.fillText(l,R,j)}else if(3==x&&2==M){y.drawImage(c,.408*h*b,786/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 48px myFirstFont",y.fillStyle="#fff";var E=Math.floor(.246*s),N=Math.floor(.5667*s),U=Math.floor(.113*s),z=Math.floor(.463*d),C=Math.floor(.8785*d),J=Math.floor(.9085*d),L=Math.floor(.9385*d);y.fillText(t.starttime1,E,z),y.fillText(t.endtime1,N,z),y.font="normal bold 36px myFirstFont",y.fillText(t.name,U,C),y.font="normal bold 24px myFirstFont",y.fillText(e+"."+a,U,J),y.fillText(l,U,L)}else if(4==x&&1==M){y.drawImage(c,.408*h*b,1079/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 48px myFirstFont",y.fillStyle="#000";var _=Math.floor(.347*s),W=Math.floor(.58*d);y.fillText(t.discount,_,W)}else if(4==x&&2==M){y.drawImage(c,.408*h*b,1090/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 100px myFirstFont",y.fillStyle="#f02964";var Y=Math.floor(.246*s),q=Math.floor(.236*s),G=Math.floor(.5373*s),V=Math.floor(.422*d),H=Math.floor(.6808*d);y.fillText(t.discount,Y,V),y.font="normal bold 36px myFirstFont",y.fillStyle="#333",y.fillText(t.starttime2,q,H),y.fillText(t.endtime2,G,H)}else if(5==x&&1==M){y.drawImage(c,550/750*h*b,1110/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 100px myFirstFont",y.fillStyle="#000";var K=Math.floor(.1426*s),Q=Math.floor(.6013*s),X=Math.floor(.31*s),Z=Math.floor(.1333*s),tt=Math.floor(.4764*d),ot=Math.floor(.7869*d),lt=(Math.floor(.7669*d),Math.floor(.89*d)),et=Math.floor(.92*d),at=Math.floor(.95*d);y.fillText(t.starttime3,K,tt),y.fillText(t.endtime3,Q,tt),y.font="normal bold 36px myFirstFont",y.fillStyle="#fb5b64",y.fillText(t.business,X,ot),y.fillStyle="#333",y.fillText(t.name,Z,lt),y.font="normal bold 24px myFirstFont",y.fillText(e+"."+a,Z,et),y.fillText(l,Z,at)}else if(5==x&&2==M){y.drawImage(c,551/750*h*b,1111/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 30px myFirstFont",y.fillStyle="#f6c33b";var ft=Math.floor(.298*s),it=Math.floor(.415*s),rt=Math.floor(.1333*s),nt=Math.floor(.801*d),mt=Math.floor(.89*d),st=Math.floor(.92*d),ht=Math.floor(.95*d);y.fillText(t.businessMonth,ft,nt),y.fillText(t.businessDate,it,nt),y.fillStyle="#333",y.fillText(t.name,rt,mt),y.font="normal bold 24px myFirstFont",y.fillText(e+"."+a,rt,st),y.fillText(l,rt,ht)}}else if(1==x){y.font="normal bold 0.48rem myFirstFont",y.fillStyle="#fff";var dt=Math.floor(.1133*s),xt=Math.floor(.88*d),Mt=Math.floor(.91*d),yt=Math.floor(.94*d);y.fillText(t.name,dt,xt),y.font="normal bold 0.32rem myFirstFont",y.fillText(e+"."+a,dt,Mt),y.fillText(l,dt,yt)}else if(2==x&&1==M){y.drawImage(c,8/75*h*b,1106/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 0.48rem myFirstFont",y.fillStyle="#fff";var ut=Math.floor(.5733*s),bt=Math.floor(.704*s),Ft=Math.floor(.3999*d),gt=Math.floor(.6372*d),Tt=Math.floor(.6672*d),ct=Math.floor(.6972*d);y.fillText(t.zhekou,ut,Ft),y.fillStyle="#333",y.fillText(t.name,bt,gt),y.font="normal bold 0.32rem myFirstFont",y.fillText(e+"."+a,bt,Tt),y.fillText(l,bt,ct)}else if(2==x&&2==M){y.drawImage(c,.744*h*b,1120/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 0.4rem myFirstFont",y.fillStyle="#333";var pt=Math.floor(.3673*s),wt=Math.floor(.211*s),St=Math.floor(.6567*d),vt=Math.floor(.8685*d),It=Math.floor(.8985*d),kt=Math.floor(.9285*d);y.fillText(t.lijian,pt,St),y.font="normal bold 0.48rem myFirstFont",y.fillStyle="#fff",y.fillText(t.name,wt,vt),y.font="normal bold 0.32rem myFirstFont",y.fillStyle="#333",y.fillText(e+"."+a,wt,It),y.fillText(l,wt,kt)}else if(3==x&&1==M){y.drawImage(c,.74*h*b,1119/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 1.133333rem myFirstFont",y.fillStyle="#b8742b";var $t=Math.floor(.2017*s),Pt=Math.floor(.5803*s),Ot=Math.floor(.113*s),Rt=Math.floor(.608*d),Dt=Math.floor(.8785*d),Bt=Math.floor(.9085*d),At=Math.floor(.9385*d);y.fillText(t.starttime,$t,Rt),y.fillText(t.endtime,Pt,Rt),y.font="normal bold 0.48rem myFirstFont",y.fillStyle="#333",y.fillText(t.name,Ot,Dt),y.font="normal bold 0.32rem myFirstFont",y.fillText(e+"."+a,Ot,Bt),y.fillText(l,Ot,At)}else if(3==x&&2==M){y.drawImage(c,.408*h*b,786/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 0.64rem myFirstFont",y.fillStyle="#fff";var jt=Math.floor(.246*s),Et=Math.floor(.5667*s),Nt=Math.floor(.113*s),Ut=Math.floor(.463*d),zt=Math.floor(.8785*d),Ct=Math.floor(.9085*d),Jt=Math.floor(.9385*d);y.fillText(t.starttime1,jt,Ut),y.fillText(t.endtime1,Et,Ut),y.font="normal bold 0.48rem myFirstFont",y.fillText(t.name,Nt,zt),y.font="normal bold 0.32rem myFirstFont",y.fillText(e+"."+a,Nt,Ct),y.fillText(l,Nt,Jt)}else if(4==x&&1==M){y.drawImage(c,.408*h*b,1079/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 0.64rem myFirstFont",y.fillStyle="#000";var Lt=Math.floor(.347*s),_t=Math.floor(.58*d);y.fillText(t.discount,Lt,_t)}else if(4==x&&2==M){y.drawImage(c,.408*h*b,1090/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 1.333333rem myFirstFont",y.fillStyle="#f02964";var Wt=Math.floor(.246*s),Yt=Math.floor(.236*s),qt=Math.floor(.5373*s),Gt=Math.floor(.422*d),Vt=Math.floor(.6808*d);y.fillText(t.discount,Wt,Gt),y.font="normal bold 0.48rem myFirstFont",y.fillStyle="#333",y.fillText(t.starttime2,Yt,Vt),y.fillText(t.endtime2,qt,Vt)}else if(5==x&&1==M){y.drawImage(c,550/750*h*b,1110/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 1.333333rem myFirstFont",y.fillStyle="#000";var Ht=Math.floor(.1426*s),Kt=Math.floor(.6013*s),Qt=Math.floor(.31*s),Xt=Math.floor(.1333*s),Zt=Math.floor(.4764*d),to=Math.floor(.7869*d),oo=(Math.floor(.7669*d),Math.floor(.89*d)),lo=Math.floor(.92*d),eo=Math.floor(.95*d);y.fillText(t.starttime3,Ht,Zt),y.fillText(t.endtime3,Kt,Zt),y.font="normal bold 0.48rem myFirstFont",y.fillStyle="#fb5b64",y.fillText(t.business,Qt,to),y.fillStyle="#333",y.fillText(t.name,Xt,oo),y.font="normal bold 0.32rem myFirstFont",y.fillText(e+"."+a,Xt,lo),y.fillText(l,Xt,eo)}else if(5==x&&2==M){y.drawImage(c,551/750*h*b,1111/1334*d*b,14/75*h*b,14/75*h*b),y.font="normal bold 0.48rem myFirstFont",y.fillStyle="#f6c33b";var ao=Math.floor(.298*s),fo=Math.floor(.415*s),io=Math.floor(.1333*s),ro=Math.floor(.801*d),no=Math.floor(.89*d),mo=Math.floor(.92*d),so=Math.floor(.95*d);y.fillText(t.businessMonth,ao,ro),y.fillText(t.businessDate,fo,ro),y.fillStyle="#333",y.fillText(t.name,io,no),y.font="normal bold 0.32rem myFirstFont",y.fillText(e+"."+a,io,mo),y.fillText(l,io,so)}}}function r(t){return document.getElementById(t).getContext("2d")}function n(){t.showcanvas=!1;var o=document.getElementById("main"),l=o.toDataURL("image/jpeg",.7);t.canvasImg=l,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var m=JSON.parse(sessionStorage.getItem("user"));t.fastuse=!0,t.user=m,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.showmodel=!1,t.canvasImg="",t.name="请添加",t.zhekou="八",t.lijian="000",t.starttime="08",t.endtime="24",t.starttime1="08:00",t.endtime1="24:00",t.starttime2="2017.05.01",t.endtime2="2017.05.05",t.starttime3="01",t.endtime3="05",t.discount="00",t.business="06",t.businessMonth="05",t.businessDate="01";var s=document.documentElement.clientWidth,h=Math.floor(s),d=Math.floor(1.83*s);$("#main").attr("width",h+"px"),$("#main").attr("height",d+"px"),console.log(t.user);var x=f.type,M=f.num;t.page=1,t.showImg="../../assets/images/notice/type"+x+"/img_"+M+".png",t.editInformation=function(t){t.stopPropagation(),e.path("editInformation")},t.useTemplatePage=function(o){o.stopPropagation(),n(),t.showmodel=!0,t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),l.history.back()},t.chengeText=function(){t.fastuse=!0,t.showmodel||(1==x?$(".name-input-fixed").show():2==x&&1==M?$(".name-input-fixed-1").show():2==x&&2==M?$(".name-input-fixed-2").show():3==x&&1==M?$(".name-input-fixed-3").show():3==x&&2==M?$(".name-input-fixed-4").show():4==x&&1==M?$(".name-input-fixed-5").show():4==x&&2==M?$(".name-input-fixed-6").show():5==x&&1==M?$(".name-input-fixed-7").show():5==x&&2==M&&$(".name-input-fixed-8").show())},t.updateText=function(){i(),1==x?$(".name-input-fixed").fadeOut(50):2==x&&1==M?$(".name-input-fixed-1").fadeOut(50):2==x&&2==M?$(".name-input-fixed-2").fadeOut(50):3==x&&1==M?$(".name-input-fixed-3").fadeOut(50):3==x&&2==M?$(".name-input-fixed-4").fadeOut(50):4==x&&1==M?$(".name-input-fixed-5").fadeOut(50):4==x&&2==M?$(".name-input-fixed-6").fadeOut(50):5==x&&1==M?$(".name-input-fixed-7").fadeOut(50):5==x&&2==M&&$(".name-input-fixed-8").fadeOut(50),t.fastuse=!1},t.closeText=function(o){o.stopPropagation(),t.user.iscomplete=!0},t.changeImg=function(o){o.stopPropagation(),t.loading=!0,t.showmodel=!1,t.page>=2?(t.page=1,t.showImg="../../assets/images/notice/type"+M+"/img_"+t.page+".png",t.loading=!1):(t.page+=1,t.showImg="../../assets/images/notice/type"+M+"/img_"+t.page+".png",t.loading=!1),i()};var y=r("main");y.width=h,y.height=d;var u=function(t){var o=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/o},b=u(y);$(function(){i()});var F=$(".hideImg").qrcode({width:200,height:200,correctLevel:0,text:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+t.user.uuid}).hide(),g=F.find("canvas").get(0),T=g.toDataURL("image/jpg"),c=new Image;c.src=T}]);
index.controller("useGreetCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,o,a,i,n){function l(){t.btnText="一键生成海报",t.showcanvas=!0;var e=new Image;e.src=t.showImg,e.onload=function(){if(u.drawImage(e,0,0,c*p,d*p),navigator.userAgent.match(/iphone/i))if(1==h&&1==g){u.font="normal bold 72px myFirstFont",u.fillStyle="#fff";var o=Math.floor(.066*m),a=Math.floor(.1466*m),i=Math.floor(.145*d),n=Math.floor(.349*d);u.fillText(t.title,o,i),u.font="normal bold 30px myFirstFont",u.fillStyle="#0f0f0b",u.fillText(t.desc,a,n)}else if(1==h&&2==g){u.font="normal bold 30px myFirstFont",u.fillStyle="#fff";var l=Math.floor(.586*m),r=Math.floor(.731*d),f=Math.floor(.6848*d),s=Math.floor(.638*d);u.fillText(t.desc3,l,r),u.fillText(t.desc2,l,f),u.fillText(t.desc1,l,s)}else 3==h&&1==g?u.drawImage(M,.096*c*p,1099/1334*d*p,14/75*c*p,14/75*c*p):3==h&&2==g&&u.drawImage(M,.408*c*p,1099/1334*d*p,14/75*c*p,14/75*c*p);else if(1==h&&1==g){u.font="normal bold 0.96rem myFirstFont",u.fillStyle="#fff";var x=Math.floor(.066*m),w=Math.floor(.1466*m),v=Math.floor(.145*d),y=Math.floor(.349*d);u.fillText(t.title,x,v),u.font="normal bold 0.4rem myFirstFont",u.fillStyle="#0f0f0b",u.fillText(t.desc,w,y)}else if(1==h&&2==g){u.font="normal bold 0.4rem myFirstFont",u.fillStyle="#fff";var T=Math.floor(.586*m),b=Math.floor(.731*d),I=Math.floor(.6848*d),S=Math.floor(.638*d);u.fillText(t.desc3,T,b),u.fillText(t.desc2,T,I),u.fillText(t.desc1,T,S)}else 3==h&&1==g?u.drawImage(M,.096*c*p,1099/1334*d*p,14/75*c*p,14/75*c*p):3==h&&2==g&&u.drawImage(M,.408*c*p,1099/1334*d*p,14/75*c*p,14/75*c*p)}}function r(t){return document.getElementById(t).getContext("2d")}function f(){t.showcanvas=!1;var e=document.getElementById("main"),o=e.toDataURL("image/jpeg",.7);t.canvasImg=o,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));t.user=s,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.showmodel=!1,t.canvasImg="",t.title="点击添加标题",t.desc="点击添加海报描述",t.desc1="点击添加海报描述",t.desc2="点击添加海报描述",t.desc3="点击添加海报描述";var m=document.documentElement.clientWidth,c=Math.floor(m),d=Math.floor(1.83*m);$("#main").attr("width",c+"px"),$("#main").attr("height",d+"px"),console.log(t.user);var h=n.type,g=n.num;t.page=1,t.showImg="../../assets/images/greet/type"+h+"/img_"+g+".png",t.editInformation=function(t){t.stopPropagation(),a.path("editInformation")},t.useTemplatePage=function(e){e.stopPropagation(),f(),t.showmodel=!0,t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),o.history.back()},t.chengeText=function(){t.showmodel||(1==h&&1==g?$(".name-input-fixed-1").show():1==h&&2==g&&$(".name-input-fixed-2").show())},t.updateText=function(){l(),1==h&&1==g?$(".name-input-fixed-1").fadeOut(50):1==h&&2==g&&$(".name-input-fixed-2").fadeOut(50)},t.closeText=function(e){e.stopPropagation(),t.user.iscomplete=!0};var u=r("main");u.width=c,u.height=d;var x=function(t){var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;return(window.devicePixelRatio||1)/e},p=x(u);$(function(){l()});var w=$(".hideImg").qrcode({width:200,height:200,correctLevel:0,text:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+t.user.uuid}).hide(),v=w.find("canvas").get(0),y=v.toDataURL("image/jpg"),M=new Image;M.src=y}]);
index.controller("vipCenterCtrl",["$scope","$http","$window","$location","$rootScope",function(e,i,t,n,o){i.post("/user/vippage.json",postCfg).then(function(i){if(console.log(i),1===i.data.code){for(var t=i.data.data.viplist,n=0;n<t.length;n++)t[n].selected=!1;e.vipList=i.data.data.viplist}},function(e){}),e.vipid="",e.selectVip=function(i){if(i.selected===!0)i.selected=!1,e.vipid="";else{for(var t=0;t<e.vipList.length;t++)e.vipList[t].selected=!1;i.selected=!0,e.vipid=i.id}},e.showMenu=function(){$(".up-muenu").show()},e.hideMenu=function(){$(".up-muenu").hide()},e.buyVip=function(){return""===e.vipid?(alert("请选择要购买的会员选项"),!1):void i.post("/user/buyvip.json",{vipid:e.vipid},postCfg).success(function(e){if(console.log(e),1===e.code){var t={type:"wz",orderid:e.data.id};i.post("/pay/prepay.json",t,postCfg).success(function(e){if(console.log(e),1===e.code){var i=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:i.appId,timeStamp:i.timeStamp.toString(),nonceStr:i.nonceStr,"package":i["package"],signType:i.signType,paySign:i.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?window.location.href="/yueAssistant/build/html/paySuccess":alert("支付失败,请稍后再试！")})}else 0===e.code}).error(function(e){})}else 0===resp.code}).error(function(e){})}}]);
index.controller("wechatCircleCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,o,t,n,i,s){var a=JSON.parse(sessionStorage.getItem("user"));e.user=a,e.btnText="立即使用",e.loading=!1,console.log(e.user);var r=s.type,c=s.num;e.page=1,e.showImg="../../assets/images/promotion/type"+r+"/img_"+c+".png",e.editInformation=function(){n.path("editInformation")},e.useTemplatePage=function(){e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){t.history.back()},e.closeText=function(){e.user.iscomplete=!0}}]);
index.controller("workHoursCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(t,a,e,i,o,n){var r=new lCalendar;r.init({trigger:".starttime",type:"time"});var s=new lCalendar;s.init({trigger:".endtime",type:"time"});var d=[{name:"星期一",iswork:"0"},{name:"星期二",iswork:"0"},{name:"星期三",iswork:"0"},{name:"星期四",iswork:"0"},{name:"星期五",iswork:"0"},{name:"星期六",iswork:"0"},{name:"星期日",iswork:"0"}];a.post("/user/worktime.json",postCfg).then(function(a){if(-1===a.data.code)t.isLogin=!1,i.path("fast_login");else if(1===a.data.code){t.isLogin=!0,""===a.data.data.starttime||"未知"===a.data.data.starttime?t.starttime="8:00":t.starttime=a.data.data.starttime,""===a.data.data.endtime||"未知"===a.data.data.endtime?t.endtime="22:00":t.endtime=a.data.data.endtime;for(var e=a.data.data.workday,o=0;o<e.length;o++)d[o].iswork=e[o],t.workdayList=d}},function(t){}),t.selectWeek=function(t){1==t.iswork?t.iswork=0:t.iswork=1},t.saveInformation=function(){for(var o="",r=0;r<t.workdayList.length;r++)o+=t.workdayList[r].iswork;var s={workday:o,starttime:t.starttime,endtime:t.endtime};console.log(s),a.post("/user/edit.json",s,postCfg).then(function(t){-1===t.data.code?i.path("fast_login"):1===t.data.code&&n(function(){e.history.back()})},function(t){})}}]);
index.controller("worksCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(o,e,t,n,a,r){function s(){e.post("/user/workslist.json",postCfg).then(function(e){if(console.log(e),1===e.data.code){for(var t=e.data.data.allworks,n=0;n<t.length;n++)t[n].imgurl=picBasePath+t[n].imgurl;o.allworks=[],o.allworks=t;for(var a=e.data.data.recommendworks,r=0;r<a.length;r++)a[r].imgurl=picBasePath+a[r].imgurl;o.recommendworks=[],o.recommendworks=a}},function(o){})}function d(){return 0===o.localId.length?(alert("请选择图片!"),!1):void wx.uploadImage({localId:o.localId[o.upImg],isShowProgressTips:1,success:function(t){o.serverId=[],o.serverId.push(t.serverId);var n={worksmediaid:o.serverId};e.post("/user/uploadworks.json",n,postCfg).then(function(e){1===e.data.code&&(s(),o.upImg<o.localId.length&&(o.upImg+=1,d()))},function(o){})},fail:function(o){}})}o.deleteImg=!1,o.upImg=0,s(),o.deleteRecommendworks=function(o){var t={add:[],rm:[o.id]};e.post("/user/setrecommend.json",t,postCfg).then(function(o){1===o.data.code&&s()},function(o){})},o.addAllworks=function(t){if(o.recommendworks.length>=6)return alert("最多只能设置6张图片作为主页作品展示！"),!1;var n={add:[t.id],rm:[]};e.post("/user/setrecommend.json",n,postCfg).then(function(o){console.log(o),1===o.data.code&&s()},function(o){})},o.deleteAllworks=function(o,t){if(o.stopPropagation(),1==t.recommend)return void alert("该作品已在主页展示,请先移除主页作品后再删除照片!");var n={worksid:[t.id]};e.post("/user/deleteworks.json",n,postCfg).then(function(o){1===o.data.code&&s()},function(o){})},o.showDeleteBtn=function(){o.deleteImg=!o.deleteImg},o.showPrompt=function(){alert("请从下方全部作品中选择！")},o.saveWorkImg=function(){r(function(){t.history.back()})};var c={url:t.location.href.split("#")[0]};e.post("/user/unl/wzinfo.json",c,postCfg).then(function(o){1===o.data.code&&wx.config({debug:!1,appId:o.data.data.appid,timestamp:o.data.data.timestamp,nonceStr:o.data.data.noncestr,signature:o.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(o){}),o.updateWorkImg=function(){wx.chooseImage({count:6,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){return o.localId=e.localIds,0===o.localId.length?(alert("请选择图片!"),!1):(o.upImg=0,void d())}})}}]);