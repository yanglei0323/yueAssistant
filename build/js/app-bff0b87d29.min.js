function showPosition(e){var t=e.coords.latitude,l=e.coords.longitude;localStorage.setItem("positionx",t),localStorage.setItem("positiony",l)}function getUrlParam(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),l=window.location.search.substr(1).match(t);return null!==l?unescape(l[2]):null}var transFn=function(e){return $.param(e)},postCfg={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},transformRequest:transFn},picBasePath="http://47.92.29.81:8891",index=angular.module("index",["ngRoute","mobile-angular-ui","mobile-angular-ui.gestures","ngFileUpload","infinite-scroll"]);index.config(["$routeProvider","$locationProvider",function(e,t){t.html5Mode(!0),e.when("/",{templateUrl:"../html/home.html",controller:"homeCtrl"}).when("/personalCenter",{templateUrl:"../html/personalCenter.html",controller:"personalCenterCtrl"}).when("/editInformation",{templateUrl:"../html/editInformation.html",controller:"editInformationCtrl"}).when("/chooseQrcode",{templateUrl:"../html/chooseQrcode.html",controller:"chooseQrcodeCtrl"}).when("/personalTailor",{templateUrl:"../html/personalTailor.html",controller:"personalTailorCtrl"}).when("/tailorData",{templateUrl:"../html/tailorData.html",controller:"tailorDataCtrl"}).when("/payTailor",{templateUrl:"../html/payTailor.html",controller:"payTailorCtrl"}).when("/compeletPayTailor",{templateUrl:"../html/compeletPayTailor.html",controller:"compeletPayTailorCtrl"}).when("/myTailor",{templateUrl:"../html/myTailor.html",controller:"myTailorCtrl"}).when("/vipCenter",{templateUrl:"../html/vipCenter.html",controller:"vipCenterCtrl"}).when("/fast_login",{templateUrl:"../html/fast_login.html",controller:"fastLoginCtrl"}).when("/works",{templateUrl:"../html/works.html",controller:"worksCtrl"}).when("/workHours",{templateUrl:"../html/workHours.html",controller:"workHoursCtrl"}).when("/morningNight",{templateUrl:"../html/morningNight.html",controller:"morningNightCtrl"}).when("/useMorn/:num",{templateUrl:"../html/useMorn.html",controller:"useMornCtrl"}).when("/useNight/:num",{templateUrl:"../html/useNight.html",controller:"useNightCtrl"}).when("/useCard/:num",{templateUrl:"../html/useCard.html",controller:"useCardCtrl"}).when("/joke",{templateUrl:"../html/joke.html",controller:"jokeshowCtrl"}).when("/usejoke/:num",{templateUrl:"../html/usejoke.html",controller:"usejokeCtrl"}).when("/holiday",{templateUrl:"../html/holiday.html",controller:"holidayCtrl"}).when("/useHoliday/:num",{templateUrl:"../html/useHoliday.html",controller:"useHolidayCtrl"}).when("/useGreet/:num",{templateUrl:"../html/useGreet.html",controller:"useGreetCtrl"}).when("/wechatCircle/:num",{templateUrl:"../html/wechatCircle.html",controller:"wechatCircleCtrl"}).when("/promotion",{templateUrl:"../html/promotion.html",controller:"promotionCtrl"}).when("/guest",{templateUrl:"../html/guest.html",controller:"guestCtrl"}).when("/homePage/:uuid",{templateUrl:"../html/homePage.html",controller:"homePageCtrl"}).when("/life",{templateUrl:"../html/life.html",controller:"lifeCtrl"}).when("/notice",{templateUrl:"../html/notice.html",controller:"noticeCtrl"}).when("/useNotice/:num",{templateUrl:"../html/useNotice.html",controller:"useNoticeCtrl"}).when("/useActive/:num",{templateUrl:"../html/useActive.html",controller:"useActiveCtrl"}).when("/paySuccess",{templateUrl:"../html/paySuccess.html",controller:"paySuccessCtrl"}).otherwise({redirectTo:"/"})}]),function(){var e=getUrlParam("code");if(e){var t={appid:"wxef3e1498e754b61d",secret:"5e21b13a8d5e9b071b9bef2ad65e1883",code:e,grant_type:"authorization_code"};$.ajax({url:"/sns/oauth2/access_token",type:"GET",data:t,async:!1,success:function(e){if(e=JSON.parse(e),e.errcode)alert(e.errmsg);else{var t={type:"wx",token:e.access_token,openid:e.openid};$.ajax({url:"/user/unl/thirdlogin.json",type:"GET",data:t,async:!1,success:function(e){1===e.code?(sessionStorage.setItem("login","1"),sessionStorage.setItem("user",JSON.stringify(e.data))):2===e.code?window.location.href="fast_login":0===e.code&&alert(e.reason)},error:function(e){alert(e)}})}},error:function(){alert("授权信息获取失败")}})}}();
index.directive("advertise",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.deferred.promise.then(function(t){e.advertiseSwiper=new Swiper(i.get(0),{direction:"horizontal",speed:300,autoplay:4e3,loop:!0,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination"})})}}}]),index.directive("designer",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.designerDeferred.promise.then(function(t){e.designerSwiper=new Swiper(i.get(0),{direction:"horizontal",effect:"coverflow",grabCursor:!0,centeredSlides:!0,slidesPerView:"auto",coverflow:{rotate:0,stretch:0,depth:100,modifier:1,slideShadows:!0}}),e.designerSwiper.slideTo(1,500,!1)})}}}]),index.directive("activity",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.activityDeferred.promise.then(function(t){e.activitySwiper=new Swiper(i.get(0),{direction:"horizontal",speed:300,autoplay:4e3,loop:!0,autoplayDisableOnInteraction:!1,pagination:".swiper-pagination"})})}}}]),index.directive("flashsale",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.flashSaleDeferred.promise.then(function(t){e.falshSaleSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",paginationClickable:!0,freeMode:!0})})}}}]),index.directive("back",["$window",function(e){return{restrict:"A",link:function(i,t,n){t.on("click",function(){e.history.back()})}}}]),index.directive("onFinishRenderFilters",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("ngRepeatFinished")})}}}]),index.directive("onDesignerRenderFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("designerRepeatFinished")})}}}]),index.directive("onFlashSaleRenderFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("flashSaleRepeatFinished")})}}}]),index.directive("onActivityFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("activityFinished")})}}}]),index.directive("forbidScroll",["$timeout",function(e){return{restrict:"A",link:function(e,i,t){i.on("touchmove",function(e){e.preventDefault()})}}}]),index.directive("date",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateDeferred.promise.then(function(t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:3,centeredSlides:!0})})}}}]),index.directive("dateOnly",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateOnlyDeferred.promise.then(function(t){e.timeOnlySwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:5,centeredSlides:!0})})}}}]),index.directive("time",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:3,centeredSlides:!0})}}}]),index.directive("timeSelect",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.timeSwiper=new Swiper(i.get(0),{direction:"vertical",speed:300,loop:!1,autoplayDisableOnInteraction:!1,watchSlidesProgress:!0,watchSlidesVisibility:!0,slidesPerView:5,centeredSlides:!0})}}}]),index.directive("onTimeFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("timeFinished")})}}}]),index.directive("onTimeOnlyFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("timeOnlyFinished")})}}}]),index.directive("dateSelect",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.dateDeferred.promise.then(function(t){e.dateSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",freeMode:!0})})}}}]),index.directive("onHotSaleFinished",["$timeout",function(e){return{restrict:"A",link:function(i,t,n){i.$last===!0&&e(function(){i.$emit("hotSaleRepeatFinished")})}}}]),index.directive("hotsale",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.hotSaleDeferred.promise.then(function(t){e.hotSaleSwiper=new Swiper(i.get(0),{direction:"horizontal",slidesPerView:"auto",paginationClickable:!0,freeMode:!0,observer:!0,observerParents:!0,onReachEnd:function(i){e.hotSalePage+=1,e.getHotSaleRecommend()}})})}}}]),index.directive("commonSwiper",["$timeout",function(e){return{restrict:"EA",replace:!0,link:function(e,i,t){e.commonSwiper=new Swiper(i.get(0),{observer:!0,observerParents:!0})}}}]);
index.controller("chooseQrcodeCtrl",["$scope","$http","$window","$location","$rootScope",function(a,e,o,t,s){function r(){return 0===a.localId.length?(alert("请选择图片!"),!1):void wx.uploadImage({localId:a.localId[0],isShowProgressTips:1,success:function(o){a.serverId=o.serverId;var t={qrcodemediaid:a.serverId};e.post("/user/edit.json",t,postCfg).then(function(e){if(1===e.data.code){var o=e.data.data;""===o.avatar?o.avatar="../../assets/images/head-none.png":o.avatar=picBasePath+o.avatar,o.qrcode=picBasePath+o.qrcode,a.user=o,sessionStorage.setItem("user",JSON.stringify(c))}else alert(e.data.reason)},function(a){alert("数据请求失败，请稍后再试！")})},fail:function(a){alert("上传失败！")}})}var n={url:o.location.href.split("#")[0]};console.log(n),e.post("/user/unl/wzinfo.json",n,postCfg).then(function(a){1===a.data.code&&(console.log(a),wx.config({debug:!1,appId:a.data.data.appid,timestamp:a.data.data.timestamp,nonceStr:a.data.data.noncestr,signature:a.data.data.signature,jsApiList:["chooseImage","uploadImage"]}))},function(a){});var c=JSON.parse(sessionStorage.getItem("user"));""===c.qrcode?c.qrcode="../../assets/images/edit-headimg.png":c.qrcode=picBasePath+c.qrcode,a.user=c,a.addPhoto=function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){return a.localId=e.localIds,0===a.localId.length?(alert("请选择图片!"),!1):void r()}})},a.upload=function(){o.history.back()}}]);
index.controller("compeletPayTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,o,r,a){var n=JSON.parse(sessionStorage.getItem("user"));e.user=n,t.post("/user/customizedetail.json",postCfg).then(function(t){1===t.data.code&&(e.customizeOrder=t.data.data.order)},function(e){}),e.toPay=function(){var o={type:"wz",orderid:e.customizeOrder.id};t.post("/pay/prepay.json",o,postCfg).success(function(e){if(1===e.code){var t=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp.toString(),nonceStr:t.nonceStr,"package":t["package"],signType:t.signType,paySign:t.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?(alert("支付成功"),r.path("personalTailor")):alert("支付失败"+e.err_msg)})}else 0===e.code&&alert(e.reason)}).error(function(e){alert(e.reason)})}}]);
index.controller("editInformationCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(e,o,t,a,r,i){function l(){return 0===e.localId.length?(alert("请选择头像图片!"),!1):void wx.uploadImage({localId:e.localId[0],isShowProgressTips:1,success:function(t){e.serverId=t.serverId;var a={avatarmediaid:e.serverId};o.post("/user/edit.json",a,postCfg).then(function(o){if(1===o.data.code){var t=o.data.data;""===t.avatar?t.avatar="../../assets/images/head-none.png":t.avatar=picBasePath+t.avatar,e.user=t,sessionStorage.setItem("user",JSON.stringify(t))}else alert(o.data.reason)},function(e){})},fail:function(e){alert("上传失败！")}})}var n=JSON.parse(sessionStorage.getItem("user"));e.user=n,e.name=n.name,e.worktime=n.worktime,null===n.worklevel?e.worklevel="":e.worklevel=n.worklevel.name,e.storename=n.storename,e.storeplace=n.storeplace,e.cutprice=n.cutprice,e.colorpricelow=n.colorpricelow,e.colorpricehigh=n.colorpricehigh,e.permpricelow=n.permpricelow,e.permpricehigh=n.permpricehigh,e.pointLabel=n.flags,e.flagid=[],""!==n.avatar&&"../../assets/images/head-none.png"!==n.avatar||(e.user.avatar="../../assets/images/edit-headimg.png"),""===n.qrcode?e.qrState="(未上传)":e.qrState="(已上传)",o.post("/user/unl/worklevel.json",postCfg).then(function(o){if(1===o.data.code){for(var t=o.data.data.worklevel,a=0;a<t.length;a++)t[a].selected=!1;e.levelList=t}},function(e){}),e.selectLabel=function(e){e.ischoose=!e.ischoose},e.promptFalse=function(){$(".prompt-fixed").fadeOut(),i(function(){t.history.back()})},e.promptTrue=function(){$(".prompt-fixed").fadeOut(10)},e.saveInformation=function(){for(var t=0;t<e.pointLabel.length;t++)e.pointLabel[t].ischoose===!0&&e.flagid.push(e.pointLabel[t].id);if(""===e.name||""===e.worktime||""===e.worklevelid||""===e.storename||""===e.storeplace||""===e.cutprice||""===e.colorpricelow||""===e.colorpricehigh||""===e.permpricelow||""===e.permpricehigh||0===e.flagid.length)return void $(".prompt-fixed").show();var r={name:e.name,worktime:e.worktime,worklevelid:e.worklevelid,storename:e.storename,storeplace:e.storeplace,cutprice:e.cutprice,colorpricelow:e.colorpricelow,colorpricehigh:e.colorpricehigh,permpricelow:e.permpricelow,permpricehigh:e.permpricehigh,flagid:e.flagid};o.post("/user/edit.json",r,postCfg).then(function(o){-1===o.data.code?(e.isLogin=!1,a.path("fast_login")):1===o.data.code&&(e.isLogin=!0,a.path("/"))},function(e){})},e.chooseQrcode=function(){a.path("chooseQrcode")},e.showLevel=function(){$(".fixed-content").show()},e.selectLevel=function(o){for(var t=0;t<e.levelList.length;t++)e.levelList[t].selected=!1;o.selected=!o.selected,e.worklevelid=o.id,e.worklevel=o.name,$(".fixed-content").fadeOut(10)};var c={url:t.location.href.split("#")[0]};o.post("/user/unl/wzinfo.json",c,postCfg).then(function(e){1===e.data.code&&wx.config({debug:!1,appId:e.data.data.appid,timestamp:e.data.data.timestamp,nonceStr:e.data.data.noncestr,signature:e.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(e){}),e.localId=[],e.addPhoto=function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(o){return e.localId=o.localIds,0===e.localId.length?(alert("请选择图片!"),!1):(e.user.avatar=e.localId[0],void l())}})}}]);
index.controller("fastLoginCtrl",["$scope","$http","$window","$location","$interval","$timeout",function(e,o,t,n,a,d){function i(){return s.test(e.phone)?r.test(e.code)?1:(e.modalText="验证码输入错误",$(".prompt-container").show().fadeOut(2e3),-1):(e.modalText="手机号码有误！",$(".prompt-container").show().fadeOut(2e3),-1)}var s=/^(13[0-9]|14[5|7]|15[0|1|2|3|5|6|7|8|9]|18[0|1|2|3|5|6|7|8|9])\d{8}$/,r=/^\d{4}$/;e.sendCodeText="获取验证码",e.modalText="",e.getCode=function(){return e.sending?void 0:s.test(e.phone)?void o.post("/user/unl/sendlogin.json",{telephone:e.phone},postCfg).then(function(o){if(console.log(o),1===o.data.code){e.sending=!0;var t=60,n=a(function(){t>0?e.sendCodeText="重新发送("+t--+")":(e.sendCodeText="发送验证码",e.sending=!1,a.cancel(n))},1e3)}},function(e){}):(e.modalText="手机号码有误！",void $(".prompt-container").show().fadeOut(2e3))},e.confirmLogin=function(){if(-1!==i()){var n={telephone:e.phone,check:e.code,uuid:e.uuid};o.post("/user/unl/bindtelephone.json",n,postCfg).then(function(o){if(1===o.data.code){var n=o.data.data;sessionStorage.setItem("user",JSON.stringify(n)),d(function(){t.history.back()})}else 0===o.data.code?(e.modalText=o.data.reason,$(".prompt-container").show().fadeOut(2e3)):(e.modalText=o.data.reason,$(".prompt-container").show().fadeOut(2e3))},function(e){alert(e.reason)})}}}]);
index.controller("guestCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,a,i,c){var o=JSON.parse(sessionStorage.getItem("user"));e.user=o,e.activeTab=1,c.activeTab&&(e.activeTab=c.activeTab),e.loading=!1,e.changeTab=function(t){switch(e.activeTab=t,t){case 1:c.activeTab=1;break;case 2:c.activeTab=2}},e.useGuest=function(t){window.location.href="../template/guest/index.html?num="+t+"&uuid="+e.user.uuid}}]);
index.controller("holidayCtrl",["$scope","$http","$window","$location","$rootScope",function(a,e,t,o,c){a.activeTab=1,c.activeTabMorn&&(a.activeTab=c.activeTabMorn),a.changeTab=function(e){switch(a.activeTab=e,e){case 1:c.activeTabMorn=1;break;case 2:c.activeTabMorn=2}},a.useMornTemplate=function(a){o.path("useHoliday/"+a)},a.useNightTemplate=function(a){o.path("useGreet/"+a)}}]);
index.controller("homeCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,a,o,n){t.post("/user/mine.json",postCfg).then(function(t){if(console.log(t),-1===t.data.code)e.isLogin=!1;else if(1===t.data.code){e.isLogin=!0;var a=t.data.data;""===a.avatar?a.avatar="../../assets/images/head-none.png":a.avatar=picBasePath+a.avatar,e.user=a,sessionStorage.setItem("user",JSON.stringify(a))}},function(e){}),e.personalCenter=function(){o.path("personalCenter")},e.setIn=function(){o.path("fast_login")},e.vipCenter=function(){o.path("vipCenter")},e.showTemplate=function(e){switch(e){case 1:o.path("morningNight");break;case 2:o.path("guest");break;case 3:o.path("notice");break;case 4:o.path("promotion");break;case 5:o.path("holiday");break;case 6:o.path("joke");break;case 7:o.path("life")}},e.goHomePage=function(){return e.user.iscomplete===!1?void $(".prompt-fixed").show():void o.path("homePage/"+e.user.uuid)},e.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},e.promptTrue=function(){$(".prompt-fixed").fadeOut(),o.path("editInformation")}}]);
index.controller("homePageCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,s,t,n,o){var i=o.uuid;e.workTime=[],a.post("/user/unl/otherpage.json",{uuid:i},postCfg).then(function(t){if(console.log(t),1===t.data.code){var n=t.data.data;n.avatar=picBasePath+n.avatar,n.qrcode=picBasePath+n.qrcode,e.pointLabel=n.userflags,e.hrefTel="tel:"+n.telephone;for(var o=n.workday,r=0;r<o.length;r++)e.workTime.push(o[r]);for(var p=0;p<n.workslist.length;p++)n.workslist[p]=picBasePath+n.workslist[p];switch(e.user=n,e.user.displaytype){case 1:break;case 2:$(".user-info").addClass("user-info2"),$(".line-title-text").addClass("background-333"),$(".line-title-line").addClass("background-333"),$(".call-designer").addClass("background-333"),$(".appointment-btn").addClass("color-333"),$(".dashed-line").addClass("dashed-line-333"),$(".home-page-price").attr("src","../../assets/images/home_page_price1.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time1.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home1.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place1.png");break;case 3:$(".user-info").addClass("user-info3"),$(".line-title-text").addClass("background-f5a623"),$(".line-title-line").addClass("background-f5a623"),$(".call-designer").addClass("background-f5a623"),$(".appointment-btn").addClass("color-f5a623"),$(".dashed-line").addClass("dashed-line-f5a623"),$(".home-page-price").attr("src","../../assets/images/home_page_price2.png"),$(".home-page-time").attr("src","../../assets/images/home_page_time2.png"),$(".home-page-store").attr("src","../../assets/images/home_page_home2.png"),$(".home-page-place").attr("src","../../assets/images/home_page_place2.png")}var l={url:s.location.href.split("#")[0]};a.post("/user/unl/wzinfo.json",l,postCfg).then(function(a){1===a.data.code&&(wx.config({debug:!1,appId:a.data.data.appid,timestamp:a.data.data.timestamp,nonceStr:a.data.data.noncestr,signature:a.data.data.signature,jsApiList:["checkJsApi","onMenuShareAppMessage","onMenuShareTimeline"]}),wx.ready(function(){wx.onMenuShareAppMessage({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+i,imgUrl:e.user.avatar,type:"link",dataUrl:"",success:function(){},cancel:function(){}}),wx.onMenuShareTimeline({title:"最棒的发型师,服务最好的你!",desc:"店名："+e.user.storename+"\n发型师："+e.user.name+"\n服务时间："+e.user.starttime+"-"+e.user.endtime,link:"http://syrapi.yueyishujia.com/yueAssistant/build/html/homePage/"+i,imgUrl:e.user.avatar,success:function(){},cancel:function(){}})}))},function(e){})}},function(e){});var r=new Date;e.nowYear=r.getFullYear(),e.appointment=function(){$(".prompt-fixed").show()},e.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},a.post("/user/mypage/share.json",postCfg).then(function(e){console.log(e),1===e.data.code},function(e){})}]);
index.controller("jokeshowCtrl",["$scope","$http","$window","$location","$rootScope",function(o,e,t,n,c){o.useTemplate=function(o){n.path("usejoke/"+o)}}]);
index.controller("lifeCtrl",["$scope","$http","$window","$location","$rootScope",function(e,a,i,t,c){e.activeTab=1,c.activeTablife&&(e.activeTab=c.activeTablife),e.changeTab=function(a){switch(e.activeTab=a,a){case 1:c.activeTablife=1;break;case 2:c.activeTablife=2;break;case 3:c.activeTablife=3}},e.useMornTemplate=function(e){window.location.href="../template/life/index.html?num="+e}}]);
index.controller("morningNightCtrl",["$scope","$http","$window","$location","$rootScope",function(t,a,e,n,o){t.activeTab=1,o.activeTabMorn&&(t.activeTab=o.activeTabMorn),t.changeTab=function(a){switch(t.activeTab=a,a){case 1:o.activeTabMorn=1;break;case 2:o.activeTabMorn=2}},t.useMornTemplate=function(t){n.path("useMorn/"+t)},t.useNightTemplate=function(t){n.path("useNight/"+t)}}]);
index.controller("myTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(o,s,e,t,r){var a=JSON.parse(sessionStorage.getItem("user"));o.user=a,s.post("/user/customizedetail.json",postCfg).then(function(s){if(console.log(s),1===s.data.code){var e=s.data.data.customize;if(o.customizeInfo=e,o.progressFlag=o.customizeInfo.status,o.progressTitle="",o.progressFlag)switch(o.progressFlag){case 1:o.progressTitle="您的预约已经提交";break;case 2:o.progressTitle="已匹配专属编辑";break;case 3:o.progressTitle="编辑正在量身定制";break;case 4:o.progressTitle="您的专属定制已经完成"}}},function(o){}),o.activeTab=1,s.post("/user/customizelist.json",postCfg).then(function(s){if(console.log(s),1===s.data.code){var e=s.data.data.customizelist;for(i=0;i<e.length;i++)e[i].imgurl=picBasePath+e[i].imgurl;o.customizeList=e}},function(o){}),o.showCustomize=function(o){window.location.href=o.jumpurl}}]);
index.controller("noticeCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,a,c,o){e.activeTab=1,o.activeTabMorn&&(e.activeTab=o.activeTabMorn),e.changeTab=function(t){switch(e.activeTab=t,t){case 1:o.activeTabMorn=1;break;case 2:o.activeTabMorn=2}},e.useMornTemplate=function(e){c.path("useNotice/"+e)},e.useNightTemplate=function(e){c.path("useActive/"+e)}}]);
index.controller("paySuccessCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(o,t,c,n,e,i){i(function(){n.path("/")},1e3)}]);
index.controller("payTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(e,r,t,o,a){e.customizeOrder=a.customizeOrder;var n=JSON.parse(sessionStorage.getItem("user"));e.user=n,e.toPay=function(){var t={type:"wz",orderid:e.customizeOrder.id};r.post("/pay/prepay.json",t,postCfg).success(function(e){if(1===e.code){var r=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:r.appId,timeStamp:r.timeStamp.toString(),nonceStr:r.nonceStr,"package":r["package"],signType:r.signType,paySign:r.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?(alert("支付成功"),o.path("personalTailor")):alert("支付失败，请稍后再试！")})}else 0===e.code&&alert(e.reason)}).error(function(e){alert(e.reason)})}}]);
index.controller("personalCenterCtrl",["$scope","$http","$window","$location","$rootScope",function(o,n,t,r,e){var i=JSON.parse(sessionStorage.getItem("user"));o.user=i,o.editInformation=function(){r.path("editInformation")},o.personalTailor=function(){r.path("personalTailor")},o.goVipCenter=function(){r.path("vipCenter")},o.goWorks=function(){r.path("works")},o.goWorkHours=function(){r.path("workHours")}}]);
index.controller("personalTailorCtrl",["$scope","$http","$window","$location","$rootScope",function(o,t,a,i,n){t.post("/user/customizepage.json",postCfg).then(function(t){console.log(t),1===t.data.code&&(t.data.data.customizeimgurl=picBasePath+t.data.data.customizeimgurl,o.customizeInfo=t.data.data)},function(o){}),o.tailorData=function(){i.path("tailorData")},o.toMyTailor=function(){i.path("myTailor")},o.showCustomize=function(){window.location.href=o.customizeInfo.customizeurl},o.promptFalse=function(){$(".prompt-fixed").fadeOut(10)},o.promptTrue=function(){$(".prompt-fixed").fadeOut(),i.path("compeletPayTailor")}}]);
index.controller("promotionCtrl",["$scope","$http","$window","$location","$rootScope",function(a,e,t,i,o){var n=JSON.parse(sessionStorage.getItem("user"));a.user=n,a.activeTab=1,o.activeTab&&(a.activeTab=o.activeTab),a.loading=!1,a.changeTab=function(e){switch(a.activeTab=e,e){case 1:o.activeTab=1;break;case 2:o.activeTab=2;break;case 3:o.activeTab=3}},a.changeHomePage=function(t){a.loading=!0;var o={displaytype:t};e.post("/user/edit.json",o,postCfg).then(function(t){-1===t.data.code?(a.isLogin=!1,i.path("fast_login")):1===t.data.code&&(a.isLogin=!0,e.post("/user/mine.json",postCfg).then(function(e){if(console.log(e),-1===e.data.code)a.isLogin=!1;else if(1===e.data.code){a.isLogin=!0;var t=e.data.data;if(""===t.avatar?t.avatar="../../assets/images/head-none.png":t.avatar=picBasePath+t.avatar,a.user=t,sessionStorage.setItem("user",JSON.stringify(t)),a.loading=!1,alert("修改主页风格成功！"),a.user.iscomplete===!1)return;i.path("homePage/"+a.user.uuid)}},function(a){}))},function(a){})},a.useTemplate=function(a){i.path("wechatCircle/"+a)},a.useCard=function(e){window.location.href="../template/card/index.html?num="+e+"&uuid="+a.user.uuid}}]);
index.controller("tailorDataCtrl",["$scope","$http","$window","$location","$rootScope",function(e,i,o,a,r){function d(){wx.uploadImage({localId:e.lifelocalid[0],isShowProgressTips:1,success:function(i){e.lifeList.push(e.lifelocalid[0]),$(".update-img-life").prepend("<img src="+e.lifelocalid[0]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.lifemediaid.push(i.serverId)},fail:function(e){alert("上传失败！")}})}function t(){wx.uploadImage({localId:e.worklocalid[0],isShowProgressTips:1,success:function(i){e.workList.push(e.worklocalid[0]),$(".update-img-work").prepend("<img src="+e.worklocalid[0]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.workmediaid.push(i.serverId)},fail:function(e){alert("上传失败！")}})}function s(){wx.uploadImage({localId:e.artlocalid[0],isShowProgressTips:1,success:function(i){e.artList.push(e.artlocalid[0]),$(".update-img-art").prepend("<img src="+e.artlocalid[0]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.artmediaid.push(i.serverId)},fail:function(e){alert("上传失败！")}})}function l(){wx.uploadImage({localId:e.goodslocalid[0],isShowProgressTips:1,success:function(i){e.goodsList.push(e.goodslocalid[0]),$(".update-img-goods").prepend("<img src="+e.goodslocalid[0]+" style='width:1.76rem;height:1.76rem;margin-right:0.266667rem;border-radius:0.066667rem;' />"),e.goodsmediaid.push(i.serverId)},fail:function(e){alert("上传失败！")}})}var n={url:o.location.href.split("#")[0]};i.post("/user/unl/wzinfo.json",n,postCfg).then(function(e){1===e.data.code&&wx.config({debug:!1,appId:e.data.data.appid,timestamp:e.data.data.timestamp,nonceStr:e.data.data.noncestr,signature:e.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(e){}),e.lifemediaid=[],e.workmediaid=[],e.artmediaid=[],e.goodsmediaid=[],e.lifeList=[],e.workList=[],e.artList=[],e.goodsList=[],e.addLifePhoto=function(){return e.lifemediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.lifelocalid=i.localIds,0===e.lifelocalid.length?(alert("请选择图片!"),!1):void d()}})},e.addWorkPhoto=function(){return e.workmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.worklocalid=i.localIds,0===e.worklocalid.length?(alert("请选择图片!"),!1):void t()}})},e.addArtPhoto=function(){return e.artmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.artlocalid=i.localIds,0===e.artlocalid.length?(alert("请选择图片!"),!1):void s()}})},e.addGoodsPhoto=function(){return e.goodsmediaid.length>=3?(alert("最多可上传3张图片!"),!1):void wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(i){return e.goodslocalid=i.localIds,0===e.goodslocalid.length?(alert("请选择图片!"),!1):void l()}})},e.toPayTailor=function(){if(""===e.name||""===e.telephone||""===e.education||""===e.work||""===e.activity||""===e.magazine||""===e.stars||""===e.brand||0===e.lifemediaid.length||0===e.workmediaid.length||0===e.artmediaid.length||0===e.goodsmediaid.length)return alert("有信息尚未填写，请完善后再保存"),!1;var o={name:e.name,telephone:e.telephone,education:e.education,work:e.work,activity:e.activity,magazine:e.magazine,stars:e.stars,brand:e.brand,remark:e.remark,lifemediaid:e.lifemediaid,workmediaid:e.workmediaid,artmediaid:e.artmediaid,goodsmediaid:e.goodsmediaid};i.post("/user/addcustomize.json",o,postCfg).then(function(e){1===e.data.code&&(console.log(e),r.customizeOrder=e.data.data,a.path("payTailor"))},function(e){})}}]);
index.controller("useActiveCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,o,a,l,n){function r(){t.btnText="一键生成海报",t.showcanvas=!0;var e=new Date,o=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),a=e.getMonth()+1;switch(a){case 1:a="JAN";break;case 2:a="FEB";break;case 3:a="MAR";break;case 4:a="APR";break;case 5:a="MAY";break;case 6:a="JUN";break;case 7:a="JUL";break;case 8:a="AUG";break;case 9:a="SEP";break;case 10:a="OCT";break;case 11:a="NOV";break;case 12:a="DEC"}var l=e.getDay();switch(l){case 0:l="Sunday";break;case 1:l="Monday";break;case 2:l="Tuesday";break;case 3:l="Wednesday";break;case 4:l="Thursday";break;case 5:l="Friday";break;case 6:l="Saturday"}var n=f("main");n.width,n.height;n.clearRect(0,0,1e3,1e3);var r=new Image;r.src=t.showImg,r.onload=function(){if(n.drawImage(r,0,0,h,d),1==u){n.font="normal bold 0.8rem myFirstFont",n.fillStyle="#fff",n.textAlign="left";var a=Math.floor(.212*m),l=Math.floor(.5767*m),f=Math.floor(.5*m),i=Math.floor(.394*d),s=Math.floor(.3284*d);n.fillText(t.startTime,a,i),n.fillText(t.endTime,l,i),n.fillStyle="#000",n.textAlign="center",n.fillText(t.name,f,s)}else if(2==u){n.font="normal bold 0.453333rem myFirstFont",n.fillStyle="#fff",n.textAlign="center";var c=Math.floor(.5*m),x=(Math.floor(.5667*m),Math.floor(.2267*m)),M=Math.floor(.3017*m),g=Math.floor(.3767*m),p=Math.floor(.6296*m),T=Math.floor(.6996*m),y=Math.floor(.7696*m),b=Math.floor(.1147*d),$=Math.floor(.3082*d),F=Math.floor(.737*d);n.fillText(o,c,b),n.font="normal bold 0.533333rem myFirstFont",n.fillStyle="#000",n.fillText(t.name,c,$),n.fillText(t.startHour,x,F),n.fillText(t.startMinute,g,F),n.fillText(t.endHour,p,F),n.fillText(t.endMinute,y,F),n.fillStyle="#fff",n.fillText(":",M,F),n.fillText(":",T,F)}else if(3==u){n.font="normal bold 0.64rem myFirstFont",n.fillStyle="#000",n.textAlign="center";var v=(Math.floor(.5*m),Math.floor(.5667*m),Math.floor(.2267*m)),w=Math.floor(.3017*m),S=Math.floor(.3767*m),k=Math.floor(.6296*m),A=Math.floor(.6996*m),O=Math.floor(.7696*m),P=(Math.floor(.1147*d),Math.floor(.3082*d),Math.floor(.802*d));n.fillText(t.startHour,v,P),n.fillText(t.startMinute,S,P),n.fillText(t.endHour,k,P),n.fillText(t.endMinute,O,P),n.fillText(":",w,P),n.fillText(":",A,P)}else if(4==u){n.font="normal bold 0.48rem myFirstFont",n.fillStyle="#fff";var D=Math.floor(.747*m),I=Math.floor(.922*d);n.fillText(t.name,D,I)}else if(5==u){n.font="normal bold 0.96rem myFirstFont",n.fillStyle="#244678",n.textAlign="left";var E=Math.floor(.2693*m),H=Math.floor(.522*m),B=Math.floor(.69*m),C=Math.floor(.3355*d),J=Math.floor(.4669*d),N=Math.floor(.616*d),R=Math.floor(.701*d);n.fillText(t.startMonth,E,C),n.fillText(t.startDate,H,C),n.fillText(t.endMonth,E,J),n.fillText(t.endDate,H,J),n.textAlign="center",n.fillStyle="#fff",n.fillText(t.colorPrice,B,N),n.fillText(t.permPrice,B,R)}else if(6==u){n.font="normal bold 0.6rem myFirstFont",n.fillStyle="#fff",n.textAlign="right";var U=Math.floor(.951*m),Y=Math.floor(.244*d);n.fillText(t.name,U,Y)}else if(7==u){var L=e.getDate()+"/"+(e.getMonth()+1)+"/"+e.getFullYear();n.font="normal bold 0.6rem myFirstFont",n.fillStyle="#000",n.textAlign="center";var W=Math.floor(.5*m),j=Math.floor(.6587*d);n.fillText(L,W,j)}else if(8==u){n.font="normal bold 4.0rem myFirstFont",n.fillStyle="#af0008",n.textAlign="center";var G=Math.floor(.5*m),V=Math.floor(.7261*d);n.fillText(t.day,G,V)}else if(9==u){n.font="normal bold 0.64rem myFirstFont",n.fillStyle="#000",n.textAlign="center";var _=Math.floor(.51*m),q=Math.floor(.509*d),z=Math.floor(.589*d);n.fillText(t.colorPrice,_,q),n.fillText(t.permPrice,_,z)}else if(10==u){n.font="normal bold 0.64rem myFirstFont",n.fillStyle="#000",n.textAlign="center";var K=Math.floor(.5*m),Q=Math.floor(.14*m),X=Math.floor(.7364*d),Z=Math.floor(.8052*d);n.fillText(t.name,K,X),n.font="normal bold 0.96rem myFirstFont",n.fillStyle="#324ee9",n.textAlign="left",n.fillText(t.startDate,Q,Z)}}}function f(t){return document.getElementById(t).getContext("2d")}function i(){t.showcanvas=!1;var e=document.getElementById("main"),o=e.toDataURL("image/jpg");t.canvasImg=o,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));t.user=s,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.canvasImg="",t.name="请添加",t.startTime="13:00",t.endTime="18:00",t.startHour="13",t.startMinute="00",t.endHour="18",t.endMinute="00",t.startMonth="05",t.startDate="01",t.endMonth="05",t.endDate="15",t.colorPrice="88",t.permPrice="88",t.day="2";var m=document.documentElement.clientWidth,h=Math.floor(m),d=Math.floor(1.83*m);$("#main").attr("width",h+"px"),$("#main").attr("height",d+"px"),console.log(t.user);var u=n.num;t.page=1,t.showImg="../../assets/images/notice/type6/img_"+u+".png",t.editInformation=function(t){t.stopPropagation(),a.path("editInformation")},t.useTemplatePage=function(e){e.stopPropagation(),i(),t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),o.history.back()},t.chengeText=function(){if(1==u)$(".name-input-fixed").show();else if(2==u)$(".name-input-fixed-1").show();else if(3==u)$(".name-input-fixed-2").show();else if(4==u)$(".name-input-fixed-3").show();else if(5==u)$(".name-input-fixed-4").show();else if(6==u)$(".name-input-fixed-5").show();else{if(7==u)return;8==u?$(".name-input-fixed-7").show():9==u?$(".name-input-fixed-8").show():10==u?$(".name-input-fixed-9").show():11==u&&$(".name-input-fixed-10").show()}},t.updateText=function(){r(),1==u?$(".name-input-fixed").fadeOut(50):2==u?$(".name-input-fixed-1").fadeOut(50):3==u?$(".name-input-fixed-2").fadeOut(50):4==u?$(".name-input-fixed-3").fadeOut(50):5==u?$(".name-input-fixed-4").fadeOut(50):6==u?$(".name-input-fixed-5").fadeOut(50):7==u?$(".name-input-fixed-6").fadeOut(50):8==u?$(".name-input-fixed-7").fadeOut(50):9==u?$(".name-input-fixed-8").fadeOut(50):10==u?$(".name-input-fixed-9").fadeOut(50):11==u&&$(".name-input-fixed-10").fadeOut(50)},t.closeText=function(e){e.stopPropagation(),t.user.iscomplete=!0},$(function(){r()})}]);
index.controller("useCardCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,t,o,r,n){function l(){e.btnText="生成海报",e.showcanvas=!0;var a=new Date,t=a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate(),o=a.getMonth()+1;switch(o){case 1:o="J A N";break;case 2:o="F E B";break;case 3:o="M A R";break;case 4:o="A P R";break;case 5:o="M A Y";break;case 6:o="J U N";break;case 7:o="J U L";break;case 8:o="A U G";break;case 9:o="S E P";break;case 10:o="O C T";break;case 11:o="N O V";break;case 12:o="D E C"}var r=a.getDay();switch(r){case 0:r="Sunday";break;case 1:r="Monday";break;case 2:r="Tuesday";break;case 3:r="Wednesday";break;case 4:r="Thursday";break;case 5:r="Friday";break;case 6:r="Saturday"}var n=i("main");n.width,n.height;n.clearRect(0,0,1e3,1e3);var l=new Image;l.src=e.updateImg,l.width=c,l.height="auto";var f=new Image;f.src=e.showImg,f.onload=function(){if(1==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,c,m),n.drawImage(f,0,0,c,m),n.font="normal bold 0.32rem myFirstFont",n.fillStyle="#545454";var i=Math.floor(.07*h),s=Math.floor(.866*m),g=Math.floor(.897*m),u=Math.floor(.923*m);n.fillText(e.user.name,i,s),n.fillText(o+"."+r,i,g),n.fillText(t,i,u)}else if(2==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,e.pinchWidth,e.pinchHeight),n.drawImage(f,0,0,c,m),n.font="normal bold 0.4rem myFirstFont",n.fillStyle="#fff";for(var M=Math.floor(.625*h),b=Math.floor(.826*h),p=Math.floor(.716*m),x=Math.floor(.88*m),y=Math.floor(.92*m),T=0;T<e.user.name.length;T++)n.fillText(e.user.name[T],b,p+Math.floor(.0437*m)*T);n.fillText(o+"."+r,M,x),n.fillText(t,M,y)}else if(3==d){n.font="normal bold 0.42rem myFirstFont",n.fillStyle="white";var v=Math.floor(.066*h),w=Math.floor(.8*h),I=Math.floor(.076*m),k=Math.floor(.105*m),F=Math.floor(.329*m);n.fillText(a.getMonth()+1+"/"+a.getDate(),v,I),n.fillText(r,v,k);for(var S=0;S<e.user.name.length;S++)n.fillText(e.user.name[S],w,F+Math.floor(.0437*m)*S)}else if(4==d){n.font="normal bold 1.333333rem myFirstFont",n.fillStyle="white";var $=Math.floor(.103*h),D=Math.floor(.8*h),Y=Math.floor(.87*m),A=Math.floor(.91*m),E=Math.floor(.947*m),R=Math.floor(.329*m);n.fillText(a.getDate(),$,Y),n.font="normal bold 0.4rem myFirstFont",n.fillText(o+"."+r,$,A),n.fillText(a.getFullYear(),$,E);for(var W=0;W<e.user.name.length;W++)n.fillText(e.user.name[W],D,R+Math.floor(.0437*m)*W)}else if(5==d){n.drawImage(l,0,0,c,m,e.dragX,e.dragY,e.pinchWidth,e.pinchHeight),n.drawImage(f,0,0,c,m),n.font="normal bold 0.453333rem myFirstFont",n.fillStyle="#545454";var C=Math.floor(.103*h),U=Math.floor(.8*h),X=Math.floor(.9*m),B=Math.floor(.94*m),H=Math.floor(.329*m);n.fillText(o+"."+r,C,X),n.fillText(t,C,B),n.fillStyle="#fff";for(var J=0;J<e.user.name.length;J++)n.fillText(e.user.name[J],U,H+Math.floor(.0437*m)*J)}}}function i(e){return document.getElementById(e).getContext("2d")}function f(){e.showcanvas=!1;var a=document.getElementById("main"),t=a.toDataURL("image/jpg");e.canvasImg=t,$(".changeText").css("display","none"),e.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));e.user=s,e.btnText="生成海报",e.loading=!1,e.showcanvas=!0,e.canvasImg="";var h=document.documentElement.clientWidth,c=Math.floor(h),m=Math.floor(1.83*h);$("#main").attr("width",c+"px"),$("#main").attr("height",m+"px"),e.updateImg="",e.dragX=0,e.dragY=0,e.pinchWidth=1,e.pinchHeight=1,e.user.name.length>=3&&(e.user.name=e.user.name[0]+e.user.name[1]);var d=n.num;e.page=1,e.showImg="../../assets/images/promotion/type4/img_"+d+".png",e.editInformation=function(){o.path("editInformation")},e.useTemplatePage=function(){f(),e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){t.history.back()},e.closeText=function(){e.user.iscomplete=!0},$(".upload").on("change",function(){var a=$(this)[0].files[0];if(a){var t=new FileReader;t.readAsDataURL(a),t.onload=function(){var a=this.result;e.updateImg=a,l()}}}),touch.on("#main","dragend",function(a){e.dragX=a.x,e.dragY=a.y,l()}),touch.on("#main","pinchend",function(a){e.pinchWidth=a.scale,e.pinchHeight=a.scale,l()}),$(function(){l()})}]);
index.controller("useHolidayCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,a,t,n,o,i){function g(){e.btnText="一键生成海报",e.showcanvas=!0;var a=m("main");a.width,a.height;a.clearRect(0,0,1e3,1e3);var t=new Image;t.src=e.showImg,t.onload=function(){if(a.drawImage(t,0,0,c,l),1==d&&2==e.page){a.font="normal bold 0.533333rem myFirstFont",a.fillStyle="#fff";var n=Math.floor(.153*p),o=Math.floor(.335*l);a.fillText(e.name+"祝您",n,o)}}}function m(e){return document.getElementById(e).getContext("2d")}function s(){e.showcanvas=!1;var a=document.getElementById("main"),t=a.toDataURL("image/jpg");e.canvasImg=t,e.btnText="长按保存至手机，再发到朋友圈炫耀"}var r=JSON.parse(sessionStorage.getItem("user"));e.user=r,e.btnText="一键生成海报",e.loading=!1,e.showcanvas=!0,e.canvasImg="",e.name="请添加";var p=document.documentElement.clientWidth,c=Math.floor(p),l=Math.floor(1.83*p);$("#main").attr("width",c+"px"),$("#main").attr("height",l+"px"),console.log(e.user),e.name.length>=4&&(e.name=e.name[0]+e.name[1]+e.name[2]);var d=i.num;e.page=1,e.showImg="../../assets/images/holiday/type"+d+"/img_"+e.page+".png";for(var h=1;3>h;h++){var f="../../assets/images/holiday/type"+d+"/img_"+h+".png";$(".hideImg").append("<img src="+f+">")}e.editInformation=function(e){e.stopPropagation(),n.path("editInformation")},e.useTemplatePage=function(a){a.stopPropagation(),s(),e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(e){e.stopPropagation(),t.history.back()},e.chengeText=function(){1==d&&2==e.page&&$(".name-input-fixed").show()},e.updateText=function(){e.name.length>=4&&(e.name=e.name[0]+e.name[1]+e.name[2]),g(),$(".name-input-fixed").fadeOut(50)},e.closeText=function(a){a.stopPropagation(),e.user.iscomplete=!0},e.changeImg=function(a){a.stopPropagation(),e.loading=!0,e.page>=2?(e.page=1,e.showImg="../../assets/images/holiday/type"+d+"/img_"+e.page+".png",e.loading=!1):(e.page+=1,e.showImg="../../assets/images/holiday/type"+d+"/img_"+e.page+".png",e.loading=!1),g()},$(function(){g()})}]);
index.controller("usejokeCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,o,t,n,a,s){var g=JSON.parse(sessionStorage.getItem("user"));e.user=g,e.btnText="立即使用",e.loading=!1,console.log(e.user);var i=s.num;e.page=1,e.showImg="../../assets/images/joke/type"+i+"/img_"+e.page+".png",e.editInformation=function(){n.path("editInformation")},e.useTemplatePage=function(){e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){t.history.back()},e.closeText=function(){e.user.iscomplete=!0},e.changeImg=function(){e.loading=!0,e.page>=10?(e.page=1,e.showImg="../../assets/images/joke/type"+i+"/img_"+e.page+".png",e.loading=!1):(e.page+=1,e.showImg="../../assets/images/joke/type"+i+"/img_"+e.page+".png",e.loading=!1)}}]);
index.controller("useMornCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,t,a,o,l,r){function n(){e.btnText="立即使用",e.showcanvas=!0;var t=new Date,a=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),o=t.getMonth()+1;switch(o){case 1:o="J A N";break;case 2:o="F E B";break;case 3:o="M A R";break;case 4:o="A P R";break;case 5:o="M A Y";break;case 6:o="J U N";break;case 7:o="J U L";break;case 8:o="A U G";break;case 9:o="S E P";break;case 10:o="O C T";break;case 11:o="N O V";break;case 12:o="D E C"}var l=t.getDay();switch(l){case 0:l="S U N D A Y";break;case 1:l="M O N D A Y";break;case 2:l="T U E S D A Y";break;case 3:l="W E D N E S D A Y";break;case 4:l="T H U R S D A Y";break;case 5:l="F R I D A Y";break;case 6:l="S A T U R D A Y"}var r=i("main");r.width,r.height;r.clearRect(0,0,1e3,1e3);var n=new Image;n.src=e.showImg,n.onload=function(){if(r.drawImage(n,0,0,g,c),1==h){r.font="normal bold 0.48rem myFirstFont",r.fillStyle="black";var i=Math.floor(.544*m),s=Math.floor(.95*c);r.fillText("BY"+e.user.name,i,s)}else if(2==h){r.font="normal bold 0.4rem myFirstFont",r.fillStyle="black";var f=Math.floor(.07*m),u=Math.floor(.906*c),b=Math.floor(.943*c);r.fillText("BY"+e.user.name,f,u),r.fillText(a,f,b)}else if(3==h){r.font="normal bold 1.333333rem myFirstFont",r.fillStyle="white";var d=Math.floor(.103*m),M=Math.floor(.87*c),p=Math.floor(.91*c),x=Math.floor(.947*c);r.fillText(t.getDate(),d,M),r.font="normal bold 0.4rem myFirstFont",r.fillText(o+"."+l,d,p),r.fillText("BY"+e.user.name,d,x)}else if(4==h){r.font="normal bold 0.453333rem myFirstFont",r.fillStyle="black",r.textAlign="right";var T=Math.floor(.924*m),y=Math.floor(.145*c),v=Math.floor(.184*c),F=Math.floor(.223*c);r.fillText(a,T,y),r.fillText(l,T,v),r.fillText("BY"+e.user.name,T,F)}else if(5==h){r.font="normal bold 0.453333rem myFirstFont",r.fillStyle="#7a8776";var k=Math.floor(.773*m),w=Math.floor(.736*c);r.fillText("BY"+e.user.name,k,w)}else if(6==h){r.font="normal bold 0.46rem myFirstFont",r.fillStyle="#fff";var S=Math.floor(.047*m),Y=Math.floor(.915*c);r.fillText("BY"+e.user.name,S,Y)}else if(7==h){r.font="normal bold 0.4rem myFirstFont",r.fillStyle="#000";var I=Math.floor(.07*m),D=Math.floor(.856*c),A=Math.floor(.883*c),B=Math.floor(.91*c);r.fillText(a,I,D),r.fillText(l,I,A),r.fillText("BY"+e.user.name,I,B)}else if(8==h){r.font="normal bold 1.333333rem myFirstFont",r.fillStyle="#96bfad";var $=Math.floor(.07*m),E=Math.floor(.106*c),U=Math.floor(.146*c),N=Math.floor(.186*c);r.fillText(t.getDate(),$,E),r.font="normal bold 0.4rem myFirstFont",r.fillText(l,$,U),r.fillText("BY"+e.user.name,$,N)}}}function i(e){return document.getElementById(e).getContext("2d")}function s(){e.showcanvas=!1;var t=document.getElementById("main"),a=t.toDataURL("image/jpg");e.canvasImg=a,e.btnText="长按保存至手机，再发到朋友圈炫耀"}var f=JSON.parse(sessionStorage.getItem("user"));e.user=f,e.btnText="立即使用",e.loading=!1,e.showcanvas=!0,e.canvasImg="";var m=document.documentElement.clientWidth,g=Math.floor(m),c=Math.floor(1.83*m);$("#main").attr("width",g+"px"),$("#main").attr("height",c+"px"),console.log(e.user),e.user.name.length>=3&&(e.user.name=e.user.name[0]+e.user.name[1]);var h=r.num;e.page=1,e.showImg="../../assets/images/morning/type"+h+"/img_"+e.page+".png";for(var u=1;6>u;u++){var b="../../assets/images/goodnight/type"+h+"/img_"+u+".png";$(".hideImg").append("<img src="+b+">")}e.editInformation=function(){o.path("editInformation")},e.useTemplatePage=function(){s(),e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){a.history.back()},e.closeText=function(){e.user.iscomplete=!0},e.changeImg=function(){e.loading=!0,e.page>=5?(e.page=1,e.showImg="../../assets/images/morning/type"+h+"/img_"+e.page+".png",e.loading=!1):(e.page+=1,e.showImg="../../assets/images/morning/type"+h+"/img_"+e.page+".png",e.loading=!1),n()},$(function(){n()})}]);
index.controller("useNightCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,t,a,o,l,r){function n(){e.btnText="立即使用",e.showcanvas=!0;var t=new Date,a=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),o=t.getMonth()+1;switch(o){case 1:o="J A N";break;case 2:o="F E B";break;case 3:o="M A R";break;case 4:o="A P R";break;case 5:o="M A Y";break;case 6:o="J U N";break;case 7:o="J U L";break;case 8:o="A U G";break;case 9:o="S E P";break;case 10:o="O C T";break;case 11:o="N O V";break;case 12:o="D E C"}var l=t.getDay();switch(l){case 0:l="Sunday";break;case 1:l="Monday";break;case 2:l="Tuesday";break;case 3:l="Wednesday";break;case 4:l="Thursday";break;case 5:l="Friday";break;case 6:l="Saturday"}var r=f("main");r.width,r.height;r.clearRect(0,0,1e3,1e3);var n=new Image;n.src=e.showImg,n.onload=function(){if(r.drawImage(n,0,0,h,g),1==c){r.font="normal bold 0.32rem myFirstFont",r.fillStyle="#545454";var f=Math.floor(.07*m),i=Math.floor(.866*g),s=Math.floor(.897*g),M=Math.floor(.923*g);r.fillText(e.user.name,f,i),r.fillText(o+"."+l,f,s),r.fillText(a,f,M)}else if(2==c){r.font="normal bold 0.4rem myFirstFont",r.fillStyle="#fff";for(var u=Math.floor(.625*m),d=Math.floor(.826*m),y=Math.floor(.716*g),x=Math.floor(.88*g),T=Math.floor(.92*g),b=0;b<e.user.name.length;b++)r.fillText(e.user.name[b],d,y+Math.floor(.0437*g)*b);r.fillText(o+"."+l,u,x),r.fillText(a,u,T)}else if(3==c){r.font="normal bold 0.42rem myFirstFont",r.fillStyle="white";var F=Math.floor(.066*m),p=Math.floor(.8*m),v=Math.floor(.076*g),k=Math.floor(.105*g),w=Math.floor(.329*g);r.fillText(t.getMonth()+1+"/"+t.getDate(),F,v),r.fillText(l,F,k);for(var S=0;S<e.user.name.length;S++)r.fillText(e.user.name[S],p,w+Math.floor(.0437*g)*S)}else if(4==c){r.font="normal bold 1.333333rem myFirstFont",r.fillStyle="white";var I=Math.floor(.103*m),$=Math.floor(.8*m),D=Math.floor(.87*g),E=Math.floor(.91*g),Y=Math.floor(.947*g),A=Math.floor(.329*g);r.fillText(t.getDate(),I,D),r.font="normal bold 0.4rem myFirstFont",r.fillText(o+"."+l,I,E),r.fillText(t.getFullYear(),I,Y);for(var B=0;B<e.user.name.length;B++)r.fillText(e.user.name[B],$,A+Math.floor(.0437*g)*B)}else if(5==c){r.font="normal bold 0.453333rem myFirstFont",r.fillStyle="#545454";var N=Math.floor(.103*m),C=Math.floor(.8*m),J=Math.floor(.9*g),P=Math.floor(.94*g),R=Math.floor(.329*g);r.fillText(o+"."+l,N,J),r.fillText(a,N,P),r.fillStyle="#fff";for(var U=0;U<e.user.name.length;U++)r.fillText(e.user.name[U],C,R+Math.floor(.0437*g)*U)}else if(6==c){r.font="normal bold 1.653333rem myFirstFont",r.fillStyle="#fff";var _=Math.floor(.07*m),O=Math.floor(.479*m),L=Math.floor(.106*g),W=Math.floor(.146*g),j=Math.floor(.186*g),G=Math.floor(.434*g);r.fillText(t.getDate(),_,L),r.font="normal bold 0.4rem myFirstFont",r.fillText(o+"."+l,_,W),r.fillText(t.getFullYear(),_,j);for(var V=0;V<e.user.name.length;V++)r.fillText(e.user.name[V],O,G+Math.floor(.0437*g)*V)}else if(7==c){r.font="normal bold 0.42rem myFirstFont",r.fillStyle="#545454";var q=Math.floor(.066*m),z=Math.floor(.059*g),H=Math.floor(.088*g);r.fillText(o+"."+l,q,z),r.fillText(a,q,H)}else if(8==c){r.font="normal bold 1.653333rem myFirstFont",r.fillStyle="#1b273";var K=Math.floor(.08*m),Q=Math.floor(.146*g),X=Math.floor(.186*g),Z=Math.floor(.226*g),ee=Math.floor(.9078*g);r.fillText(t.getDate(),K,Q),r.font="normal bold 0.4rem myFirstFont",r.fillText(o+"."+l,K,X),r.fillText(t.getFullYear(),K,Z),r.fillStyle="#535353",r.fillText("BY"+e.user.name,K,ee)}}}function f(e){return document.getElementById(e).getContext("2d")}function i(){e.showcanvas=!1;var t=document.getElementById("main"),a=t.toDataURL("image/jpg");e.canvasImg=a,e.btnText="长按保存至手机，再发到朋友圈炫耀"}var s=JSON.parse(sessionStorage.getItem("user"));e.user=s,e.btnText="立即使用",e.loading=!1,e.showcanvas=!0,e.canvasImg="";var m=document.documentElement.clientWidth,h=Math.floor(m),g=Math.floor(1.83*m);$("#main").attr("width",h+"px"),$("#main").attr("height",g+"px"),console.log(e.user),e.user.name.length>=3&&(e.user.name=e.user.name[0]+e.user.name[1]);var c=r.num;e.page=1,e.showImg="../../assets/images/goodnight/type"+c+"/img_"+e.page+".png";for(var M=1;6>M;M++){var u="../../assets/images/goodnight/type"+c+"/img_"+M+".png";$(".hideImg").append("<img src="+u+">")}e.editInformation=function(){o.path("editInformation")},e.useTemplatePage=function(){i(),e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){a.history.back()},e.closeText=function(){e.user.iscomplete=!0},e.changeImg=function(){e.loading=!0,e.page>=5?(e.page=1,e.showImg="../../assets/images/goodnight/type"+c+"/img_"+e.page+".png",e.loading=!1):(e.page+=1,e.showImg="../../assets/images/goodnight/type"+c+"/img_"+e.page+".png",e.loading=!1),n()},$(function(){n()})}]);
index.controller("useNoticeCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(t,e,o,a,l,n){function i(){t.btnText="一键生成海报",t.showcanvas=!0;var e=new Date,o=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate(),a=e.getMonth()+1;switch(a){case 1:a="JAN";break;case 2:a="FEB";break;case 3:a="MAR";break;case 4:a="APR";break;case 5:a="MAY";break;case 6:a="JUN";break;case 7:a="JUL";break;case 8:a="AUG";break;case 9:a="SEP";break;case 10:a="OCT";break;case 11:a="NOV";break;case 12:a="DEC"}var l=e.getDay();switch(l){case 0:l="Sunday";break;case 1:l="Monday";break;case 2:l="Tuesday";break;case 3:l="Wednesday";break;case 4:l="Thursday";break;case 5:l="Friday";break;case 6:l="Saturday"}var n=f("main");n.width,n.height;n.clearRect(0,0,1e3,1e3);var i=new Image;i.src=t.showImg,i.onload=function(){if(n.drawImage(i,0,0,h,d),1==g){n.font="normal bold 0.48rem myFirstFont",n.fillStyle="#fff";var e=Math.floor(.1133*s),f=Math.floor(.88*d),r=Math.floor(.91*d),m=Math.floor(.94*d);n.fillText(t.name,e,f),n.font="normal bold 0.32rem myFirstFont",n.fillText(a+"."+l,e,r),n.fillText(o,e,m)}else if(2==g&&1==t.page){n.font="normal bold 0.48rem myFirstFont",n.fillStyle="#fff";var p=Math.floor(.5733*s),u=Math.floor(.704*s),c=Math.floor(.3999*d),x=Math.floor(.6372*d),M=Math.floor(.6672*d),b=Math.floor(.6972*d);n.fillText(t.zhekou,p,c),n.fillStyle="#333",n.fillText(t.name,u,x),n.font="normal bold 0.32rem myFirstFont",n.fillText(a+"."+l,u,M),n.fillText(o,u,b)}else if(2==g&&2==t.page){n.font="normal bold 0.4rem myFirstFont",n.fillStyle="#333";var y=Math.floor(.3673*s),T=Math.floor(.211*s),F=Math.floor(.6567*d),$=Math.floor(.8685*d),w=Math.floor(.8985*d),v=Math.floor(.9285*d);n.fillText(t.lijian,y,F),n.font="normal bold 0.48rem myFirstFont",n.fillStyle="#fff",n.fillText(t.name,T,$),n.font="normal bold 0.32rem myFirstFont",n.fillStyle="#333",n.fillText(a+"."+l,T,w),n.fillText(o,T,v)}else if(3==g&&1==t.page){n.font="normal bold 1.133333rem myFirstFont",n.fillStyle="#b8742b";var S=Math.floor(.2017*s),k=Math.floor(.5803*s),I=Math.floor(.113*s),O=Math.floor(.608*d),P=Math.floor(.8785*d),D=Math.floor(.9085*d),E=Math.floor(.9385*d);n.fillText(t.starttime,S,O),n.fillText(t.endtime,k,O),n.font="normal bold 0.48rem myFirstFont",n.fillStyle="#333",n.fillText(t.name,I,P),n.font="normal bold 0.32rem myFirstFont",n.fillText(a+"."+l,I,D),n.fillText(o,I,E)}else if(3==g&&2==t.page){n.font="normal bold 0.64rem myFirstFont",n.fillStyle="#fff";var A=Math.floor(.246*s),N=Math.floor(.5667*s),B=Math.floor(.113*s),C=Math.floor(.463*d),J=Math.floor(.8785*d),R=Math.floor(.9085*d),U=Math.floor(.9385*d);n.fillText(t.starttime1,A,C),n.fillText(t.endtime1,N,C),n.font="normal bold 0.48rem myFirstFont",n.fillText(t.name,B,J),n.font="normal bold 0.32rem myFirstFont",n.fillText(a+"."+l,B,R),n.fillText(o,B,U)}else if(4==g&&1==t.page){n.font="normal bold 0.64rem myFirstFont",n.fillStyle="#000";var _=Math.floor(.347*s),j=Math.floor(.58*d);n.fillText(t.discount,_,j)}else if(4==g&&2==t.page){n.font="normal bold 1.333333rem myFirstFont",n.fillStyle="#f02964";var z=Math.floor(.246*s),L=Math.floor(.236*s),W=Math.floor(.5373*s),Y=Math.floor(.422*d),G=Math.floor(.6808*d);n.fillText(t.discount,z,Y),n.font="normal bold 0.48rem myFirstFont",n.fillStyle="#333",n.fillText(t.starttime2,L,G),n.fillText(t.endtime2,W,G)}else if(5==g&&1==t.page){n.font="normal bold 1.333333rem myFirstFont",n.fillStyle="#000";var V=Math.floor(.1426*s),q=Math.floor(.6013*s),H=Math.floor(.31*s),K=Math.floor(.1333*s),Q=Math.floor(.4764*d),X=Math.floor(.7869*d),Z=(Math.floor(.7669*d),Math.floor(.89*d)),tt=Math.floor(.92*d),et=Math.floor(.95*d);n.fillText(t.starttime3,V,Q),n.fillText(t.endtime3,q,Q),n.font="normal bold 0.48rem myFirstFont",n.fillStyle="#fb5b64",n.fillText(t.business,H,X),n.fillStyle="#333",n.fillText(t.name,K,Z),n.font="normal bold 0.32rem myFirstFont",n.fillText(a+"."+l,K,tt),n.fillText(o,K,et)}else if(5==g&&2==t.page){n.font="normal bold 0.48rem myFirstFont",n.fillStyle="#f6c33b";var ot=Math.floor(.298*s),at=Math.floor(.415*s),lt=Math.floor(.1333*s),nt=Math.floor(.801*d),it=Math.floor(.89*d),ft=Math.floor(.92*d),rt=Math.floor(.95*d);n.fillText(t.businessMonth,ot,nt),n.fillText(t.businessDate,at,nt),n.fillStyle="#333",n.fillText(t.name,lt,it),n.font="normal bold 0.32rem myFirstFont",n.fillText(a+"."+l,lt,ft),n.fillText(o,lt,rt)}}}function f(t){return document.getElementById(t).getContext("2d")}function r(){t.showcanvas=!1;var e=document.getElementById("main"),o=e.toDataURL("image/jpg");t.canvasImg=o,t.btnText="长按保存至手机，再发到朋友圈炫耀"}var m=JSON.parse(sessionStorage.getItem("user"));t.user=m,t.btnText="一键生成海报",t.loading=!1,t.showcanvas=!0,t.canvasImg="",t.name="请添加",t.zhekou="八",t.lijian="000",t.starttime="08",t.endtime="24",t.starttime1="08:00",t.endtime1="24:00",t.starttime2="2017.05.01",t.endtime2="2017.05.05",t.starttime3="01",t.endtime3="05",t.discount="00",t.business="06",t.businessMonth="05",t.businessDate="01";var s=document.documentElement.clientWidth,h=Math.floor(s),d=Math.floor(1.83*s);$("#main").attr("width",h+"px"),$("#main").attr("height",d+"px"),console.log(t.user);var g=n.num;t.page=1,t.showImg="../../assets/images/notice/type"+g+"/img_"+t.page+".png";for(var p=1;3>p;p++){var u="../../assets/images/notice/type"+g+"/img_"+p+".png";$(".hideImg").append("<img src="+u+">")}t.editInformation=function(t){t.stopPropagation(),a.path("editInformation")},t.useTemplatePage=function(e){e.stopPropagation(),r(),t.btnText="长按保存至手机，再发到朋友圈炫耀"},t.goBack=function(t){t.stopPropagation(),o.history.back()},t.chengeText=function(){1==g?$(".name-input-fixed").show():2==g&&1==t.page?$(".name-input-fixed-1").show():2==g&&2==t.page?$(".name-input-fixed-2").show():3==g&&1==t.page?$(".name-input-fixed-3").show():3==g&&2==t.page?$(".name-input-fixed-4").show():4==g&&1==t.page?$(".name-input-fixed-5").show():4==g&&2==t.page?$(".name-input-fixed-6").show():5==g&&1==t.page?$(".name-input-fixed-7").show():5==g&&2==t.page&&$(".name-input-fixed-8").show()},t.updateText=function(){i(),1==g?$(".name-input-fixed").fadeOut(50):2==g&&1==t.page?$(".name-input-fixed-1").fadeOut(50):2==g&&2==t.page?$(".name-input-fixed-2").fadeOut(50):3==g&&1==t.page?$(".name-input-fixed-3").fadeOut(50):3==g&&2==t.page?$(".name-input-fixed-4").fadeOut(50):4==g&&1==t.page?$(".name-input-fixed-5").fadeOut(50):4==g&&2==t.page?$(".name-input-fixed-6").fadeOut(50):5==g&&1==t.page?$(".name-input-fixed-7").fadeOut(50):5==g&&2==t.page&&$(".name-input-fixed-8").fadeOut(50)},t.closeText=function(e){e.stopPropagation(),t.user.iscomplete=!0},t.changeImg=function(e){e.stopPropagation(),t.loading=!0,t.page>=2?(t.page=1,t.showImg="../../assets/images/notice/type"+g+"/img_"+t.page+".png",t.loading=!1):(t.page+=1,t.showImg="../../assets/images/notice/type"+g+"/img_"+t.page+".png",t.loading=!1),i()},$(function(){i()})}]);
index.controller("useGreetCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,t,o,a,n,i){function s(){e.btnText="一键生成海报",e.showcanvas=!0;var t=g("main");t.width,t.height;t.clearRect(0,0,1e3,1e3);var o=new Image;o.src=e.showImg,o.onload=function(){if(t.drawImage(o,0,0,m,p),1==c&&1==e.page){t.font="normal bold 0.96rem myFirstFont",t.fillStyle="#fff";var a=Math.floor(.066*f),n=Math.floor(.1466*f),i=Math.floor(.145*p),s=Math.floor(.349*p);t.fillText(e.title,a,i),t.font="normal bold 0.4rem myFirstFont",t.fillStyle="#0f0f0b",t.fillText(e.desc,n,s)}else if(1==c&&2==e.page){t.font="normal bold 0.4rem myFirstFont",t.fillStyle="#fff";var g=Math.floor(.586*f),r=Math.floor(.731*p),l=Math.floor(.6848*p),d=Math.floor(.638*p);t.fillText(e.desc3,g,r),t.fillText(e.desc2,g,l),t.fillText(e.desc1,g,d)}}}function g(e){return document.getElementById(e).getContext("2d")}function r(){e.showcanvas=!1;var t=document.getElementById("main"),o=t.toDataURL("image/jpg");e.canvasImg=o,e.btnText="长按保存至手机，再发到朋友圈炫耀"}var l=JSON.parse(sessionStorage.getItem("user"));e.user=l,e.btnText="一键生成海报",e.loading=!1,e.showcanvas=!0,e.canvasImg="",e.title="点击添加标题",e.desc="点击添加海报描述",e.desc1="点击添加海报描述",e.desc2="点击添加海报描述",e.desc3="点击添加海报描述";var f=document.documentElement.clientWidth,m=Math.floor(f),p=Math.floor(1.83*f);$("#main").attr("width",m+"px"),$("#main").attr("height",p+"px"),console.log(e.user);var c=i.num;e.page=1,e.showImg="../../assets/images/greet/type"+c+"/img_"+e.page+".png";for(var d=1;3>d;d++){var u="../../assets/images/greet/type"+c+"/img_"+d+".png";$(".hideImg").append("<img src="+u+">")}e.editInformation=function(e){e.stopPropagation(),a.path("editInformation")},e.useTemplatePage=function(t){t.stopPropagation(),r(),e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(e){e.stopPropagation(),o.history.back()},e.chengeText=function(){1==c&&1==e.page?$(".name-input-fixed-1").show():1==c&&2==e.page&&$(".name-input-fixed-2").show()},e.updateText=function(){s(),1==c&&1==e.page?$(".name-input-fixed-1").fadeOut(50):1==c&&2==e.page&&$(".name-input-fixed-2").fadeOut(50)},e.closeText=function(t){t.stopPropagation(),e.user.iscomplete=!0},e.changeImg=function(t){t.stopPropagation(),e.loading=!0,e.page>=2?(e.page=1,e.showImg="../../assets/images/greet/type"+c+"/img_"+e.page+".png",e.loading=!1):(e.page+=1,e.showImg="../../assets/images/greet/type"+c+"/img_"+e.page+".png",e.loading=!1),s()},$(function(){s()})}]);
index.controller("vipCenterCtrl",["$scope","$http","$window","$location","$rootScope",function(e,t,i,n,o){t.post("/user/vippage.json",postCfg).then(function(t){if(console.log(t),1===t.data.code){for(var i=t.data.data.viplist,n=0;n<i.length;n++)i[n].selected=!1;e.vipList=t.data.data.viplist}},function(e){}),e.vipid="",e.selectVip=function(t){if(t.selected===!0)t.selected=!1,e.vipid="";else{for(var i=0;i<e.vipList.length;i++)e.vipList[i].selected=!1;t.selected=!0,e.vipid=t.id}},e.showMenu=function(){$(".up-muenu").show()},e.hideMenu=function(){$(".up-muenu").fadeOut(10)},e.buyVip=function(){return""===e.vipid?(alert("请选择要购买的会员选项"),!1):void t.post("/user/buyvip.json",{vipid:e.vipid},postCfg).success(function(e){if(console.log(e),1===e.code){var i={type:"wz",orderid:e.data.id};t.post("/pay/prepay.json",i,postCfg).success(function(e){if(console.log(e),1===e.code){var t=e.data;WeixinJSBridge&&WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.appId,timeStamp:t.timeStamp.toString(),nonceStr:t.nonceStr,"package":t["package"],signType:t.signType,paySign:t.paySign},function(e){"get_brand_wcpay_request:ok"==e.err_msg?n.path("paySuccess"):alert("支付失败,请稍后再试！")})}else 0===e.code&&alert(e.reason)}).error(function(e){})}else 0===resp.code&&alert(resp.reason)}).error(function(e){})}}]);
index.controller("wechatCircleCtrl",["$scope","$http","$window","$location","$rootScope","$routeParams",function(e,o,t,n,a,g){var i=JSON.parse(sessionStorage.getItem("user"));e.user=i,e.btnText="立即使用",e.loading=!1,console.log(e.user);var s=g.num;e.page=1,e.showImg="../../assets/images/promotion/type"+s+"/img_"+e.page+".png",e.editInformation=function(){n.path("editInformation")},e.useTemplatePage=function(){e.btnText="长按保存至手机，再发到朋友圈炫耀"},e.goBack=function(){t.history.back()},e.closeText=function(){e.user.iscomplete=!0},e.changeImg=function(){e.loading=!0,e.page>=3?(e.page=1,e.showImg="../../assets/images/promotion/type"+s+"/img_"+e.page+".png",e.loading=!1):(e.page+=1,e.showImg="../../assets/images/promotion/type"+s+"/img_"+e.page+".png",e.loading=!1)}}]);
index.controller("workHoursCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(t,a,e,i,o,n){var r=new lCalendar;r.init({trigger:".starttime",type:"time"});var s=new lCalendar;s.init({trigger:".endtime",type:"time"});var d=[{name:"星期一",iswork:"0"},{name:"星期二",iswork:"0"},{name:"星期三",iswork:"0"},{name:"星期四",iswork:"0"},{name:"星期五",iswork:"0"},{name:"星期六",iswork:"0"},{name:"星期日",iswork:"0"}];a.post("/user/worktime.json",postCfg).then(function(a){if(-1===a.data.code)t.isLogin=!1,i.path("fast_login");else if(1===a.data.code){t.isLogin=!0,""===a.data.data.starttime||"未知"===a.data.data.starttime?t.starttime="8:00":t.starttime=a.data.data.starttime,""===a.data.data.endtime||"未知"===a.data.data.endtime?t.endtime="22:00":t.endtime=a.data.data.endtime;for(var e=a.data.data.workday,o=0;o<e.length;o++)d[o].iswork=e[o],t.workdayList=d}},function(t){}),t.selectWeek=function(t){1==t.iswork?t.iswork=0:t.iswork=1},t.saveInformation=function(){for(var o="",r=0;r<t.workdayList.length;r++)o+=t.workdayList[r].iswork;var s={workday:o,starttime:t.starttime,endtime:t.endtime};console.log(s),a.post("/user/edit.json",s,postCfg).then(function(t){-1===t.data.code?i.path("fast_login"):1===t.data.code&&n(function(){e.history.back()})},function(t){})}}]);
index.controller("worksCtrl",["$scope","$http","$window","$location","$rootScope","$timeout",function(o,t,e,n,a,r){function s(){t.post("/user/workslist.json",postCfg).then(function(t){if(console.log(t),1===t.data.code){for(var e=t.data.data.allworks,n=0;n<e.length;n++)e[n].imgurl=picBasePath+e[n].imgurl;o.allworks=[],o.allworks=e;for(var a=t.data.data.recommendworks,r=0;r<a.length;r++)a[r].imgurl=picBasePath+a[r].imgurl;o.recommendworks=[],o.recommendworks=a}},function(o){})}function d(){return 0===o.localId.length?(alert("请选择图片!"),!1):void wx.uploadImage({localId:o.localId[0],isShowProgressTips:1,success:function(e){o.serverId=[],o.serverId.push(e.serverId);var n={worksmediaid:o.serverId};t.post("/user/uploadworks.json",n,postCfg).then(function(o){1===o.data.code&&s()},function(o){})},fail:function(o){alert("上传失败！")}})}o.deleteImg=!1,s(),o.deleteRecommendworks=function(o){var e={add:[],rm:[o.id]};t.post("/user/setrecommend.json",e,postCfg).then(function(o){1===o.data.code&&s()},function(o){})},o.addAllworks=function(e){if(o.recommendworks.length>=6)return alert("最多只能设置6张图片作为主页作品展示！"),!1;var n={add:[e.id],rm:[]};t.post("/user/setrecommend.json",n,postCfg).then(function(o){console.log(o),1===o.data.code&&s()},function(o){})},o.deleteAllworks=function(o,e){o.stopPropagation();var n={worksid:[e.id]};t.post("/user/deleteworks.json",n,postCfg).then(function(o){1===o.data.code&&s()},function(o){})},o.showDeleteBtn=function(){o.deleteImg=!o.deleteImg},o.showPrompt=function(){alert("请从下方全部作品中选择！")},o.saveWorkImg=function(){r(function(){e.history.back()})};var c={url:e.location.href.split("#")[0]};t.post("/user/unl/wzinfo.json",c,postCfg).then(function(o){1===o.data.code&&wx.config({debug:!1,appId:o.data.data.appid,timestamp:o.data.data.timestamp,nonceStr:o.data.data.noncestr,signature:o.data.data.signature,jsApiList:["chooseImage","uploadImage"]})},function(o){}),o.updateWorkImg=function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(t){return o.localId=t.localIds,0===o.localId.length?(alert("请选择图片!"),!1):void d()}})}}]);